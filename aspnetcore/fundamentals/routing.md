---
title: Routing in ASP.NET Core
author: rick-anderson
description: Scopri in che modo ASP.NET Core routing è responsabile della corrispondenza tra le richieste HTTP e l'invio a endpoint eseguibili.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 4/1/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/routing
ms.openlocfilehash: 0ce89d2dee3fb2054655c003daddfda2ffa52696
ms.sourcegitcommit: 54fe1ae5e7d068e27376d562183ef9ddc7afc432
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/10/2021
ms.locfileid: "102587282"
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="ce547-103">Routing in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="ce547-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="ce547-104">Di [Ryan Nowak](https://github.com/rynowak), [Kirk Larkin](https://twitter.com/serpent5)e [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="ce547-104">By [Ryan Nowak](https://github.com/rynowak), [Kirk Larkin](https://twitter.com/serpent5), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="ce547-105">Il routing è responsabile della corrispondenza delle richieste HTTP in ingresso e dell'invio di tali richieste agli endpoint eseguibili dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-105">Routing is responsible for matching incoming HTTP requests and dispatching those requests to the app's executable endpoints.</span></span> <span data-ttu-id="ce547-106">Gli [endpoint](#endpoint) sono le unità dell'app del codice di gestione delle richieste eseguibile.</span><span class="sxs-lookup"><span data-stu-id="ce547-106">[Endpoints](#endpoint) are the app's units of executable request-handling code.</span></span> <span data-ttu-id="ce547-107">Gli endpoint vengono definiti nell'app e configurati all'avvio dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-107">Endpoints are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="ce547-108">Il processo di corrispondenza dell'endpoint può estrarre valori dall'URL della richiesta e fornire tali valori per l'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-108">The endpoint matching process can extract values from the request's URL and provide those values for request processing.</span></span> <span data-ttu-id="ce547-109">Usando le informazioni sull'endpoint dall'app, il routing è anche in grado di generare URL con mapping agli endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-109">Using endpoint information from the app, routing is also able to generate URLs that map to endpoints.</span></span>

<span data-ttu-id="ce547-110">Le app possono configurare il routing tramite:</span><span class="sxs-lookup"><span data-stu-id="ce547-110">Apps can configure routing using:</span></span>

- <span data-ttu-id="ce547-111">Controllers</span><span class="sxs-lookup"><span data-stu-id="ce547-111">Controllers</span></span>
- <span data-ttu-id="ce547-112">Razor Pagine</span><span class="sxs-lookup"><span data-stu-id="ce547-112">Razor Pages</span></span>
- SignalR
- <span data-ttu-id="ce547-113">Servizi gRPC</span><span class="sxs-lookup"><span data-stu-id="ce547-113">gRPC Services</span></span>
- <span data-ttu-id="ce547-114">[Middleware](xref:fundamentals/middleware/index) abilitato per gli endpoint, ad esempio i [controlli di integrità](xref:host-and-deploy/health-checks).</span><span class="sxs-lookup"><span data-stu-id="ce547-114">Endpoint-enabled [middleware](xref:fundamentals/middleware/index) such as [Health Checks](xref:host-and-deploy/health-checks).</span></span>
- <span data-ttu-id="ce547-115">Delegati e espressioni lambda registrate con il routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-115">Delegates and lambdas registered with routing.</span></span>

<span data-ttu-id="ce547-116">In questo documento vengono illustrati i dettagli di basso livello del routing ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="ce547-116">This document covers low-level details of ASP.NET Core routing.</span></span> <span data-ttu-id="ce547-117">Per informazioni sulla configurazione del routing:</span><span class="sxs-lookup"><span data-stu-id="ce547-117">For information on configuring routing:</span></span>

* <span data-ttu-id="ce547-118">Per i controller, vedere <xref:mvc/controllers/routing> .</span><span class="sxs-lookup"><span data-stu-id="ce547-118">For controllers, see <xref:mvc/controllers/routing>.</span></span>
* <span data-ttu-id="ce547-119">Per le Razor convenzioni di pagine, vedere <xref:razor-pages/razor-pages-conventions> .</span><span class="sxs-lookup"><span data-stu-id="ce547-119">For Razor Pages conventions, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="ce547-120">Il sistema di routing degli endpoint descritto in questo documento si applica a ASP.NET Core 3,0 e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="ce547-120">The endpoint routing system described in this document applies to ASP.NET Core 3.0 and later.</span></span> <span data-ttu-id="ce547-121">Per informazioni sul sistema di routing precedente basato su <xref:Microsoft.AspNetCore.Routing.IRouter> , selezionare la versione ASP.NET Core 2,1 usando uno degli approcci seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-121">For information on the previous routing system based on <xref:Microsoft.AspNetCore.Routing.IRouter>, select the ASP.NET Core 2.1 version using one of the following approaches:</span></span>

* <span data-ttu-id="ce547-122">Selettore di versione per una versione precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-122">The version selector for a previous version.</span></span>
* <span data-ttu-id="ce547-123">Selezionare [ASP.NET Core 2,1 routing](?view=aspnetcore-2.1).</span><span class="sxs-lookup"><span data-stu-id="ce547-123">Select [ASP.NET Core 2.1 routing](?view=aspnetcore-2.1).</span></span>

<span data-ttu-id="ce547-124">[Visualizzare o scaricare il codice di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples/3.x) ([procedura per il download](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="ce547-124">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples/3.x) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="ce547-125">Gli esempi di download per questo documento sono abilitati da una `Startup` classe specifica.</span><span class="sxs-lookup"><span data-stu-id="ce547-125">The download samples for this document are enabled by a specific `Startup` class.</span></span> <span data-ttu-id="ce547-126">Per eseguire un esempio specifico, modificare *Program.cs* per chiamare la `Startup` classe desiderata.</span><span class="sxs-lookup"><span data-stu-id="ce547-126">To run a specific sample, modify *Program.cs* to call the desired `Startup` class.</span></span>

## <a name="routing-basics"></a><span data-ttu-id="ce547-127">Nozioni fondamentali sul routing</span><span class="sxs-lookup"><span data-stu-id="ce547-127">Routing basics</span></span>

<span data-ttu-id="ce547-128">Tutti i modelli di ASP.NET Core includono il routing nel codice generato.</span><span class="sxs-lookup"><span data-stu-id="ce547-128">All ASP.NET Core templates include routing in the generated code.</span></span> <span data-ttu-id="ce547-129">Il routing viene registrato nella pipeline [middleware](xref:fundamentals/middleware/index) in `Startup.Configure` .</span><span class="sxs-lookup"><span data-stu-id="ce547-129">Routing is registered in the [middleware](xref:fundamentals/middleware/index) pipeline in `Startup.Configure`.</span></span>

<span data-ttu-id="ce547-130">Il codice seguente illustra un esempio di routing di base:</span><span class="sxs-lookup"><span data-stu-id="ce547-130">The following code shows a basic example of routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Startup.cs?name=snippet&highlight=8,10)]

<span data-ttu-id="ce547-131">Il routing utilizza una coppia di middleware, registrata da <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> e <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> :</span><span class="sxs-lookup"><span data-stu-id="ce547-131">Routing uses a pair of middleware, registered by <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>:</span></span>

* <span data-ttu-id="ce547-132">`UseRouting` aggiunge la corrispondenza della route alla pipeline middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-132">`UseRouting` adds route matching to the middleware pipeline.</span></span> <span data-ttu-id="ce547-133">Questo middleware esamina il set di endpoint definiti nell'app e seleziona la [migliore corrispondenza](#urlm) in base alla richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-133">This middleware looks at the set of endpoints defined in the app, and selects the [best match](#urlm) based on the request.</span></span>
* <span data-ttu-id="ce547-134">`UseEndpoints` aggiunge l'esecuzione dell'endpoint alla pipeline middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-134">`UseEndpoints` adds endpoint execution to the middleware pipeline.</span></span> <span data-ttu-id="ce547-135">Esegue il delegato associato all'endpoint selezionato.</span><span class="sxs-lookup"><span data-stu-id="ce547-135">It runs the delegate associated with the selected endpoint.</span></span>

<span data-ttu-id="ce547-136">L'esempio precedente include una singola *Route per l'endpoint di codice* usando il metodo [MapGet](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*) :</span><span class="sxs-lookup"><span data-stu-id="ce547-136">The preceding example includes a single *route to code* endpoint using the [MapGet](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*) method:</span></span>

* <span data-ttu-id="ce547-137">Quando `GET` viene inviata una richiesta HTTP all'URL radice `/` :</span><span class="sxs-lookup"><span data-stu-id="ce547-137">When an HTTP `GET` request is sent to the root URL `/`:</span></span>
  * <span data-ttu-id="ce547-138">Il delegato della richiesta visualizzato viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="ce547-138">The request delegate shown executes.</span></span>
  * <span data-ttu-id="ce547-139">`Hello World!` viene scritto nella risposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce547-139">`Hello World!` is written to the HTTP response.</span></span> <span data-ttu-id="ce547-140">Per impostazione predefinita, l'URL radice `/` è `https://localhost:5001/` .</span><span class="sxs-lookup"><span data-stu-id="ce547-140">By default, the root URL `/` is `https://localhost:5001/`.</span></span>
* <span data-ttu-id="ce547-141">Se il metodo di richiesta non è `GET` o se l'URL radice non è `/` , non viene restituita alcuna corrispondenza e viene restituito un http 404.</span><span class="sxs-lookup"><span data-stu-id="ce547-141">If the request method is not `GET` or the root URL is not `/`, no route matches and an HTTP 404 is returned.</span></span>

### <a name="endpoint"></a><span data-ttu-id="ce547-142">Endpoint</span><span class="sxs-lookup"><span data-stu-id="ce547-142">Endpoint</span></span>

<a name="endpoint"></a>

<span data-ttu-id="ce547-143">Il `MapGet` metodo viene utilizzato per definire un **endpoint**.</span><span class="sxs-lookup"><span data-stu-id="ce547-143">The `MapGet` method is used to define an **endpoint**.</span></span> <span data-ttu-id="ce547-144">Un endpoint è un elemento che può essere:</span><span class="sxs-lookup"><span data-stu-id="ce547-144">An endpoint is something that can be:</span></span>

* <span data-ttu-id="ce547-145">Selezionato, associando l'URL e il metodo HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce547-145">Selected, by matching the URL and HTTP method.</span></span>
* <span data-ttu-id="ce547-146">Eseguita eseguendo il delegato.</span><span class="sxs-lookup"><span data-stu-id="ce547-146">Executed, by running the delegate.</span></span>

<span data-ttu-id="ce547-147">Gli endpoint che possono essere confrontati ed eseguiti dall'app sono configurati in `UseEndpoints` .</span><span class="sxs-lookup"><span data-stu-id="ce547-147">Endpoints that can be matched and executed by the app are configured in `UseEndpoints`.</span></span> <span data-ttu-id="ce547-148">Ad esempio, <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*> , <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapPost*> e [metodi simili](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions) connettono i delegati di richiesta al sistema di routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-148">For example, <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*>, <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapPost*>, and [similar methods](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions) connect request delegates to the routing system.</span></span>
<span data-ttu-id="ce547-149">Per connettere ASP.NET Core funzionalità del Framework al sistema di routing, è possibile utilizzare metodi aggiuntivi:</span><span class="sxs-lookup"><span data-stu-id="ce547-149">Additional methods can be used to connect ASP.NET Core framework features to the routing system:</span></span>
- <span data-ttu-id="ce547-150">[Mappare Razor pagine per le Razor pagine](xref:Microsoft.AspNetCore.Builder.RazorPagesEndpointRouteBuilderExtensions.MapRazorPages*)</span><span class="sxs-lookup"><span data-stu-id="ce547-150">[MapRazorPages for Razor Pages](xref:Microsoft.AspNetCore.Builder.RazorPagesEndpointRouteBuilderExtensions.MapRazorPages*)</span></span>
- [<span data-ttu-id="ce547-151">MapControllers per i controller</span><span class="sxs-lookup"><span data-stu-id="ce547-151">MapControllers for controllers</span></span>](xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllers*)
- <span data-ttu-id="ce547-152">[MapHub \<THub> per SignalR](xref:Microsoft.AspNetCore.SignalR.HubRouteBuilder.MapHub*)</span><span class="sxs-lookup"><span data-stu-id="ce547-152">[MapHub\<THub> for SignalR](xref:Microsoft.AspNetCore.SignalR.HubRouteBuilder.MapHub*)</span></span> 
- [<span data-ttu-id="ce547-153">MapGrpcService \<TService> per gRPC</span><span class="sxs-lookup"><span data-stu-id="ce547-153">MapGrpcService\<TService> for gRPC</span></span>](xref:grpc/aspnetcore)

<span data-ttu-id="ce547-154">Nell'esempio seguente viene illustrato il routing con un modello di route più sofisticato:</span><span class="sxs-lookup"><span data-stu-id="ce547-154">The following example shows routing with a more sophisticated route template:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/RouteTemplateStartup.cs?name=snippet)]

<span data-ttu-id="ce547-155">La stringa `/hello/{name:alpha}` è un **modello di route**.</span><span class="sxs-lookup"><span data-stu-id="ce547-155">The string `/hello/{name:alpha}` is a **route template**.</span></span> <span data-ttu-id="ce547-156">Viene usato per configurare la corrispondenza con l'endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-156">It is used to configure how the endpoint is matched.</span></span> <span data-ttu-id="ce547-157">In questo caso, il modello corrisponde a:</span><span class="sxs-lookup"><span data-stu-id="ce547-157">In this case, the template matches:</span></span>

* <span data-ttu-id="ce547-158">Un URL come `/hello/Ryan`</span><span class="sxs-lookup"><span data-stu-id="ce547-158">A URL like `/hello/Ryan`</span></span>
* <span data-ttu-id="ce547-159">Qualsiasi percorso URL che inizia con `/hello/` seguito da una sequenza di caratteri alfabetici.</span><span class="sxs-lookup"><span data-stu-id="ce547-159">Any URL path that begins with `/hello/` followed by a sequence of alphabetic characters.</span></span>  <span data-ttu-id="ce547-160">`:alpha` applica un vincolo di route che corrisponde solo ai caratteri alfabetici.</span><span class="sxs-lookup"><span data-stu-id="ce547-160">`:alpha` applies a route constraint that matches only alphabetic characters.</span></span> <span data-ttu-id="ce547-161">I [vincoli di route](#route-constraint-reference) vengono illustrati più avanti in questo documento.</span><span class="sxs-lookup"><span data-stu-id="ce547-161">[Route constraints](#route-constraint-reference) are explained later in this document.</span></span>

<span data-ttu-id="ce547-162">Il secondo segmento del percorso URL, `{name:alpha}` :</span><span class="sxs-lookup"><span data-stu-id="ce547-162">The second segment of the URL path, `{name:alpha}`:</span></span>

* <span data-ttu-id="ce547-163">Viene associato al `name` parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-163">Is bound to the `name` parameter.</span></span>
* <span data-ttu-id="ce547-164">Viene acquisito e archiviato in [HttpRequest. routeValues](xref:Microsoft.AspNetCore.Http.HttpRequest.RouteValues*).</span><span class="sxs-lookup"><span data-stu-id="ce547-164">Is captured and stored in [HttpRequest.RouteValues](xref:Microsoft.AspNetCore.Http.HttpRequest.RouteValues*).</span></span>

<span data-ttu-id="ce547-165">Il sistema di routing degli endpoint descritto in questo documento è nuovo a partire da ASP.NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="ce547-165">The endpoint routing system described in this document is new as of ASP.NET Core 3.0.</span></span> <span data-ttu-id="ce547-166">Tuttavia, tutte le versioni di ASP.NET Core supportano lo stesso set di funzionalità del modello di route e vincoli di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-166">However, all versions of ASP.NET Core support the same set of route template features and route constraints.</span></span>

<span data-ttu-id="ce547-167">Nell'esempio seguente viene illustrato il routing con i [controlli di integrità](xref:host-and-deploy/health-checks) e l'autorizzazione:</span><span class="sxs-lookup"><span data-stu-id="ce547-167">The following example shows routing with [health checks](xref:host-and-deploy/health-checks) and authorization:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/AuthorizationStartup.cs?name=snippet)]

[!INCLUDE[request localized comments](~/includes/code-comments-loc.md)]

<span data-ttu-id="ce547-168">Nell'esempio precedente viene illustrato come:</span><span class="sxs-lookup"><span data-stu-id="ce547-168">The preceding example demonstrates how:</span></span>

* <span data-ttu-id="ce547-169">Il middleware di autorizzazione può essere usato con il routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-169">The authorization middleware can be used with routing.</span></span>
* <span data-ttu-id="ce547-170">Gli endpoint possono essere usati per configurare il comportamento di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-170">Endpoints can be used to configure authorization behavior.</span></span>

<span data-ttu-id="ce547-171">La <xref:Microsoft.AspNetCore.Builder.HealthCheckEndpointRouteBuilderExtensions.MapHealthChecks*> chiamata aggiunge un endpoint di controllo integrità.</span><span class="sxs-lookup"><span data-stu-id="ce547-171">The <xref:Microsoft.AspNetCore.Builder.HealthCheckEndpointRouteBuilderExtensions.MapHealthChecks*> call adds a health check endpoint.</span></span> <span data-ttu-id="ce547-172">Il concatenamento <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*> a questa chiamata collega un criterio di autorizzazione all'endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-172">Chaining <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*> on to this call attaches an authorization policy to the endpoint.</span></span>

<span data-ttu-id="ce547-173">Chiamare <xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*> e <xref:Microsoft.AspNetCore.Builder.AuthorizationAppBuilderExtensions.UseAuthorization*> aggiungere il middleware di autenticazione e autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-173">Calling <xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*> and <xref:Microsoft.AspNetCore.Builder.AuthorizationAppBuilderExtensions.UseAuthorization*> adds the authentication and authorization middleware.</span></span> <span data-ttu-id="ce547-174">Questi middleware sono posizionati tra <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> e in `UseEndpoints` modo da poter:</span><span class="sxs-lookup"><span data-stu-id="ce547-174">These middleware are placed between <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> and `UseEndpoints` so that they can:</span></span>

* <span data-ttu-id="ce547-175">Consente di visualizzare l'endpoint selezionato da `UseRouting` .</span><span class="sxs-lookup"><span data-stu-id="ce547-175">See which endpoint was selected by `UseRouting`.</span></span>
* <span data-ttu-id="ce547-176">Applicare un criterio di autorizzazione prima <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> dell'invio all'endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-176">Apply an authorization policy before <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> dispatches to the endpoint.</span></span>

<a name="metadata"></a>

### <a name="endpoint-metadata"></a><span data-ttu-id="ce547-177">Metadati dell'endpoint</span><span class="sxs-lookup"><span data-stu-id="ce547-177">Endpoint metadata</span></span>

<span data-ttu-id="ce547-178">Nell'esempio precedente sono presenti due endpoint, ma solo l'endpoint di controllo integrità dispone di un criterio di autorizzazione collegato.</span><span class="sxs-lookup"><span data-stu-id="ce547-178">In the preceding example, there are two endpoints, but only the health check endpoint has an authorization policy attached.</span></span> <span data-ttu-id="ce547-179">Se la richiesta corrisponde all'endpoint di controllo integrità, `/healthz` viene eseguito un controllo di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-179">If the request matches the health check endpoint, `/healthz`, an authorization check is performed.</span></span> <span data-ttu-id="ce547-180">Ciò dimostra che gli endpoint possono avere dati aggiuntivi collegati.</span><span class="sxs-lookup"><span data-stu-id="ce547-180">This demonstrates that endpoints can have extra data attached to them.</span></span> <span data-ttu-id="ce547-181">Questi dati aggiuntivi sono detti **metadati** dell'endpoint:</span><span class="sxs-lookup"><span data-stu-id="ce547-181">This extra data is called endpoint **metadata**:</span></span>

* <span data-ttu-id="ce547-182">I metadati possono essere elaborati dal middleware compatibile con il routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-182">The metadata can be processed by routing-aware middleware.</span></span>
* <span data-ttu-id="ce547-183">I metadati possono essere di qualsiasi tipo .NET.</span><span class="sxs-lookup"><span data-stu-id="ce547-183">The metadata can be of any .NET type.</span></span>

## <a name="routing-concepts"></a><span data-ttu-id="ce547-184">Concetti di routing</span><span class="sxs-lookup"><span data-stu-id="ce547-184">Routing concepts</span></span>

<span data-ttu-id="ce547-185">Il sistema di routing si basa sulla pipeline middleware aggiungendo il concetto di **endpoint** potente.</span><span class="sxs-lookup"><span data-stu-id="ce547-185">The routing system builds on top of the middleware pipeline by adding the powerful **endpoint** concept.</span></span> <span data-ttu-id="ce547-186">Gli endpoint rappresentano unità della funzionalità dell'app che sono diverse l'una dall'altra in termini di routing, autorizzazione e numero di sistemi ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="ce547-186">Endpoints represent units of the app's functionality that are distinct from each other in terms of routing, authorization, and any number of ASP.NET Core's systems.</span></span>

<a name="endpoint"></a>

### <a name="aspnet-core-endpoint-definition"></a><span data-ttu-id="ce547-187">Definizione di endpoint ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="ce547-187">ASP.NET Core endpoint definition</span></span>

<span data-ttu-id="ce547-188">Un endpoint ASP.NET Core è:</span><span class="sxs-lookup"><span data-stu-id="ce547-188">An ASP.NET Core endpoint is:</span></span>

* <span data-ttu-id="ce547-189">Eseguibile: dispone di un <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate> .</span><span class="sxs-lookup"><span data-stu-id="ce547-189">Executable: Has a <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate>.</span></span>
* <span data-ttu-id="ce547-190">Extensible: include una raccolta di [metadati](xref:Microsoft.AspNetCore.Http.Endpoint.Metadata*) .</span><span class="sxs-lookup"><span data-stu-id="ce547-190">Extensible: Has a [Metadata](xref:Microsoft.AspNetCore.Http.Endpoint.Metadata*) collection.</span></span>
* <span data-ttu-id="ce547-191">Selectable: dispone facoltativamente [delle informazioni di routing](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern*).</span><span class="sxs-lookup"><span data-stu-id="ce547-191">Selectable: Optionally, has [routing information](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern*).</span></span>
* <span data-ttu-id="ce547-192">Enumerable: la raccolta di endpoint può essere elencata recuperando <xref:Microsoft.AspNetCore.Routing.EndpointDataSource> da [di](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="ce547-192">Enumerable: The collection of endpoints can be listed by retrieving the <xref:Microsoft.AspNetCore.Routing.EndpointDataSource> from [DI](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="ce547-193">Il codice seguente illustra come recuperare e controllare l'endpoint che corrisponde alla richiesta corrente:</span><span class="sxs-lookup"><span data-stu-id="ce547-193">The following code shows how to retrieve and inspect the endpoint matching the current request:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/EndpointInspectorStartup.cs?name=snippet)]

<span data-ttu-id="ce547-194">L'endpoint, se selezionato, può essere recuperato da `HttpContext` .</span><span class="sxs-lookup"><span data-stu-id="ce547-194">The endpoint, if selected, can be retrieved from the `HttpContext`.</span></span> <span data-ttu-id="ce547-195">Le proprietà possono essere controllate.</span><span class="sxs-lookup"><span data-stu-id="ce547-195">Its properties can be inspected.</span></span> <span data-ttu-id="ce547-196">Gli oggetti endpoint non sono modificabili e non possono essere modificati dopo la creazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-196">Endpoint objects are immutable and cannot be modified after creation.</span></span> <span data-ttu-id="ce547-197">Il tipo più comune di endpoint è <xref:Microsoft.AspNetCore.Routing.RouteEndpoint> .</span><span class="sxs-lookup"><span data-stu-id="ce547-197">The most common type of endpoint is a <xref:Microsoft.AspNetCore.Routing.RouteEndpoint>.</span></span> <span data-ttu-id="ce547-198">`RouteEndpoint` include informazioni che ne consentono la selezione da parte del sistema di routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-198">`RouteEndpoint` includes information that allows it to be to selected by the routing system.</span></span>

<span data-ttu-id="ce547-199">Nel codice precedente, [app. Usare](xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*) configura un [middleware](xref:fundamentals/middleware/index)inline.</span><span class="sxs-lookup"><span data-stu-id="ce547-199">In the preceding code, [app.Use](xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*) configures an in-line [middleware](xref:fundamentals/middleware/index).</span></span>

<a name="mt"></a>

<span data-ttu-id="ce547-200">Il codice seguente mostra che, a seconda della posizione `app.Use` in cui viene chiamato nella pipeline, potrebbe non essere presente un endpoint:</span><span class="sxs-lookup"><span data-stu-id="ce547-200">The following code shows that, depending on where `app.Use` is called in the pipeline, there may not be an endpoint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/MiddlewareFlowStartup.cs?name=snippet)]

<span data-ttu-id="ce547-201">Questo esempio precedente aggiunge `Console.WriteLine` istruzioni che visualizzano se è stato selezionato un endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-201">This preceding sample adds `Console.WriteLine` statements that display whether or not an endpoint has been selected.</span></span> <span data-ttu-id="ce547-202">Per maggiore chiarezza, l'esempio assegna un nome visualizzato all'endpoint fornito `/` .</span><span class="sxs-lookup"><span data-stu-id="ce547-202">For clarity, the sample assigns a display name to the provided `/` endpoint.</span></span>

<span data-ttu-id="ce547-203">L'esecuzione di questo codice con un URL di `/` Visualizza:</span><span class="sxs-lookup"><span data-stu-id="ce547-203">Running this code with a URL of `/` displays:</span></span>

```txt
1. Endpoint: (null)
2. Endpoint: Hello
3. Endpoint: Hello
```

<span data-ttu-id="ce547-204">L'esecuzione di questo codice con qualsiasi altro URL consente di visualizzare:</span><span class="sxs-lookup"><span data-stu-id="ce547-204">Running this code with any other URL displays:</span></span>

```txt
1. Endpoint: (null)
2. Endpoint: (null)
4. Endpoint: (null)
```

<span data-ttu-id="ce547-205">Questo output dimostra che:</span><span class="sxs-lookup"><span data-stu-id="ce547-205">This output demonstrates that:</span></span>

* <span data-ttu-id="ce547-206">L'endpoint è sempre null prima della `UseRouting` chiamata a.</span><span class="sxs-lookup"><span data-stu-id="ce547-206">The endpoint is always null before `UseRouting` is called.</span></span>
* <span data-ttu-id="ce547-207">Se viene trovata una corrispondenza, l'endpoint è diverso da null tra `UseRouting` e <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> .</span><span class="sxs-lookup"><span data-stu-id="ce547-207">If a match is found, the endpoint is non-null between `UseRouting` and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>
* <span data-ttu-id="ce547-208">Il `UseEndpoints` middleware è **terminale** quando viene trovata una corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-208">The `UseEndpoints` middleware is **terminal** when a match is found.</span></span> <span data-ttu-id="ce547-209">Il [middleware terminale](#tm) è definito più avanti in questo documento.</span><span class="sxs-lookup"><span data-stu-id="ce547-209">[Terminal middleware](#tm) is defined later in this document.</span></span>
* <span data-ttu-id="ce547-210">Il middleware dopo l' `UseEndpoints` esecuzione viene eseguito solo quando non viene trovata alcuna corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-210">The middleware after `UseEndpoints` execute only when no match is found.</span></span>

<span data-ttu-id="ce547-211">Il `UseRouting` middleware usa il metodo [seendpoint](xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.SetEndpoint*) per aggiungere l'endpoint al contesto corrente.</span><span class="sxs-lookup"><span data-stu-id="ce547-211">The `UseRouting` middleware uses the [SetEndpoint](xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.SetEndpoint*) method to attach the endpoint to the current context.</span></span> <span data-ttu-id="ce547-212">È possibile sostituire il `UseRouting` middleware con la logica personalizzata e ottenere comunque i vantaggi derivanti dall'uso degli endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-212">It's possible to replace the `UseRouting` middleware with custom logic and still get the benefits of using endpoints.</span></span> <span data-ttu-id="ce547-213">Gli endpoint sono una primitiva di basso livello, ad esempio middleware, e non sono associati all'implementazione del routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-213">Endpoints are a low-level primitive like middleware, and aren't coupled to the routing implementation.</span></span> <span data-ttu-id="ce547-214">Per la maggior parte delle app non è necessario sostituire `UseRouting` con la logica personalizzata.</span><span class="sxs-lookup"><span data-stu-id="ce547-214">Most apps don't need to replace `UseRouting` with custom logic.</span></span>

<span data-ttu-id="ce547-215">Il `UseEndpoints` middleware è progettato per essere usato in combinazione con il `UseRouting` middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-215">The `UseEndpoints` middleware is designed to be used in tandem with the `UseRouting` middleware.</span></span> <span data-ttu-id="ce547-216">La logica di base per l'esecuzione di un endpoint non è complessa.</span><span class="sxs-lookup"><span data-stu-id="ce547-216">The core logic to execute an endpoint isn't complicated.</span></span> <span data-ttu-id="ce547-217">Usare <xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*> per recuperare l'endpoint e quindi richiamare la relativa <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate> Proprietà.</span><span class="sxs-lookup"><span data-stu-id="ce547-217">Use <xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*> to retrieve the endpoint, and then invoke its <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate> property.</span></span>

<span data-ttu-id="ce547-218">Il codice seguente illustra come il middleware può influenzare o rispondere al routing:</span><span class="sxs-lookup"><span data-stu-id="ce547-218">The following code demonstrates how middleware can influence or react to routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/IntegratedMiddlewareStartup.cs?name=snippet)]

<span data-ttu-id="ce547-219">Nell'esempio precedente vengono illustrati due concetti importanti:</span><span class="sxs-lookup"><span data-stu-id="ce547-219">The preceding example demonstrates two important concepts:</span></span>

* <span data-ttu-id="ce547-220">Il middleware può essere eseguito prima `UseRouting` di per modificare i dati su cui opera il routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-220">Middleware can run before `UseRouting` to modify the data that routing operates upon.</span></span>
    * <span data-ttu-id="ce547-221">In genere il middleware visualizzato prima che il routing modifichi una proprietà della richiesta, ad esempio <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*> , <xref:Microsoft.AspNetCore.Builder.HttpMethodOverrideExtensions.UseHttpMethodOverride*> o <xref:Microsoft.AspNetCore.Builder.UsePathBaseExtensions.UsePathBase*> .</span><span class="sxs-lookup"><span data-stu-id="ce547-221">Usually middleware that appears before routing modifies some property of the request, such as <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>, <xref:Microsoft.AspNetCore.Builder.HttpMethodOverrideExtensions.UseHttpMethodOverride*>, or <xref:Microsoft.AspNetCore.Builder.UsePathBaseExtensions.UsePathBase*>.</span></span>
* <span data-ttu-id="ce547-222">Il middleware può essere eseguito tra `UseRouting` e <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> per elaborare i risultati del routing prima dell'esecuzione dell'endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-222">Middleware can run between `UseRouting` and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> to process the results of routing before the endpoint is executed.</span></span>
    * <span data-ttu-id="ce547-223">Middleware che esegue tra `UseRouting` e `UseEndpoints` :</span><span class="sxs-lookup"><span data-stu-id="ce547-223">Middleware that runs between `UseRouting` and `UseEndpoints`:</span></span>
      * <span data-ttu-id="ce547-224">In genere controlla i metadati per comprendere gli endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-224">Usually inspects metadata to understand the endpoints.</span></span>
      * <span data-ttu-id="ce547-225">Spesso prende decisioni di sicurezza, come fatto da `UseAuthorization` e `UseCors` .</span><span class="sxs-lookup"><span data-stu-id="ce547-225">Often makes security decisions, as done by `UseAuthorization` and `UseCors`.</span></span>
    * <span data-ttu-id="ce547-226">La combinazione di middleware e metadati consente la configurazione dei criteri per endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-226">The combination of middleware and metadata allows configuring policies per-endpoint.</span></span>

<span data-ttu-id="ce547-227">Il codice precedente mostra un esempio di middleware personalizzato che supporta i criteri per endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-227">The preceding code shows an example of a custom middleware that supports per-endpoint policies.</span></span> <span data-ttu-id="ce547-228">Il middleware scrive un *log di controllo* di accesso ai dati sensibili nella console.</span><span class="sxs-lookup"><span data-stu-id="ce547-228">The middleware writes an *audit log* of access to sensitive data to the console.</span></span> <span data-ttu-id="ce547-229">Il middleware può essere configurato per *controllare* un endpoint con i `AuditPolicyAttribute` metadati.</span><span class="sxs-lookup"><span data-stu-id="ce547-229">The middleware can be configured to *audit* an endpoint with the `AuditPolicyAttribute` metadata.</span></span> <span data-ttu-id="ce547-230">In questo esempio viene illustrato un modello *di consenso esplicito in* cui vengono controllati solo gli endpoint contrassegnati come sensibili.</span><span class="sxs-lookup"><span data-stu-id="ce547-230">This sample demonstrates an *opt-in* pattern where only endpoints that are marked as sensitive are audited.</span></span> <span data-ttu-id="ce547-231">È possibile definire questa logica in senso inverso, ad esempio controllando tutti gli elementi che non sono contrassegnati come sicuri.</span><span class="sxs-lookup"><span data-stu-id="ce547-231">It's possible to define this logic in reverse, auditing everything that isn't marked as safe, for example.</span></span> <span data-ttu-id="ce547-232">Il sistema di metadati dell'endpoint è flessibile.</span><span class="sxs-lookup"><span data-stu-id="ce547-232">The endpoint metadata system is flexible.</span></span> <span data-ttu-id="ce547-233">Questa logica può essere progettata nel modo più adatto al caso d'uso.</span><span class="sxs-lookup"><span data-stu-id="ce547-233">This logic could be designed in whatever way suits the use case.</span></span>

<span data-ttu-id="ce547-234">Il codice di esempio precedente ha lo scopo di illustrare i concetti di base degli endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-234">The preceding sample code is intended to demonstrate the basic concepts of endpoints.</span></span> <span data-ttu-id="ce547-235">**L'esempio non è destinato all'uso in produzione**.</span><span class="sxs-lookup"><span data-stu-id="ce547-235">**The sample is not intended for production use**.</span></span> <span data-ttu-id="ce547-236">Una versione più completa di un middleware di *log di controllo* :</span><span class="sxs-lookup"><span data-stu-id="ce547-236">A more complete version of an *audit log* middleware would:</span></span>

* <span data-ttu-id="ce547-237">Accedere a un file o a un database.</span><span class="sxs-lookup"><span data-stu-id="ce547-237">Log to a file or database.</span></span>
* <span data-ttu-id="ce547-238">Includere i dettagli, ad esempio l'utente, l'indirizzo IP, il nome dell'endpoint sensibile e altro ancora.</span><span class="sxs-lookup"><span data-stu-id="ce547-238">Include details such as the user, IP address, name of the sensitive endpoint, and more.</span></span>

<span data-ttu-id="ce547-239">I metadati dei criteri `AuditPolicyAttribute` di controllo sono definiti come un `Attribute` per un uso più semplice con i Framework basati su classi quali i controller e SignalR .</span><span class="sxs-lookup"><span data-stu-id="ce547-239">The audit policy metadata `AuditPolicyAttribute` is defined as an `Attribute` for easier use with class-based frameworks such as controllers and SignalR.</span></span> <span data-ttu-id="ce547-240">Quando si usa la *Route per il codice*:</span><span class="sxs-lookup"><span data-stu-id="ce547-240">When using *route to code*:</span></span>

* <span data-ttu-id="ce547-241">I metadati sono collegati a un'API del generatore.</span><span class="sxs-lookup"><span data-stu-id="ce547-241">Metadata is attached with a builder API.</span></span>
* <span data-ttu-id="ce547-242">I Framework basati su classi includono tutti gli attributi nel metodo e nella classe corrispondenti durante la creazione degli endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-242">Class-based frameworks include all attributes on the corresponding method and class when creating endpoints.</span></span>

<span data-ttu-id="ce547-243">Le procedure consigliate per i tipi di metadati sono definirle come interfacce o attributi.</span><span class="sxs-lookup"><span data-stu-id="ce547-243">The best practices for metadata types are to define them either as interfaces or attributes.</span></span> <span data-ttu-id="ce547-244">Interfacce e attributi consentono il riutilizzo del codice.</span><span class="sxs-lookup"><span data-stu-id="ce547-244">Interfaces and attributes allow code reuse.</span></span> <span data-ttu-id="ce547-245">Il sistema dei metadati è flessibile e non impone alcuna restrizione.</span><span class="sxs-lookup"><span data-stu-id="ce547-245">The metadata system is flexible and doesn't impose any limitations.</span></span>

<a name="tm"></a>

### <a name="comparing-a-terminal-middleware-and-routing"></a><span data-ttu-id="ce547-246">Confronto tra un middleware terminale e il routing</span><span class="sxs-lookup"><span data-stu-id="ce547-246">Comparing a terminal middleware and routing</span></span>

<span data-ttu-id="ce547-247">L'esempio di codice seguente contrasta l'uso del middleware con l'uso del routing:</span><span class="sxs-lookup"><span data-stu-id="ce547-247">The following code sample contrasts using middleware with using routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/TerminalMiddlewareStartup.cs?name=snippet)]

<span data-ttu-id="ce547-248">Lo stile del middleware visualizzato con `Approach 1:` è **middleware terminale**.</span><span class="sxs-lookup"><span data-stu-id="ce547-248">The style of middleware shown with `Approach 1:` is **terminal middleware**.</span></span> <span data-ttu-id="ce547-249">Viene chiamato middleware terminale perché esegue un'operazione di corrispondenza:</span><span class="sxs-lookup"><span data-stu-id="ce547-249">It's called terminal middleware because it does a matching operation:</span></span>

* <span data-ttu-id="ce547-250">L'operazione di corrispondenza nell'esempio precedente è `Path == "/"` per il middleware e `Path == "/Movie"` per il routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-250">The matching operation in the preceding sample is `Path == "/"` for the middleware and `Path == "/Movie"` for routing.</span></span>
* <span data-ttu-id="ce547-251">Quando una corrispondenza ha esito positivo, vengono eseguite alcune funzionalità e viene restituito, anziché richiamare il `next` middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-251">When a match is successful, it executes some functionality and returns, rather than invoking the `next` middleware.</span></span>

<span data-ttu-id="ce547-252">Si chiama middleware terminale perché termina la ricerca, esegue alcune funzionalità e quindi restituisce.</span><span class="sxs-lookup"><span data-stu-id="ce547-252">It's called terminal middleware because it terminates the search, executes some functionality, and then returns.</span></span>

<span data-ttu-id="ce547-253">Confronto tra un middleware terminale e il routing:</span><span class="sxs-lookup"><span data-stu-id="ce547-253">Comparing a terminal middleware and routing:</span></span>
* <span data-ttu-id="ce547-254">Entrambi gli approcci consentono di terminare la pipeline di elaborazione:</span><span class="sxs-lookup"><span data-stu-id="ce547-254">Both approaches allow terminating the processing pipeline:</span></span>
    * <span data-ttu-id="ce547-255">Il middleware termina la pipeline restituendo anziché richiamare `next` .</span><span class="sxs-lookup"><span data-stu-id="ce547-255">Middleware terminates the pipeline by returning rather than invoking `next`.</span></span>
    * <span data-ttu-id="ce547-256">Gli endpoint sono sempre terminali.</span><span class="sxs-lookup"><span data-stu-id="ce547-256">Endpoints are always terminal.</span></span>
* <span data-ttu-id="ce547-257">Il middleware terminale consente di posizionare il middleware in una posizione arbitraria nella pipeline:</span><span class="sxs-lookup"><span data-stu-id="ce547-257">Terminal middleware allows positioning the middleware at an arbitrary place in the pipeline:</span></span>
    * <span data-ttu-id="ce547-258">Gli endpoint vengono eseguiti in corrispondenza della posizione di <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> .</span><span class="sxs-lookup"><span data-stu-id="ce547-258">Endpoints execute at the position of <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>
* <span data-ttu-id="ce547-259">Il middleware terminale consente il codice arbitrario per determinare quando il middleware corrisponde a:</span><span class="sxs-lookup"><span data-stu-id="ce547-259">Terminal middleware allows arbitrary code to determine when the middleware matches:</span></span>
    * <span data-ttu-id="ce547-260">Il codice personalizzato per la corrispondenza delle route può essere dettagliato e difficile da scrivere correttamente.</span><span class="sxs-lookup"><span data-stu-id="ce547-260">Custom route matching code can be verbose and difficult to write correctly.</span></span>
    * <span data-ttu-id="ce547-261">Il routing fornisce soluzioni semplici per le app tipiche.</span><span class="sxs-lookup"><span data-stu-id="ce547-261">Routing provides straightforward solutions for typical apps.</span></span> <span data-ttu-id="ce547-262">La maggior parte delle app non richiede codice personalizzato per la corrispondenza delle route.</span><span class="sxs-lookup"><span data-stu-id="ce547-262">Most apps don't require custom route matching code.</span></span>
* <span data-ttu-id="ce547-263">Interfaccia degli endpoint con middleware, ad esempio `UseAuthorization` e `UseCors` .</span><span class="sxs-lookup"><span data-stu-id="ce547-263">Endpoints interface with middleware such as `UseAuthorization` and `UseCors`.</span></span>
    * <span data-ttu-id="ce547-264">L'uso di un middleware terminale con `UseAuthorization` o `UseCors` richiede l'interazione manuale con il sistema di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-264">Using a terminal middleware with `UseAuthorization` or `UseCors` requires manual interfacing with the authorization system.</span></span>

<span data-ttu-id="ce547-265">Un [endpoint](#endpoint) definisce entrambi:</span><span class="sxs-lookup"><span data-stu-id="ce547-265">An [endpoint](#endpoint) defines both:</span></span>

* <span data-ttu-id="ce547-266">Delegato per l'elaborazione delle richieste.</span><span class="sxs-lookup"><span data-stu-id="ce547-266">A delegate to process requests.</span></span>
* <span data-ttu-id="ce547-267">Raccolta di metadati arbitrari.</span><span class="sxs-lookup"><span data-stu-id="ce547-267">A collection of arbitrary metadata.</span></span> <span data-ttu-id="ce547-268">I metadati vengono usati per implementare le problematiche trasversali in base ai criteri e alla configurazione collegati a ogni endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-268">The metadata is used to implement cross-cutting concerns based on policies and configuration attached to each endpoint.</span></span>

<span data-ttu-id="ce547-269">Il middleware terminale può essere uno strumento efficace, ma può richiedere:</span><span class="sxs-lookup"><span data-stu-id="ce547-269">Terminal middleware can be an effective tool, but can require:</span></span>

* <span data-ttu-id="ce547-270">Una quantità significativa di codice e test.</span><span class="sxs-lookup"><span data-stu-id="ce547-270">A significant amount of coding and testing.</span></span>
* <span data-ttu-id="ce547-271">Integrazione manuale con altri sistemi per raggiungere il livello di flessibilità desiderato.</span><span class="sxs-lookup"><span data-stu-id="ce547-271">Manual integration with other systems to achieve the desired level of flexibility.</span></span>

<span data-ttu-id="ce547-272">Prendere in considerazione l'integrazione con routing prima di scrivere un middleware terminale.</span><span class="sxs-lookup"><span data-stu-id="ce547-272">Consider integrating with routing before writing a terminal middleware.</span></span>

<span data-ttu-id="ce547-273">Il middleware terminale esistente che si integra con [Map](xref:fundamentals/middleware/index#branch-the-middleware-pipeline) o <xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> può in genere essere trasformato in un endpoint in grado di riconoscere il routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-273">Existing terminal middleware that integrates with [Map](xref:fundamentals/middleware/index#branch-the-middleware-pipeline) or <xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> can usually be turned into a routing aware endpoint.</span></span> <span data-ttu-id="ce547-274">[MapHealthChecks](https://github.com/dotnet/AspNetCore/blob/main/src/Middleware/HealthChecks/src/Builder/HealthCheckEndpointRouteBuilderExtensions.cs#L16) illustra il modello per il router-Ware:</span><span class="sxs-lookup"><span data-stu-id="ce547-274">[MapHealthChecks](https://github.com/dotnet/AspNetCore/blob/main/src/Middleware/HealthChecks/src/Builder/HealthCheckEndpointRouteBuilderExtensions.cs#L16) demonstrates the pattern for router-ware:</span></span>
* <span data-ttu-id="ce547-275">Scrivere un metodo di estensione in <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder> .</span><span class="sxs-lookup"><span data-stu-id="ce547-275">Write an extension method on <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder>.</span></span>
* <span data-ttu-id="ce547-276">Creare una pipeline middleware annidata usando <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder.CreateApplicationBuilder*> .</span><span class="sxs-lookup"><span data-stu-id="ce547-276">Create a nested middleware pipeline using <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder.CreateApplicationBuilder*>.</span></span>
* <span data-ttu-id="ce547-277">Alleghi il middleware alla nuova pipeline.</span><span class="sxs-lookup"><span data-stu-id="ce547-277">Attach the middleware to the new pipeline.</span></span> <span data-ttu-id="ce547-278">In questo caso, <xref:Microsoft.AspNetCore.Builder.HealthCheckApplicationBuilderExtensions.UseHealthChecks*>.</span><span class="sxs-lookup"><span data-stu-id="ce547-278">In this case, <xref:Microsoft.AspNetCore.Builder.HealthCheckApplicationBuilderExtensions.UseHealthChecks*>.</span></span>
* <span data-ttu-id="ce547-279"><xref:Microsoft.AspNetCore.Builder.IApplicationBuilder.Build*> pipeline middleware in un oggetto <xref:Microsoft.AspNetCore.Http.RequestDelegate> .</span><span class="sxs-lookup"><span data-stu-id="ce547-279"><xref:Microsoft.AspNetCore.Builder.IApplicationBuilder.Build*> the middleware pipeline into a <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span>
* <span data-ttu-id="ce547-280">Chiamare `Map` e fornire la nuova pipeline middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-280">Call `Map` and provide the new middleware pipeline.</span></span>
* <span data-ttu-id="ce547-281">Restituisce l'oggetto generatore fornito da `Map` dal metodo di estensione.</span><span class="sxs-lookup"><span data-stu-id="ce547-281">Return the builder object provided by `Map` from the extension method.</span></span>

<span data-ttu-id="ce547-282">Il codice seguente illustra l'uso di [MapHealthChecks](xref:host-and-deploy/health-checks):</span><span class="sxs-lookup"><span data-stu-id="ce547-282">The following code shows use of [MapHealthChecks](xref:host-and-deploy/health-checks):</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/AuthorizationStartup.cs?name=snippet)]

<span data-ttu-id="ce547-283">Nell'esempio precedente viene illustrato il motivo per cui la restituzione dell'oggetto generatore è importante.</span><span class="sxs-lookup"><span data-stu-id="ce547-283">The preceding sample shows why returning the builder object is important.</span></span> <span data-ttu-id="ce547-284">La restituzione dell'oggetto generatore consente allo sviluppatore di app di configurare criteri come l'autorizzazione per l'endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-284">Returning the builder object allows the app developer to configure policies such as authorization for the endpoint.</span></span> <span data-ttu-id="ce547-285">In questo esempio il middleware dei controlli di integrità non ha alcuna integrazione diretta con il sistema di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-285">In this example, the health checks middleware has no direct integration with the authorization system.</span></span>

<span data-ttu-id="ce547-286">Il sistema dei metadati è stato creato in risposta ai problemi riscontrati dagli autori di estendibilità tramite il middleware terminale.</span><span class="sxs-lookup"><span data-stu-id="ce547-286">The metadata system was created in response to the problems encountered by extensibility authors using terminal middleware.</span></span> <span data-ttu-id="ce547-287">È problematico per ogni middleware implementare una propria integrazione con il sistema di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-287">It's problematic for each middleware to implement its own integration with the authorization system.</span></span>

<a name="urlm"></a>

### <a name="url-matching"></a><span data-ttu-id="ce547-288">Corrispondenza URL</span><span class="sxs-lookup"><span data-stu-id="ce547-288">URL matching</span></span>

* <span data-ttu-id="ce547-289">È il processo mediante il quale il routing corrisponde a una richiesta in ingresso a un [endpoint](#endpoint).</span><span class="sxs-lookup"><span data-stu-id="ce547-289">Is the process by which routing matches an incoming request to an [endpoint](#endpoint).</span></span>
* <span data-ttu-id="ce547-290">Si basa sui dati nel percorso e nelle intestazioni URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-290">Is based on data in the URL path and headers.</span></span>
* <span data-ttu-id="ce547-291">Può essere esteso per considerare tutti i dati nella richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-291">Can be extended to consider any data in the request.</span></span>

<span data-ttu-id="ce547-292">Quando viene eseguito un middleware di routing, imposta i `Endpoint` valori di route e su una [funzionalità di richiesta](xref:fundamentals/request-features) nell'oggetto <xref:Microsoft.AspNetCore.Http.HttpContext> dalla richiesta corrente:</span><span class="sxs-lookup"><span data-stu-id="ce547-292">When a routing middleware executes, it sets an `Endpoint` and route values to a [request feature](xref:fundamentals/request-features) on the <xref:Microsoft.AspNetCore.Http.HttpContext> from the current request:</span></span>

* <span data-ttu-id="ce547-293">La chiamata a [HttpContext. GetEndPoint](<xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*>) Ottiene l'endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-293">Calling [HttpContext.GetEndpoint](<xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*>) gets the endpoint.</span></span>
* <span data-ttu-id="ce547-294">`HttpRequest.RouteValues` ottiene la raccolta dei valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-294">`HttpRequest.RouteValues` gets the collection of route values.</span></span>

<span data-ttu-id="ce547-295">Il [middleware](xref:fundamentals/middleware/index) eseguito dopo il middleware di routing può ispezionare l'endpoint ed eseguire un'azione.</span><span class="sxs-lookup"><span data-stu-id="ce547-295">[Middleware](xref:fundamentals/middleware/index) running after the routing middleware can inspect the endpoint and take action.</span></span> <span data-ttu-id="ce547-296">Un middleware di autorizzazione, ad esempio, può interrogare la raccolta di metadati dell'endpoint per i criteri di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-296">For example, an authorization middleware can interrogate the endpoint's metadata collection for an authorization policy.</span></span> <span data-ttu-id="ce547-297">Dopo l'esecuzione di tutto il middleware nella pipeline di elaborazione della richiesta, viene richiamato il delegato dell'endpoint selezionato.</span><span class="sxs-lookup"><span data-stu-id="ce547-297">After all of the middleware in the request processing pipeline is executed, the selected endpoint's delegate is invoked.</span></span>

<span data-ttu-id="ce547-298">Il sistema di routing nell'endpoint di routing è responsabile di tutte le decisioni relative all'invio.</span><span class="sxs-lookup"><span data-stu-id="ce547-298">The routing system in endpoint routing is responsible for all dispatching decisions.</span></span> <span data-ttu-id="ce547-299">Poiché il middleware applica criteri basati sull'endpoint selezionato, è importante:</span><span class="sxs-lookup"><span data-stu-id="ce547-299">Because the middleware applies policies based on the selected endpoint, it's important that:</span></span>

* <span data-ttu-id="ce547-300">Qualsiasi decisione che può influire sull'invio o sull'applicazione di criteri di sicurezza viene effettuata all'interno del sistema di routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-300">Any decision that can affect dispatching or the application of security policies is made inside the routing system.</span></span>

> [!WARNING]
> <span data-ttu-id="ce547-301">Per la compatibilità con le versioni precedenti, quando Razor viene eseguito un delegato dell'endpoint di un controller o di una pagina, le proprietà di [RouteContext. RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) vengono impostate sui valori appropriati in base all'elaborazione della richiesta eseguita fino a questo momento.</span><span class="sxs-lookup"><span data-stu-id="ce547-301">For backwards-compatibility, when a Controller or Razor Pages endpoint delegate is executed, the properties of [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) are set to appropriate values based on the request processing performed thus far.</span></span>
>
> <span data-ttu-id="ce547-302">Il `RouteContext` tipo verrà contrassegnato come obsoleto in una versione futura:</span><span class="sxs-lookup"><span data-stu-id="ce547-302">The `RouteContext` type will be marked obsolete in a future release:</span></span>
>
> * <span data-ttu-id="ce547-303">Eseguire la migrazione `RouteData.Values` a `HttpRequest.RouteValues` .</span><span class="sxs-lookup"><span data-stu-id="ce547-303">Migrate `RouteData.Values` to `HttpRequest.RouteValues`.</span></span>
> * <span data-ttu-id="ce547-304">Eseguire `RouteData.DataTokens` la migrazione per recuperare [IDataTokensMetadata](xref:Microsoft.AspNetCore.Routing.IDataTokensMetadata) dai metadati dell'endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-304">Migrate `RouteData.DataTokens` to retrieve [IDataTokensMetadata](xref:Microsoft.AspNetCore.Routing.IDataTokensMetadata) from the endpoint metadata.</span></span>

<span data-ttu-id="ce547-305">La corrispondenza degli URL opera in un set di fasi configurabile.</span><span class="sxs-lookup"><span data-stu-id="ce547-305">URL matching operates in a configurable set of phases.</span></span> <span data-ttu-id="ce547-306">In ogni fase l'output è un set di corrispondenze.</span><span class="sxs-lookup"><span data-stu-id="ce547-306">In each phase, the output is a set of matches.</span></span> <span data-ttu-id="ce547-307">Il set di corrispondenze può essere ulteriormente ridotto dalla fase successiva.</span><span class="sxs-lookup"><span data-stu-id="ce547-307">The set of matches can be narrowed down further by the next phase.</span></span> <span data-ttu-id="ce547-308">L'implementazione del routing non garantisce un ordine di elaborazione per gli endpoint corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-308">The routing implementation does not guarantee a processing order for matching endpoints.</span></span> <span data-ttu-id="ce547-309">**Tutte le** corrispondenze possibili vengono elaborate in una sola volta.</span><span class="sxs-lookup"><span data-stu-id="ce547-309">**All** possible matches are processed at once.</span></span> <span data-ttu-id="ce547-310">Le fasi corrispondenti dell'URL si verificano nell'ordine seguente.</span><span class="sxs-lookup"><span data-stu-id="ce547-310">The URL matching phases occur in the following order.</span></span> <span data-ttu-id="ce547-311">ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="ce547-311">ASP.NET Core:</span></span>

1. <span data-ttu-id="ce547-312">Elabora il percorso URL rispetto al set di endpoint e ai relativi modelli di route, raccogliendo **tutte** le corrispondenze.</span><span class="sxs-lookup"><span data-stu-id="ce547-312">Processes the URL path against the set of endpoints and their route templates, collecting **all** of the matches.</span></span>
1. <span data-ttu-id="ce547-313">Accetta l'elenco precedente e rimuove le corrispondenze che non riescono con i vincoli di route applicati.</span><span class="sxs-lookup"><span data-stu-id="ce547-313">Takes the preceding list and removes matches that fail with route constraints applied.</span></span>
1. <span data-ttu-id="ce547-314">Accetta l'elenco precedente e rimuove le corrispondenze che non superano il set di istanze di [MatcherPolicy](xref:Microsoft.AspNetCore.Routing.MatcherPolicy) .</span><span class="sxs-lookup"><span data-stu-id="ce547-314">Takes the preceding list and removes matches that fail the set of [MatcherPolicy](xref:Microsoft.AspNetCore.Routing.MatcherPolicy) instances.</span></span>
1. <span data-ttu-id="ce547-315">USA [EndpointSelector](xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector) per prendere una decisione finale dall'elenco precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-315">Uses the [EndpointSelector](xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector) to make a final decision from the preceding list.</span></span>

<span data-ttu-id="ce547-316">Per l'elenco degli endpoint viene assegnata la priorità in base a:</span><span class="sxs-lookup"><span data-stu-id="ce547-316">The list of endpoints is prioritized according to:</span></span>

* <span data-ttu-id="ce547-317">[RouteEndpoint. Order](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order*)</span><span class="sxs-lookup"><span data-stu-id="ce547-317">The [RouteEndpoint.Order](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order*)</span></span>
* <span data-ttu-id="ce547-318">[Precedenza del modello di route](#rtp)</span><span class="sxs-lookup"><span data-stu-id="ce547-318">The [route template precedence](#rtp)</span></span>

<span data-ttu-id="ce547-319">Tutti gli endpoint corrispondenti vengono elaborati in ogni fase fino a quando non <xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector> viene raggiunto il.</span><span class="sxs-lookup"><span data-stu-id="ce547-319">All matching endpoints are processed in each phase until the <xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector> is reached.</span></span> <span data-ttu-id="ce547-320">`EndpointSelector`È la fase finale.</span><span class="sxs-lookup"><span data-stu-id="ce547-320">The `EndpointSelector` is the final phase.</span></span> <span data-ttu-id="ce547-321">Viene scelto l'endpoint con la priorità più alta dalle corrispondenze come la migliore corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-321">It chooses the highest priority endpoint from the matches as the best match.</span></span> <span data-ttu-id="ce547-322">Se sono presenti altre corrispondenze con la stessa priorità della corrispondenza migliore, viene generata un'eccezione di corrispondenza ambigua.</span><span class="sxs-lookup"><span data-stu-id="ce547-322">If there are other matches with the same priority as the best match, an ambiguous match exception is thrown.</span></span>

<span data-ttu-id="ce547-323">La precedenza della route viene calcolata in base a un modello di route **più specifico** a cui viene assegnata una priorità più alta.</span><span class="sxs-lookup"><span data-stu-id="ce547-323">The route precedence is computed based on a **more specific** route template being given a higher priority.</span></span> <span data-ttu-id="ce547-324">Si considerino, ad esempio, i modelli `/hello` e `/{message}` :</span><span class="sxs-lookup"><span data-stu-id="ce547-324">For example, consider the templates `/hello` and `/{message}`:</span></span>

* <span data-ttu-id="ce547-325">Entrambe corrispondono al percorso URL `/hello` .</span><span class="sxs-lookup"><span data-stu-id="ce547-325">Both match the URL path `/hello`.</span></span>
* <span data-ttu-id="ce547-326">`/hello`  è più specifico e pertanto con una priorità più elevata.</span><span class="sxs-lookup"><span data-stu-id="ce547-326">`/hello`  is more specific and therefore higher priority.</span></span>

<span data-ttu-id="ce547-327">In generale, la precedenza della route consente di scegliere la migliore corrispondenza per i tipi di schemi URL usati in pratica.</span><span class="sxs-lookup"><span data-stu-id="ce547-327">In general, route precedence does a good job of choosing the best match for the kinds of URL schemes used in practice.</span></span> <span data-ttu-id="ce547-328">Utilizzare <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order> solo quando necessario per evitare ambiguità.</span><span class="sxs-lookup"><span data-stu-id="ce547-328">Use <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order> only when necessary to avoid an ambiguity.</span></span>

<span data-ttu-id="ce547-329">A causa dei tipi di estendibilità offerti dal routing, non è possibile che il sistema di routing calcoli in anticipo le route ambigue.</span><span class="sxs-lookup"><span data-stu-id="ce547-329">Due to the kinds of extensibility provided by routing, it isn't possible for the routing system to compute ahead of time the ambiguous routes.</span></span> <span data-ttu-id="ce547-330">Si consideri, ad esempio, i modelli di route `/{message:alpha}` e `/{message:int}` :</span><span class="sxs-lookup"><span data-stu-id="ce547-330">Consider an example such as the route templates `/{message:alpha}` and `/{message:int}`:</span></span>

* <span data-ttu-id="ce547-331">Il `alpha` vincolo corrisponde solo ai caratteri alfabetici.</span><span class="sxs-lookup"><span data-stu-id="ce547-331">The `alpha` constraint matches only alphabetic characters.</span></span>
* <span data-ttu-id="ce547-332">Il `int` vincolo corrisponde solo ai numeri.</span><span class="sxs-lookup"><span data-stu-id="ce547-332">The `int` constraint matches only numbers.</span></span>
* <span data-ttu-id="ce547-333">Questi modelli hanno la stessa precedenza di route, ma non esiste un singolo URL corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-333">These templates have the same route precedence, but there's no single URL they both match.</span></span>
* <span data-ttu-id="ce547-334">Se il sistema di routing ha segnalato un errore di ambiguità all'avvio, blocca il caso d'uso valido.</span><span class="sxs-lookup"><span data-stu-id="ce547-334">If the routing system reported an ambiguity error at startup, it would block this valid use case.</span></span>

> [!WARNING]
>
> <span data-ttu-id="ce547-335">L'ordine delle operazioni all'interno di <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> non influisce sul comportamento del routing, con un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="ce547-335">The order of operations inside <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> doesn't influence the behavior of routing, with one exception.</span></span> <span data-ttu-id="ce547-336"><xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> e <xref:Microsoft.AspNetCore.Builder.MvcAreaRouteBuilderExtensions.MapAreaRoute*> assegna automaticamente un valore di ordine ai rispettivi endpoint in base all'ordine in cui vengono richiamati.</span><span class="sxs-lookup"><span data-stu-id="ce547-336"><xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> and <xref:Microsoft.AspNetCore.Builder.MvcAreaRouteBuilderExtensions.MapAreaRoute*> automatically assign an order value to their endpoints based on the order they are invoked.</span></span> <span data-ttu-id="ce547-337">Questo simula il comportamento a lungo termine dei controller senza che il sistema di routing fornisca le stesse garanzie delle implementazioni di routing precedenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-337">This simulates long-time behavior of controllers without the routing system providing the same guarantees as older routing implementations.</span></span>
>
> <span data-ttu-id="ce547-338">Nell'implementazione legacy del routing, è possibile implementare l'estendibilità del routing che dipende dall'ordine in cui vengono elaborate le route.</span><span class="sxs-lookup"><span data-stu-id="ce547-338">In the legacy implementation of routing, it's possible to implement routing extensibility that has a dependency on the order in which routes are processed.</span></span> <span data-ttu-id="ce547-339">Routing degli endpoint in ASP.NET Core 3,0 e versioni successive:</span><span class="sxs-lookup"><span data-stu-id="ce547-339">Endpoint routing in ASP.NET Core 3.0 and later:</span></span>
> 
> * <span data-ttu-id="ce547-340">Non ha un concetto di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-340">Doesn't have a concept of routes.</span></span>
> * <span data-ttu-id="ce547-341">Non fornisce garanzie di ordinamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-341">Doesn't provide ordering guarantees.</span></span> <span data-ttu-id="ce547-342">Tutti gli endpoint vengono elaborati contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="ce547-342">All endpoints are processed at once.</span></span>

<a name="rtp"></a>

### <a name="route-template-precedence-and-endpoint-selection-order"></a><span data-ttu-id="ce547-343">Ordine di precedenza e selezione degli endpoint del modello di route</span><span class="sxs-lookup"><span data-stu-id="ce547-343">Route template precedence and endpoint selection order</span></span>

<span data-ttu-id="ce547-344">La [precedenza del modello di route](https://github.com/dotnet/aspnetcore/blob/main/src/Http/Routing/src/Template/RoutePrecedence.cs#L16) è un sistema che assegna a ogni modello di route un valore in base a quanto è specifico.</span><span class="sxs-lookup"><span data-stu-id="ce547-344">[Route template precedence](https://github.com/dotnet/aspnetcore/blob/main/src/Http/Routing/src/Template/RoutePrecedence.cs#L16) is a system that assigns each route template a value based on how specific it is.</span></span> <span data-ttu-id="ce547-345">Precedenza modello di route:</span><span class="sxs-lookup"><span data-stu-id="ce547-345">Route template precedence:</span></span>

* <span data-ttu-id="ce547-346">Evita la necessità di modificare l'ordine degli endpoint in casi comuni.</span><span class="sxs-lookup"><span data-stu-id="ce547-346">Avoids the need to adjust the order of endpoints in common cases.</span></span>
* <span data-ttu-id="ce547-347">Tenta di trovare la corrispondenza con le aspettative comuni del comportamento di routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-347">Attempts to match the common-sense expectations of routing behavior.</span></span>

<span data-ttu-id="ce547-348">Si considerino, ad esempio, i modelli `/Products/List` e `/Products/{id}` .</span><span class="sxs-lookup"><span data-stu-id="ce547-348">For example, consider templates `/Products/List` and `/Products/{id}`.</span></span> <span data-ttu-id="ce547-349">Sarebbe ragionevole presupporre che `/Products/List` sia una corrispondenza migliore rispetto `/Products/{id}` al percorso URL `/Products/List` .</span><span class="sxs-lookup"><span data-stu-id="ce547-349">It would be reasonable to assume that `/Products/List` is a better match than `/Products/{id}` for the URL path `/Products/List`.</span></span> <span data-ttu-id="ce547-350">Questa operazione funziona perché il segmento letterale `/List` viene considerato con una precedenza migliore rispetto al segmento di parametro `/{id}` .</span><span class="sxs-lookup"><span data-stu-id="ce547-350">This works because the literal segment `/List` is considered to have better precedence than the parameter segment `/{id}`.</span></span>

<span data-ttu-id="ce547-351">I dettagli del funzionamento della precedenza sono associati alla modalità di definizione dei modelli di route:</span><span class="sxs-lookup"><span data-stu-id="ce547-351">The details of how precedence works are coupled to how route templates are defined:</span></span>

* <span data-ttu-id="ce547-352">I modelli con più segmenti sono considerati più specifici.</span><span class="sxs-lookup"><span data-stu-id="ce547-352">Templates with more segments are considered more specific.</span></span>
* <span data-ttu-id="ce547-353">Un segmento con testo letterale viene considerato più specifico rispetto a un segmento di parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-353">A segment with literal text is considered more specific than a parameter segment.</span></span>
* <span data-ttu-id="ce547-354">Un segmento di parametro con un vincolo è considerato più specifico di uno senza.</span><span class="sxs-lookup"><span data-stu-id="ce547-354">A parameter segment with a constraint is considered more specific than one without.</span></span>
* <span data-ttu-id="ce547-355">Un segmento complesso è considerato specifico come un segmento di parametro con un vincolo.</span><span class="sxs-lookup"><span data-stu-id="ce547-355">A complex segment is considered as specific as a parameter segment with a constraint.</span></span>
* <span data-ttu-id="ce547-356">I parametri catch-all sono i meno specifici.</span><span class="sxs-lookup"><span data-stu-id="ce547-356">Catch-all parameters are the least specific.</span></span> <span data-ttu-id="ce547-357">Per informazioni importanti sulle route catch-all, vedere **catch-all** nel [riferimento del modello di route](#rtr) .</span><span class="sxs-lookup"><span data-stu-id="ce547-357">See **catch-all** in the [Route template reference](#rtr) for important information on catch-all routes.</span></span>

<span data-ttu-id="ce547-358">Per un riferimento di valori esatti, vedere il [codice sorgente su GitHub](https://github.com/dotnet/aspnetcore/blob/main/src/Http/Routing/src/Template/RoutePrecedence.cs#L189) .</span><span class="sxs-lookup"><span data-stu-id="ce547-358">See the [source code on GitHub](https://github.com/dotnet/aspnetcore/blob/main/src/Http/Routing/src/Template/RoutePrecedence.cs#L189) for a reference of exact values.</span></span>

<a name="lg"></a>

### <a name="url-generation-concepts"></a><span data-ttu-id="ce547-359">Concetti relativi alla generazione di URL</span><span class="sxs-lookup"><span data-stu-id="ce547-359">URL generation concepts</span></span>

<span data-ttu-id="ce547-360">Generazione URL:</span><span class="sxs-lookup"><span data-stu-id="ce547-360">URL generation:</span></span>

* <span data-ttu-id="ce547-361">È il processo mediante il quale il routing può creare un percorso URL basato su un set di valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-361">Is the process by which routing can create a URL path based on a set of route values.</span></span>
* <span data-ttu-id="ce547-362">Consente una separazione logica tra gli endpoint e gli URL che vi accedono.</span><span class="sxs-lookup"><span data-stu-id="ce547-362">Allows for a logical separation between endpoints and the URLs that access them.</span></span>

<span data-ttu-id="ce547-363">Il routing degli endpoint include l' <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API.</span><span class="sxs-lookup"><span data-stu-id="ce547-363">Endpoint routing includes the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API.</span></span> <span data-ttu-id="ce547-364">`LinkGenerator` è un servizio singleton disponibile in [di](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="ce547-364">`LinkGenerator` is a singleton service available from [DI](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="ce547-365">L' `LinkGenerator` API può essere usata al di fuori del contesto di una richiesta in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="ce547-365">The `LinkGenerator` API can be used outside of the context of an executing request.</span></span> <span data-ttu-id="ce547-366">[MVC. IUrlHelper](xref:Microsoft.AspNetCore.Mvc.IUrlHelper) e gli scenari basati su <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> , ad esempio gli [Helper Tag](xref:mvc/views/tag-helpers/intro), gli helper HTML e [i risultati dell'azione](xref:mvc/controllers/actions), usano l' `LinkGenerator` API internamente per fornire funzionalità di generazione dei collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-366">[Mvc.IUrlHelper](xref:Microsoft.AspNetCore.Mvc.IUrlHelper) and scenarios that rely on <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, such as [Tag Helpers](xref:mvc/views/tag-helpers/intro), HTML Helpers, and [Action Results](xref:mvc/controllers/actions), use the `LinkGenerator` API internally to provide link generating capabilities.</span></span>

<span data-ttu-id="ce547-367">Il generatore di collegamenti si basa sui concetti di **indirizzo** e di **schemi di indirizzi**.</span><span class="sxs-lookup"><span data-stu-id="ce547-367">The link generator is backed by the concept of an **address** and **address schemes**.</span></span> <span data-ttu-id="ce547-368">Lo schema di indirizzi consente di determinare gli endpoint che devono essere considerati per la generazione dei collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-368">An address scheme is a way of determining the endpoints that should be considered for link generation.</span></span> <span data-ttu-id="ce547-369">Ad esempio, gli scenari relativi al nome della route e ai valori di route molti utenti hanno familiarità con i controller e le Razor pagine vengono implementati come uno schema di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="ce547-369">For example, the route name and route values scenarios many users are familiar with from controllers and Razor Pages are implemented as an address scheme.</span></span>

<span data-ttu-id="ce547-370">Il generatore di collegamenti può collegarsi a controller e Razor pagine tramite i seguenti metodi di estensione:</span><span class="sxs-lookup"><span data-stu-id="ce547-370">The link generator can link to controllers and Razor Pages via the following extension methods:</span></span>

* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetPathByAction*>
* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetUriByAction*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetPathByPage*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetUriByPage*>

<span data-ttu-id="ce547-371">Gli overload di questi metodi accettano argomenti che includono `HttpContext` .</span><span class="sxs-lookup"><span data-stu-id="ce547-371">Overloads of these methods accept arguments that include the `HttpContext`.</span></span> <span data-ttu-id="ce547-372">Questi metodi sono equivalenti dal punto di vista funzionale a [URL. Action](xref:System.Web.Mvc.UrlHelper.Action*) e [URL. Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*), ma offrono flessibilità e opzioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="ce547-372">These methods are functionally equivalent to [Url.Action](xref:System.Web.Mvc.UrlHelper.Action*) and [Url.Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*), but offer additional flexibility and options.</span></span>

<span data-ttu-id="ce547-373">I `GetPath*` metodi sono molto simili a `Url.Action` e `Url.Page` , perché generano un URI contenente un percorso assoluto.</span><span class="sxs-lookup"><span data-stu-id="ce547-373">The `GetPath*` methods are most similar to `Url.Action` and `Url.Page`, in that they generate a URI containing an absolute path.</span></span> <span data-ttu-id="ce547-374">I metodi `GetUri*` generano sempre un URI assoluto contenente uno schema e un host.</span><span class="sxs-lookup"><span data-stu-id="ce547-374">The `GetUri*` methods always generate an absolute URI containing a scheme and host.</span></span> <span data-ttu-id="ce547-375">I metodi che accettano `HttpContext` generano un URI nel contesto della richiesta in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="ce547-375">The methods that accept an `HttpContext` generate a URI in the context of the executing request.</span></span> <span data-ttu-id="ce547-376">I valori della route di [ambiente](#ambient) , il percorso di base URL, lo schema e l'host dalla richiesta in esecuzione vengono usati a meno che non vengano sottoposti a override.</span><span class="sxs-lookup"><span data-stu-id="ce547-376">The [ambient](#ambient) route values, URL base path, scheme, and host from the executing request are used unless overridden.</span></span>

<span data-ttu-id="ce547-377"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> viene chiamato con un indirizzo.</span><span class="sxs-lookup"><span data-stu-id="ce547-377"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is called with an address.</span></span> <span data-ttu-id="ce547-378">La generazione di un URI viene eseguita in due passaggi:</span><span class="sxs-lookup"><span data-stu-id="ce547-378">Generating a URI occurs in two steps:</span></span>

1. <span data-ttu-id="ce547-379">Un indirizzo viene associato a un elenco di endpoint che corrispondono all'indirizzo.</span><span class="sxs-lookup"><span data-stu-id="ce547-379">An address is bound to a list of endpoints that match the address.</span></span>
1. <span data-ttu-id="ce547-380"><xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern> di ogni endpoint viene valutato fino a quando non viene individuato un formato di route che corrisponde ai valori specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-380">Each endpoint's <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern> is evaluated until a route pattern that matches the supplied values is found.</span></span> <span data-ttu-id="ce547-381">L'output risultante viene unito alle altre parti dell'URI specificate nel generatore di collegamenti e restituito.</span><span class="sxs-lookup"><span data-stu-id="ce547-381">The resulting output is combined with the other URI parts supplied to the link generator and returned.</span></span>

<span data-ttu-id="ce547-382">I metodi forniti da <xref:Microsoft.AspNetCore.Routing.LinkGenerator> supportano le funzionalità di generazione di collegamenti standard per tutti i tipi di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="ce547-382">The methods provided by <xref:Microsoft.AspNetCore.Routing.LinkGenerator> support standard link generation capabilities for any type of address.</span></span> <span data-ttu-id="ce547-383">Il modo più pratico per usare il generatore di collegamenti è tramite i metodi di estensione che eseguono operazioni per un tipo di indirizzo specifico:</span><span class="sxs-lookup"><span data-stu-id="ce547-383">The most convenient way to use the link generator is through extension methods that perform operations for a specific address type:</span></span>

| <span data-ttu-id="ce547-384">Metodo di estensione</span><span class="sxs-lookup"><span data-stu-id="ce547-384">Extension Method</span></span> | <span data-ttu-id="ce547-385">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ce547-385">Description</span></span> |
| ---------------- | ----------- |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*> | <span data-ttu-id="ce547-386">Genera un URI con un percorso assoluto in base ai valori specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-386">Generates a URI with an absolute path based on the provided values.</span></span> |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetUriByAddress*> | <span data-ttu-id="ce547-387">Genera un URI assoluto in base ai valori specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-387">Generates an absolute URI based on the provided values.</span></span>             |

> [!WARNING]
> <span data-ttu-id="ce547-388">Prestare attenzione alle implicazioni seguenti della chiamata ai metodi <xref:Microsoft.AspNetCore.Routing.LinkGenerator>:</span><span class="sxs-lookup"><span data-stu-id="ce547-388">Pay attention to the following implications of calling <xref:Microsoft.AspNetCore.Routing.LinkGenerator> methods:</span></span>
>
> * <span data-ttu-id="ce547-389">Usare i metodi di estensione `GetUri*` con cautela in una configurazione di app che non convalida l'intestazione `Host` delle richieste in ingresso.</span><span class="sxs-lookup"><span data-stu-id="ce547-389">Use `GetUri*` extension methods with caution in an app configuration that doesn't validate the `Host` header of incoming requests.</span></span> <span data-ttu-id="ce547-390">Se l' `Host` intestazione delle richieste in ingresso non viene convalidata, l'input della richiesta non attendibile può essere restituito al client negli URI in una vista o in una pagina.</span><span class="sxs-lookup"><span data-stu-id="ce547-390">If the `Host` header of incoming requests isn't validated, untrusted request input can be sent back to the client in URIs in a view or page.</span></span> <span data-ttu-id="ce547-391">È consigliabile che in tutte le app di produzione il server sia configurato per la convalida dell'intestazione `Host` rispetto ai valori validi noti.</span><span class="sxs-lookup"><span data-stu-id="ce547-391">We recommend that all production apps configure their server to validate the `Host` header against known valid values.</span></span>
>
> * <span data-ttu-id="ce547-392">Usare <xref:Microsoft.AspNetCore.Routing.LinkGenerator> con cautela nel middleware in associazione a `Map` o `MapWhen`.</span><span class="sxs-lookup"><span data-stu-id="ce547-392">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> with caution in middleware in combination with `Map` or `MapWhen`.</span></span> <span data-ttu-id="ce547-393">`Map*` modifica il percorso di base della richiesta in esecuzione, che ha effetto sull'output della generazione di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-393">`Map*` changes the base path of the executing request, which affects the output of link generation.</span></span> <span data-ttu-id="ce547-394">Tutte le API <xref:Microsoft.AspNetCore.Routing.LinkGenerator> consentono di specificare un percorso di base.</span><span class="sxs-lookup"><span data-stu-id="ce547-394">All of the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> APIs allow specifying a base path.</span></span> <span data-ttu-id="ce547-395">Specificare un percorso di base vuoto per annullare l' `Map*` effetto sulla generazione del collegamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-395">Specify an empty base path to undo the `Map*` affect on link generation.</span></span>

### <a name="middleware-example"></a><span data-ttu-id="ce547-396">Esempio di middleware</span><span class="sxs-lookup"><span data-stu-id="ce547-396">Middleware example</span></span>

<span data-ttu-id="ce547-397">Nell'esempio seguente, un middleware usa l' <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API per creare un collegamento a un metodo di azione che elenca i prodotti dell'archivio.</span><span class="sxs-lookup"><span data-stu-id="ce547-397">In the following example, a middleware uses the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API to create a link to an action method that lists store products.</span></span> <span data-ttu-id="ce547-398">Usando il generatore di collegamenti inserendolo in una classe e chiamando `GenerateLink` è disponibile per qualsiasi classe in un'app:</span><span class="sxs-lookup"><span data-stu-id="ce547-398">Using the link generator by injecting it into a class and calling `GenerateLink` is available to any class in an app:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Middleware/ProductsLinkMiddleware.cs?name=snippet)]

<a name="rtr"></a>

## <a name="route-template-reference"></a><span data-ttu-id="ce547-399">Riferimento per il modello di route</span><span class="sxs-lookup"><span data-stu-id="ce547-399">Route template reference</span></span>

<span data-ttu-id="ce547-400">I token all'interno `{}` di definiscono i parametri di route associati se la route viene confrontata.</span><span class="sxs-lookup"><span data-stu-id="ce547-400">Tokens within `{}` define route parameters that are bound if the route is matched.</span></span> <span data-ttu-id="ce547-401">È possibile definire più di un parametro di route in un segmento di route, ma i parametri di route devono essere separati da un valore letterale.</span><span class="sxs-lookup"><span data-stu-id="ce547-401">More than one route parameter can be defined in a route segment, but route parameters  must be separated by a literal value.</span></span> <span data-ttu-id="ce547-402">Ad esempio, `{controller=Home}{action=Index}` non è una route valida perché non è presente un valore letterale tra `{controller}` e `{action}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-402">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span>  <span data-ttu-id="ce547-403">I parametri di route devono avere un nome e possono avere attributi aggiuntivi specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-403">Route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="ce547-404">Il testo letterale diverso dai parametri di route, ad esempio `{id}`, e il separatore di percorso `/` devono corrispondere al testo nell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-404">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="ce547-405">La corrispondenza del testo non fa distinzione tra maiuscole e minuscole e si basa sulla rappresentazione decodificata del percorso dell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-405">Text matching is case-insensitive and based on the decoded representation of the URL's path.</span></span> <span data-ttu-id="ce547-406">Per trovare la corrispondenza con un delimitatore di parametro di route letterale `{` o, eseguire l' `}` escape del delimitatore ripetendo il carattere.</span><span class="sxs-lookup"><span data-stu-id="ce547-406">To match a literal route parameter delimiter `{` or `}`, escape the delimiter by repeating the character.</span></span> <span data-ttu-id="ce547-407">Ad esempio `{{` o `}}` .</span><span class="sxs-lookup"><span data-stu-id="ce547-407">For example `{{` or `}}`.</span></span>

<span data-ttu-id="ce547-408">Asterisco `*` o doppio asterisco `**` :</span><span class="sxs-lookup"><span data-stu-id="ce547-408">Asterisk `*` or double asterisk `**`:</span></span>

* <span data-ttu-id="ce547-409">Può essere usato come prefisso per un parametro di route per l'associazione al resto dell'URI.</span><span class="sxs-lookup"><span data-stu-id="ce547-409">Can be used as a prefix to a route parameter to bind to the rest of the URI.</span></span>
* <span data-ttu-id="ce547-410">Sono detti parametri **catch-all** .</span><span class="sxs-lookup"><span data-stu-id="ce547-410">Are called a **catch-all** parameters.</span></span> <span data-ttu-id="ce547-411">Ad esempio, `blog/{**slug}`:</span><span class="sxs-lookup"><span data-stu-id="ce547-411">For example, `blog/{**slug}`:</span></span>
  * <span data-ttu-id="ce547-412">Corrisponde a qualsiasi URI che inizia con `/blog` e ha un valore che lo segue.</span><span class="sxs-lookup"><span data-stu-id="ce547-412">Matches any URI that starts with `/blog` and has any value following it.</span></span>
  * <span data-ttu-id="ce547-413">Il valore seguente `/blog` viene assegnato al valore di route [Slug](https://developer.mozilla.org/docs/Glossary/Slug) .</span><span class="sxs-lookup"><span data-stu-id="ce547-413">The value following `/blog` is assigned to the [slug](https://developer.mozilla.org/docs/Glossary/Slug) route value.</span></span>

[!INCLUDE[](~/includes/catchall.md)]

<span data-ttu-id="ce547-414">I parametri catch-all possono anche corrispondere alla stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="ce547-414">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="ce547-415">Il parametro catch-all esegue l'escape dei caratteri appropriati quando la route viene usata per generare un URL, inclusi i caratteri separatori di percorso `/` .</span><span class="sxs-lookup"><span data-stu-id="ce547-415">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator `/` characters.</span></span> <span data-ttu-id="ce547-416">Ad esempio, la route `foo/{*path}` con i valori di route `{ path = "my/path" }` genera `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="ce547-416">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="ce547-417">Si noti la barra di escape.</span><span class="sxs-lookup"><span data-stu-id="ce547-417">Note the escaped forward slash.</span></span> <span data-ttu-id="ce547-418">Per eseguire il round trip dei caratteri di separatore di percorso, usare il prefisso del parametro di route `**`.</span><span class="sxs-lookup"><span data-stu-id="ce547-418">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="ce547-419">La route `foo/{**path}` con `{ path = "my/path" }` genera `foo/my/path`.</span><span class="sxs-lookup"><span data-stu-id="ce547-419">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

<span data-ttu-id="ce547-420">I modelli di URL che tentano di acquisire un nome file con un'estensione facoltativa hanno considerazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="ce547-420">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="ce547-421">Considerare ad esempio il modello `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-421">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="ce547-422">Se esistono i valori per `filename` e `ext`, vengono popolati entrambi i valori.</span><span class="sxs-lookup"><span data-stu-id="ce547-422">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="ce547-423">Se `filename` nell'URL è presente solo un valore per, la route corrisponde perché l'oggetto finale `.` è facoltativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-423">If only a value for `filename` exists in the URL, the route matches because the trailing `.` is  optional.</span></span> <span data-ttu-id="ce547-424">Gli URL seguenti corrispondono a questa route:</span><span class="sxs-lookup"><span data-stu-id="ce547-424">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="ce547-425">I parametri di route possono avere **valori predefiniti**, definiti specificando il valore predefinito dopo il nome del parametro, separato da un segno di uguale (`=`).</span><span class="sxs-lookup"><span data-stu-id="ce547-425">Route parameters may have **default values** designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="ce547-426">Ad esempio, `{controller=Home}` definisce `Home` come valore predefinito per `controller`.</span><span class="sxs-lookup"><span data-stu-id="ce547-426">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="ce547-427">Il valore predefinito viene usato se nell'URL non è presente alcun valore per il parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-427">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="ce547-428">I parametri di route vengono resi facoltativi aggiungendo un punto interrogativo ( `?` ) alla fine del nome del parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-428">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name.</span></span> <span data-ttu-id="ce547-429">Ad esempio: `id?`.</span><span class="sxs-lookup"><span data-stu-id="ce547-429">For example, `id?`.</span></span> <span data-ttu-id="ce547-430">La differenza tra i valori facoltativi e i parametri di route predefiniti è la seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-430">The difference between optional values and default route parameters is:</span></span>

* <span data-ttu-id="ce547-431">Un parametro di route con un valore predefinito produce sempre un valore.</span><span class="sxs-lookup"><span data-stu-id="ce547-431">A route parameter with a default value always produces a value.</span></span>
* <span data-ttu-id="ce547-432">Un parametro facoltativo ha un valore solo quando un valore viene fornito dall'URL della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-432">An optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="ce547-433">I parametri di route possono presentare dei vincoli che devono corrispondere al valore di route associato dall'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-433">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="ce547-434">`:`L'aggiunta di un nome di vincolo e dopo il nome del parametro di route specifica un vincolo inline in un parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-434">Adding `:` and constraint name after the route parameter name specifies an inline constraint on a route parameter.</span></span> <span data-ttu-id="ce547-435">Se il vincolo richiede argomenti, vengono racchiusi tra parentesi `(...)` dopo il nome del vincolo.</span><span class="sxs-lookup"><span data-stu-id="ce547-435">If the constraint requires arguments, they're enclosed in parentheses `(...)` after the constraint name.</span></span> <span data-ttu-id="ce547-436">È possibile specificare più *vincoli inline* aggiungendo un altro `:` nome di vincolo e.</span><span class="sxs-lookup"><span data-stu-id="ce547-436">Multiple *inline constraints* can be specified by appending another `:` and constraint name.</span></span>

<span data-ttu-id="ce547-437">Il nome del vincolo e gli argomenti vengono passati al servizio <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> per creare un'istanza di <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> da usare nell'elaborazione dell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-437">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="ce547-438">Il modello di route `blog/{article:minlength(10)}` specifica ad esempio un vincolo `minlength` con l'argomento `10`.</span><span class="sxs-lookup"><span data-stu-id="ce547-438">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="ce547-439">Per altre informazioni sui vincoli di route e per un elenco dei vincoli specificati dal framework, vedere la sezione [Riferimento per i vincoli di route](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-439">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="ce547-440">I parametri di route possono avere anche trasformatori di parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-440">Route parameters may also have parameter transformers.</span></span> <span data-ttu-id="ce547-441">I trasformatori di parametro trasformano il valore di un parametro durante la generazione di collegamenti, azioni e pagine corrispondenti agli URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-441">Parameter transformers transform a parameter's value when generating links and matching actions and pages to URLs.</span></span> <span data-ttu-id="ce547-442">Analogamente ai vincoli, i trasformatori di parametro possono essere aggiunti inline a un parametro di route mediante l'aggiunta di un nome del trasformatore `:` e dopo il nome del parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-442">Like constraints, parameter transformers can be added inline to a route parameter by adding a `:` and transformer name after the route parameter name.</span></span> <span data-ttu-id="ce547-443">Ad esempio, il modello di route `blog/{article:slugify}` specifica un trasformatore `slugify`.</span><span class="sxs-lookup"><span data-stu-id="ce547-443">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span> <span data-ttu-id="ce547-444">Per altre informazioni sui trasformatori di parametro, vedere la sezione [Riferimento ai trasformatori di parametro](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-444">For more information on parameter transformers, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

<span data-ttu-id="ce547-445">La tabella seguente illustra i modelli di route di esempio e il relativo comportamento:</span><span class="sxs-lookup"><span data-stu-id="ce547-445">The following table demonstrates example route templates and their behavior:</span></span>

| <span data-ttu-id="ce547-446">Modello di route</span><span class="sxs-lookup"><span data-stu-id="ce547-446">Route Template</span></span>                           | <span data-ttu-id="ce547-447">URI corrispondente di esempio</span><span class="sxs-lookup"><span data-stu-id="ce547-447">Example Matching URI</span></span>    | <span data-ttu-id="ce547-448">L'URI della richiesta&hellip;</span><span class="sxs-lookup"><span data-stu-id="ce547-448">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="ce547-449">Verifica la corrispondenza solo del singolo percorso `/hello`.</span><span class="sxs-lookup"><span data-stu-id="ce547-449">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="ce547-450">Verifica la corrispondenza e imposta `Page` su `Home`.</span><span class="sxs-lookup"><span data-stu-id="ce547-450">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="ce547-451">Verifica la corrispondenza e imposta `Page` su `Contact`.</span><span class="sxs-lookup"><span data-stu-id="ce547-451">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="ce547-452">Esegue il mapping al controller `Products` e all'azione `List`.</span><span class="sxs-lookup"><span data-stu-id="ce547-452">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="ce547-453">Esegue il mapping al `Products` controller e all'  `Details` azione con `id` impostato su 123.</span><span class="sxs-lookup"><span data-stu-id="ce547-453">Maps to the `Products` controller and  `Details` action with`id` set to 123.</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="ce547-454">Esegue il mapping al `Home` controller e al `Index` metodo.</span><span class="sxs-lookup"><span data-stu-id="ce547-454">Maps to the `Home` controller and `Index` method.</span></span> <span data-ttu-id="ce547-455">`id` viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="ce547-455">`id` is ignored.</span></span>        |
| `{controller=Home}/{action=Index}/{id?}` | `/Products`         | <span data-ttu-id="ce547-456">Esegue il mapping al `Products` controller e al `Index` metodo.</span><span class="sxs-lookup"><span data-stu-id="ce547-456">Maps to the `Products` controller and `Index` method.</span></span> <span data-ttu-id="ce547-457">`id` viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="ce547-457">`id` is ignored.</span></span>        |

<span data-ttu-id="ce547-458">L'uso di un modello è in genere l'approccio più semplice al routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-458">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="ce547-459">I vincoli e le impostazioni predefinite possono essere specificati anche all'esterno del modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-459">Constraints and defaults can also be specified outside the route template.</span></span>

### <a name="complex-segments"></a><span data-ttu-id="ce547-460">Segmenti complessi</span><span class="sxs-lookup"><span data-stu-id="ce547-460">Complex segments</span></span>

<span data-ttu-id="ce547-461">I segmenti complessi vengono elaborati mediante la corrispondenza di delimitatori letterali da destra a sinistra in modo [non greedy](#greedy) .</span><span class="sxs-lookup"><span data-stu-id="ce547-461">Complex segments are processed by matching up literal delimiters from right to left in a [non-greedy](#greedy) way.</span></span> <span data-ttu-id="ce547-462">Ad esempio, `[Route("/a{b}c{d}")]` è un segmento complesso.</span><span class="sxs-lookup"><span data-stu-id="ce547-462">For example, `[Route("/a{b}c{d}")]` is a complex segment.</span></span>
<span data-ttu-id="ce547-463">I segmenti complessi funzionano in un modo specifico che devono essere riconosciuti per utilizzarli correttamente.</span><span class="sxs-lookup"><span data-stu-id="ce547-463">Complex segments work in a particular way that must be understood to use them successfully.</span></span> <span data-ttu-id="ce547-464">Nell'esempio riportato in questa sezione viene illustrato il motivo per cui i segmenti complessi funzionano correttamente solo quando il testo del delimitatore non viene visualizzato all'interno dei valori del parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-464">The example in this section demonstrates why complex segments only really work well when the delimiter text doesn't appear inside the parameter values.</span></span> <span data-ttu-id="ce547-465">Per i casi più complessi, è necessario utilizzare un' [espressione regolare](/dotnet/standard/base-types/regular-expressions) e quindi estrarre manualmente i valori.</span><span class="sxs-lookup"><span data-stu-id="ce547-465">Using a [regex](/dotnet/standard/base-types/regular-expressions) and then manually extracting the values is needed for more complex cases.</span></span>

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="ce547-466">Questo è un riepilogo dei passaggi eseguiti dal routing con il modello `/a{b}c{d}` e il percorso URL `/abcd` .</span><span class="sxs-lookup"><span data-stu-id="ce547-466">This is a summary of the steps that routing performs with the template `/a{b}c{d}` and the URL path `/abcd`.</span></span> <span data-ttu-id="ce547-467">`|`Viene usato per visualizzare il funzionamento dell'algoritmo:</span><span class="sxs-lookup"><span data-stu-id="ce547-467">The `|` is used to help visualize how the algorithm works:</span></span>

* <span data-ttu-id="ce547-468">Il primo valore letterale, da destra a sinistra, è `c` .</span><span class="sxs-lookup"><span data-stu-id="ce547-468">The first literal, right to left, is `c`.</span></span> <span data-ttu-id="ce547-469">Quindi `/abcd` , la ricerca viene eseguita da destra e trova `/ab|c|d` .</span><span class="sxs-lookup"><span data-stu-id="ce547-469">So `/abcd` is searched from right and finds `/ab|c|d`.</span></span>
* <span data-ttu-id="ce547-470">Tutto a destra ( `d` ) viene ora associato al parametro di route `{d}` .</span><span class="sxs-lookup"><span data-stu-id="ce547-470">Everything to the right (`d`) is now matched to the route parameter `{d}`.</span></span>
* <span data-ttu-id="ce547-471">Il valore letterale successivo, da destra a sinistra, è `a` .</span><span class="sxs-lookup"><span data-stu-id="ce547-471">The next literal, right to left, is `a`.</span></span> <span data-ttu-id="ce547-472">Quindi `/ab|c|d` , viene eseguita una ricerca a partire dal punto in cui è stato interrotto, quindi `a` viene trovato `/|a|b|c|d` .</span><span class="sxs-lookup"><span data-stu-id="ce547-472">So `/ab|c|d` is searched starting where we left off, then `a` is found `/|a|b|c|d`.</span></span>
* <span data-ttu-id="ce547-473">Il valore a destra ( `b` ) viene ora associato al parametro di route `{b}` .</span><span class="sxs-lookup"><span data-stu-id="ce547-473">The value to the right (`b`) is now matched to the route parameter `{b}`.</span></span>
* <span data-ttu-id="ce547-474">Non esiste alcun testo rimanente e nessun modello di route rimanente, quindi si tratta di una corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-474">There is no remaining text and no remaining route template, so this is a match.</span></span>

<span data-ttu-id="ce547-475">Di seguito è riportato un esempio di un caso negativo che usa lo stesso modello `/a{b}c{d}` e il percorso URL `/aabcd` .</span><span class="sxs-lookup"><span data-stu-id="ce547-475">Here's an example of a negative case using the same template `/a{b}c{d}` and the URL path `/aabcd`.</span></span> <span data-ttu-id="ce547-476">`|`Viene utilizzato per facilitare la visualizzazione del funzionamento dell'algoritmo.</span><span class="sxs-lookup"><span data-stu-id="ce547-476">The `|` is used to help visualize how the algorithm works.</span></span> <span data-ttu-id="ce547-477">Questo caso non corrisponde a una corrispondenza, descritta dallo stesso algoritmo:</span><span class="sxs-lookup"><span data-stu-id="ce547-477">This case isn't a match, which is explained by the same algorithm:</span></span>
* <span data-ttu-id="ce547-478">Il primo valore letterale, da destra a sinistra, è `c` .</span><span class="sxs-lookup"><span data-stu-id="ce547-478">The first literal, right to left, is `c`.</span></span> <span data-ttu-id="ce547-479">Quindi `/aabcd` , la ricerca viene eseguita da destra e trova `/aab|c|d` .</span><span class="sxs-lookup"><span data-stu-id="ce547-479">So `/aabcd` is searched from right and finds `/aab|c|d`.</span></span>
* <span data-ttu-id="ce547-480">Tutto a destra ( `d` ) viene ora associato al parametro di route `{d}` .</span><span class="sxs-lookup"><span data-stu-id="ce547-480">Everything to the right (`d`) is now matched to the route parameter `{d}`.</span></span>
* <span data-ttu-id="ce547-481">Il valore letterale successivo, da destra a sinistra, è `a` .</span><span class="sxs-lookup"><span data-stu-id="ce547-481">The next literal, right to left, is `a`.</span></span> <span data-ttu-id="ce547-482">Quindi `/aab|c|d` , viene eseguita una ricerca a partire dal punto in cui è stato interrotto, quindi `a` viene trovato `/a|a|b|c|d` .</span><span class="sxs-lookup"><span data-stu-id="ce547-482">So `/aab|c|d` is searched starting where we left off, then `a` is found `/a|a|b|c|d`.</span></span>
* <span data-ttu-id="ce547-483">Il valore a destra ( `b` ) viene ora associato al parametro di route `{b}` .</span><span class="sxs-lookup"><span data-stu-id="ce547-483">The value to the right (`b`) is now matched to the route parameter `{b}`.</span></span>
* <span data-ttu-id="ce547-484">A questo punto è presente un testo rimanente `a` , ma l'algoritmo ha esaurito il modello di route da analizzare, quindi non si tratta di una corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-484">At this point there is remaining text `a`, but the algorithm has run out of route template to parse, so this is not a match.</span></span>

<span data-ttu-id="ce547-485">Poiché l'algoritmo di corrispondenza [non è greedy](#greedy):</span><span class="sxs-lookup"><span data-stu-id="ce547-485">Since the matching algorithm is [non-greedy](#greedy):</span></span>

* <span data-ttu-id="ce547-486">Corrisponde alla minima quantità di testo possibile in ogni passaggio.</span><span class="sxs-lookup"><span data-stu-id="ce547-486">It matches the smallest amount of text possible in each step.</span></span>
* <span data-ttu-id="ce547-487">Ogni caso in cui il valore del delimitatore viene visualizzato all'interno dei valori del parametro non corrisponde.</span><span class="sxs-lookup"><span data-stu-id="ce547-487">Any case where the delimiter value appears inside the parameter values results in not matching.</span></span>

<span data-ttu-id="ce547-488">Le espressioni regolari forniscono un maggiore controllo sul comportamento corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-488">Regular expressions provide much more control over their matching behavior.</span></span>

<a name="greedy"></a>

<span data-ttu-id="ce547-489">La corrispondenza greedy, conosciuta anche come [Corrispondenza Lazy](https://wikipedia.org/wiki/Regular_expression#Lazy_matching), corrisponde alla stringa più grande possibile.</span><span class="sxs-lookup"><span data-stu-id="ce547-489">Greedy matching, also know as [lazy matching](https://wikipedia.org/wiki/Regular_expression#Lazy_matching), matches the largest possible string.</span></span> <span data-ttu-id="ce547-490">Non greedy corrisponde alla stringa più piccola possibile.</span><span class="sxs-lookup"><span data-stu-id="ce547-490">Non-greedy matches the smallest possible string.</span></span>

## <a name="route-constraint-reference"></a><span data-ttu-id="ce547-491">Riferimento per i vincoli di route</span><span class="sxs-lookup"><span data-stu-id="ce547-491">Route constraint reference</span></span>

<span data-ttu-id="ce547-492">I vincoli di route vengono eseguiti quando si verifica una corrispondenza nell'URL in ingresso e il percorso URL viene suddiviso in valori di route in formato token.</span><span class="sxs-lookup"><span data-stu-id="ce547-492">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="ce547-493">I vincoli di route controllano in genere il valore di route associato tramite il modello di route e fanno una decisione vera o falsa sul fatto che il valore sia accettabile.</span><span class="sxs-lookup"><span data-stu-id="ce547-493">Route constraints generally inspect the route value associated via the route template and make a true or false decision about whether the value is acceptable.</span></span> <span data-ttu-id="ce547-494">Alcuni vincoli di route usano i dati all'esterno del valore di route per stabilire se la richiesta può essere instradata.</span><span class="sxs-lookup"><span data-stu-id="ce547-494">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="ce547-495">Ad esempio, <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> può accettare o rifiutare una richiesta in base al relativo verbo HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce547-495">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="ce547-496">I vincoli vengono usati nelle richieste del routing e nella generazione di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-496">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="ce547-497">Non usare i vincoli per la convalida dell'input.</span><span class="sxs-lookup"><span data-stu-id="ce547-497">Don't use constraints for input validation.</span></span> <span data-ttu-id="ce547-498">Se vengono usati vincoli per la convalida dell'input, l'input non valido restituisce una `404` risposta non trovata.</span><span class="sxs-lookup"><span data-stu-id="ce547-498">If constraints are used for input validation, invalid input results in a `404` Not Found response.</span></span> <span data-ttu-id="ce547-499">L'input non valido deve produrre una richiesta non valida `400` con un messaggio di errore appropriato.</span><span class="sxs-lookup"><span data-stu-id="ce547-499">Invalid input should produce a `400` Bad Request with an appropriate error message.</span></span> <span data-ttu-id="ce547-500">I vincoli di route vengono usati per evitare ambiguità tra route simili, non per convalidare gli input per una route specifica.</span><span class="sxs-lookup"><span data-stu-id="ce547-500">Route constraints are used to disambiguate similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="ce547-501">La tabella seguente illustra i vincoli di route di esempio e il comportamento previsto:</span><span class="sxs-lookup"><span data-stu-id="ce547-501">The following table demonstrates example route constraints and their expected behavior:</span></span>

| <span data-ttu-id="ce547-502">vincolo</span><span class="sxs-lookup"><span data-stu-id="ce547-502">constraint</span></span> | <span data-ttu-id="ce547-503">Esempio</span><span class="sxs-lookup"><span data-stu-id="ce547-503">Example</span></span> | <span data-ttu-id="ce547-504">Esempi di corrispondenza</span><span class="sxs-lookup"><span data-stu-id="ce547-504">Example Matches</span></span> | <span data-ttu-id="ce547-505">Note</span><span class="sxs-lookup"><span data-stu-id="ce547-505">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="ce547-506">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="ce547-506">`123456789`, `-123456789`</span></span> | <span data-ttu-id="ce547-507">Corrisponde a qualsiasi numero intero</span><span class="sxs-lookup"><span data-stu-id="ce547-507">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="ce547-508">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="ce547-508">`true`, `FALSE`</span></span> | <span data-ttu-id="ce547-509">Corrisponde a `true` o `false` .</span><span class="sxs-lookup"><span data-stu-id="ce547-509">Matches `true` or `false`.</span></span> <span data-ttu-id="ce547-510">Non fa distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="ce547-510">Case-insensitive</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="ce547-511">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="ce547-511">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="ce547-512">Corrisponde a un `DateTime` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-512">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="ce547-513">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-513">See preceding warning.</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="ce547-514">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="ce547-514">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="ce547-515">Corrisponde a un `decimal` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-515">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="ce547-516">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-516">See preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="ce547-517">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="ce547-517">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="ce547-518">Corrisponde a un `double` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-518">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="ce547-519">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-519">See preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="ce547-520">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="ce547-520">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="ce547-521">Corrisponde a un `float` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-521">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="ce547-522">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-522">See preceding warning.</span></span>|
| `guid` | `{id:guid}` | `CD2C1638-1638-72D5-1638-DEADBEEF1638` | <span data-ttu-id="ce547-523">Corrisponde a un valore `Guid` valido</span><span class="sxs-lookup"><span data-stu-id="ce547-523">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="ce547-524">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="ce547-524">`123456789`, `-123456789`</span></span> | <span data-ttu-id="ce547-525">Corrisponde a un valore `long` valido</span><span class="sxs-lookup"><span data-stu-id="ce547-525">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="ce547-526">La stringa deve contenere almeno 4 caratteri</span><span class="sxs-lookup"><span data-stu-id="ce547-526">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `MyFile` | <span data-ttu-id="ce547-527">La stringa non deve contenere più di 8 caratteri</span><span class="sxs-lookup"><span data-stu-id="ce547-527">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="ce547-528">La stringa deve contenere esattamente 12 caratteri</span><span class="sxs-lookup"><span data-stu-id="ce547-528">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="ce547-529">La stringa deve contenere almeno 8 e non più di 16 caratteri</span><span class="sxs-lookup"><span data-stu-id="ce547-529">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="ce547-530">Il valore intero deve essere almeno 18</span><span class="sxs-lookup"><span data-stu-id="ce547-530">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="ce547-531">Il valore intero non deve essere superiore a 120</span><span class="sxs-lookup"><span data-stu-id="ce547-531">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="ce547-532">Il valore intero deve essere almeno 18 ma non più di 120</span><span class="sxs-lookup"><span data-stu-id="ce547-532">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="ce547-533">La stringa deve essere composta da uno o più caratteri alfabetici `a` - `z` e senza distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="ce547-533">String must consist of one or more alphabetical characters, `a`-`z` and case-insensitive.</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="ce547-534">La stringa deve corrispondere all'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="ce547-534">String must match the regular expression.</span></span> <span data-ttu-id="ce547-535">Vedere suggerimenti sulla definizione di un'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="ce547-535">See tips about defining a regular expression.</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="ce547-536">Usato per imporre che un valore diverso da un parametro sia presente durante la generazione dell'URL</span><span class="sxs-lookup"><span data-stu-id="ce547-536">Used to enforce that a non-parameter value is present during URL generation</span></span> |

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="ce547-537">È possibile applicare più vincoli delimitati da due punti a un singolo parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-537">Multiple, colon delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="ce547-538">Ad esempio il vincolo seguente limita un parametro a un valore intero maggiore o uguale a 1:</span><span class="sxs-lookup"><span data-stu-id="ce547-538">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="ce547-539">I vincoli di route che verificano l'URL e vengono convertiti in un tipo CLR utilizzano sempre la lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-539">Route constraints that verify the URL and are converted to a CLR type always use the invariant culture.</span></span> <span data-ttu-id="ce547-540">Ad esempio, la conversione al tipo CLR `int` o `DateTime` .</span><span class="sxs-lookup"><span data-stu-id="ce547-540">For example, conversion to the CLR type `int` or `DateTime`.</span></span> <span data-ttu-id="ce547-541">Questi vincoli presuppongono che l'URL non sia localizzabile.</span><span class="sxs-lookup"><span data-stu-id="ce547-541">These constraints assume that the URL is not localizable.</span></span> <span data-ttu-id="ce547-542">I vincoli di route specificati dal framework non modificano i valori archiviati nei valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-542">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="ce547-543">Tutti i valori di route analizzati dall'URL vengono archiviati come stringhe.</span><span class="sxs-lookup"><span data-stu-id="ce547-543">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="ce547-544">Ad esempio, il vincolo `float` prova a convertire il valore di route in un valore float, ma il valore convertito viene usato solo per verificare che può essere convertito in un valore float.</span><span class="sxs-lookup"><span data-stu-id="ce547-544">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

### <a name="regular-expressions-in-constraints"></a><span data-ttu-id="ce547-545">Espressioni regolari nei vincoli</span><span class="sxs-lookup"><span data-stu-id="ce547-545">Regular expressions in constraints</span></span>

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="ce547-546">Le espressioni regolari possono essere specificate come vincoli inline usando il `regex(...)` vincolo di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-546">Regular expressions can be specified as inline constraints using the `regex(...)` route constraint.</span></span> <span data-ttu-id="ce547-547">I metodi della <xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> famiglia accettano anche un valore letterale di oggetti Constraints.</span><span class="sxs-lookup"><span data-stu-id="ce547-547">Methods in the <xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> family also accept an object literal of constraints.</span></span> <span data-ttu-id="ce547-548">Se viene usato questo formato, i valori stringa vengono interpretati come espressioni regolari.</span><span class="sxs-lookup"><span data-stu-id="ce547-548">If that form is used, string values are interpreted as regular expressions.</span></span>

<span data-ttu-id="ce547-549">Il codice seguente usa un vincolo Regex inline:</span><span class="sxs-lookup"><span data-stu-id="ce547-549">The following code uses an inline regex constraint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRegex.cs?name=snippet)]

<span data-ttu-id="ce547-550">Il codice seguente usa un valore letterale dell'oggetto per specificare un vincolo Regex:</span><span class="sxs-lookup"><span data-stu-id="ce547-550">The following code uses an object literal to specify a regex constraint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRegex2.cs?name=snippet)]

<span data-ttu-id="ce547-551">Il framework di ASP.NET Core aggiunge `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` al costruttore di espressioni regolari.</span><span class="sxs-lookup"><span data-stu-id="ce547-551">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="ce547-552">Per una descrizione di questi membri, vedere <xref:System.Text.RegularExpressions.RegexOptions>.</span><span class="sxs-lookup"><span data-stu-id="ce547-552">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="ce547-553">Le espressioni regolari usano delimitatori e token simili a quelli usati dal routing e dal linguaggio C#.</span><span class="sxs-lookup"><span data-stu-id="ce547-553">Regular expressions use delimiters and tokens similar to those used by routing and the C# language.</span></span> <span data-ttu-id="ce547-554">Per i token di espressione è necessario aggiungere caratteri di escape.</span><span class="sxs-lookup"><span data-stu-id="ce547-554">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="ce547-555">Per utilizzare l'espressione regolare `^\d{3}-\d{2}-\d{4}$` in un vincolo inline, utilizzare uno dei seguenti elementi:</span><span class="sxs-lookup"><span data-stu-id="ce547-555">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in an inline constraint, use one of the following:</span></span>

* <span data-ttu-id="ce547-556">Sostituire `\` i caratteri specificati nella stringa come `\\` caratteri nel file di origine C# per poter eseguire l'escape del `\` carattere di escape della stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-556">Replace `\` characters provided in the string as `\\` characters in the C# source file in order to escape the `\` string escape character.</span></span>
* <span data-ttu-id="ce547-557">[Valori letterali stringa Verbatim](/dotnet/csharp/language-reference/keywords/string).</span><span class="sxs-lookup"><span data-stu-id="ce547-557">[Verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span>

<span data-ttu-id="ce547-558">Per eseguire l'escape dei caratteri di delimitazione del parametro di routing,,, `{` `}` `[` `]` , raddoppiare i caratteri nell'espressione, ad esempio `{{` `}}` `[[` `]]` ,,,.</span><span class="sxs-lookup"><span data-stu-id="ce547-558">To escape routing parameter delimiter characters `{`, `}`, `[`, `]`, double the characters in the expression, for example, `{{`, `}}`, `[[`, `]]`.</span></span> <span data-ttu-id="ce547-559">La tabella seguente illustra un'espressione regolare e la relativa versione di escape:</span><span class="sxs-lookup"><span data-stu-id="ce547-559">The following table shows a regular expression and its escaped version:</span></span>

| <span data-ttu-id="ce547-560">Espressione regolare‏</span><span class="sxs-lookup"><span data-stu-id="ce547-560">Regular expression</span></span>    | <span data-ttu-id="ce547-561">Espressione regolare con escape</span><span class="sxs-lookup"><span data-stu-id="ce547-561">Escaped regular expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="ce547-562">Le espressioni regolari utilizzate nel routing spesso iniziano con il `^` carattere e corrispondono alla posizione iniziale della stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-562">Regular expressions used in routing often start with the `^` character and match the starting position of the string.</span></span> <span data-ttu-id="ce547-563">Le espressioni terminano spesso con il `$` carattere e corrispondono alla fine della stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-563">The expressions often end with the `$` character and match the end of the string.</span></span> <span data-ttu-id="ce547-564">I `^` `$` caratteri e assicurano che l'espressione regolare corrisponda all'intero valore del parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-564">The `^` and `$` characters ensure that the regular expression matches the entire route parameter value.</span></span> <span data-ttu-id="ce547-565">Senza i `^` `$` caratteri e, l'espressione regolare trova la corrispondenza con qualsiasi sottostringa all'interno della stringa, che è spesso indesiderata.</span><span class="sxs-lookup"><span data-stu-id="ce547-565">Without the `^` and `$` characters, the regular expression matches any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="ce547-566">La tabella seguente fornisce esempi e spiega perché corrispondono o non riescono a corrispondere:</span><span class="sxs-lookup"><span data-stu-id="ce547-566">The following table provides examples and explains why they match or fail to match:</span></span>

| <span data-ttu-id="ce547-567">Expression</span><span class="sxs-lookup"><span data-stu-id="ce547-567">Expression</span></span>   | <span data-ttu-id="ce547-568">string</span><span class="sxs-lookup"><span data-stu-id="ce547-568">String</span></span>    | <span data-ttu-id="ce547-569">Corrispondenza</span><span class="sxs-lookup"><span data-stu-id="ce547-569">Match</span></span> | <span data-ttu-id="ce547-570">Commento</span><span class="sxs-lookup"><span data-stu-id="ce547-570">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="ce547-571">hello</span><span class="sxs-lookup"><span data-stu-id="ce547-571">hello</span></span>     | <span data-ttu-id="ce547-572">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-572">Yes</span></span>   | <span data-ttu-id="ce547-573">Corrispondenze di sottostringhe</span><span class="sxs-lookup"><span data-stu-id="ce547-573">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="ce547-574">123abc456</span><span class="sxs-lookup"><span data-stu-id="ce547-574">123abc456</span></span> | <span data-ttu-id="ce547-575">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-575">Yes</span></span>   | <span data-ttu-id="ce547-576">Corrispondenze di sottostringhe</span><span class="sxs-lookup"><span data-stu-id="ce547-576">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="ce547-577">mz</span><span class="sxs-lookup"><span data-stu-id="ce547-577">mz</span></span>        | <span data-ttu-id="ce547-578">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-578">Yes</span></span>   | <span data-ttu-id="ce547-579">Corrisponde all'espressione</span><span class="sxs-lookup"><span data-stu-id="ce547-579">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="ce547-580">MZ</span><span class="sxs-lookup"><span data-stu-id="ce547-580">MZ</span></span>        | <span data-ttu-id="ce547-581">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-581">Yes</span></span>   | <span data-ttu-id="ce547-582">Senza distinzione maiuscole/minuscole</span><span class="sxs-lookup"><span data-stu-id="ce547-582">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="ce547-583">hello</span><span class="sxs-lookup"><span data-stu-id="ce547-583">hello</span></span>     | <span data-ttu-id="ce547-584">No</span><span class="sxs-lookup"><span data-stu-id="ce547-584">No</span></span>    | <span data-ttu-id="ce547-585">Vedere `^` e `$` sopra</span><span class="sxs-lookup"><span data-stu-id="ce547-585">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="ce547-586">123abc456</span><span class="sxs-lookup"><span data-stu-id="ce547-586">123abc456</span></span> | <span data-ttu-id="ce547-587">No</span><span class="sxs-lookup"><span data-stu-id="ce547-587">No</span></span>    | <span data-ttu-id="ce547-588">Vedere `^` e `$` sopra</span><span class="sxs-lookup"><span data-stu-id="ce547-588">See `^` and `$` above</span></span> |

<span data-ttu-id="ce547-589">Per altre informazioni sulla sintassi delle espressioni regolari, vedere [Espressioni regolari di .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-589">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="ce547-590">Per limitare un parametro a un set noto di valori possibili, usare un'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="ce547-590">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="ce547-591">Ad esempio, `{action:regex(^(list|get|create)$)}` verifica la corrispondenza del valore di route `action` solo con `list`, `get` o `create`.</span><span class="sxs-lookup"><span data-stu-id="ce547-591">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="ce547-592">Se viene passata nel dizionario di vincoli, la stringa `^(list|get|create)$` è equivalente.</span><span class="sxs-lookup"><span data-stu-id="ce547-592">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="ce547-593">Anche i vincoli passati nel dizionario dei vincoli che non corrispondono a uno dei vincoli noti vengono considerati espressioni regolari.</span><span class="sxs-lookup"><span data-stu-id="ce547-593">Constraints that are passed in the constraints dictionary that don't match one of the known constraints are also treated as regular expressions.</span></span> <span data-ttu-id="ce547-594">I vincoli passati in un modello che non corrispondono a uno dei vincoli noti non vengono considerati come espressioni regolari.</span><span class="sxs-lookup"><span data-stu-id="ce547-594">Constraints that are passed  within a template that don't match one of the known constraints are not treated as regular expressions.</span></span>

### <a name="custom-route-constraints"></a><span data-ttu-id="ce547-595">Vincoli di Route personalizzati</span><span class="sxs-lookup"><span data-stu-id="ce547-595">Custom route constraints</span></span>

<span data-ttu-id="ce547-596">È possibile creare vincoli di Route personalizzati implementando l' <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interfaccia.</span><span class="sxs-lookup"><span data-stu-id="ce547-596">Custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="ce547-597">L' `IRouteConstraint` interfaccia contiene <xref:System.Web.Routing.IRouteConstraint.Match*> , che restituisce `true` se il vincolo è soddisfatto e `false` in caso contrario.</span><span class="sxs-lookup"><span data-stu-id="ce547-597">The `IRouteConstraint` interface contains <xref:System.Web.Routing.IRouteConstraint.Match*>, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="ce547-598">I vincoli di Route personalizzati sono raramente necessari.</span><span class="sxs-lookup"><span data-stu-id="ce547-598">Custom route constraints are rarely needed.</span></span> <span data-ttu-id="ce547-599">Prima di implementare un vincolo di route personalizzato, prendere in considerazione le alternative, ad esempio l'associazione di modelli.</span><span class="sxs-lookup"><span data-stu-id="ce547-599">Before implementing a custom route constraint, consider alternatives, such as model binding.</span></span>

<span data-ttu-id="ce547-600">Nella cartella ASP.NET Core [Constraints](https://github.com/dotnet/aspnetcore/tree/main/src/Http/Routing/src/Constraints) sono disponibili ottimi esempi di creazione di vincoli.</span><span class="sxs-lookup"><span data-stu-id="ce547-600">The ASP.NET Core [Constraints](https://github.com/dotnet/aspnetcore/tree/main/src/Http/Routing/src/Constraints) folder provides good examples of creating a constraints.</span></span> <span data-ttu-id="ce547-601">Ad esempio, [GuidRouteConstraint](https://github.com/dotnet/aspnetcore/blob/main/src/Http/Routing/src/Constraints/GuidRouteConstraint.cs#L18).</span><span class="sxs-lookup"><span data-stu-id="ce547-601">For example, [GuidRouteConstraint](https://github.com/dotnet/aspnetcore/blob/main/src/Http/Routing/src/Constraints/GuidRouteConstraint.cs#L18).</span></span>

<span data-ttu-id="ce547-602">Per usare un oggetto personalizzato `IRouteConstraint` , il tipo di vincolo di route deve essere registrato con l'app <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> nel contenitore del servizio.</span><span class="sxs-lookup"><span data-stu-id="ce547-602">To use a custom `IRouteConstraint`, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the service container.</span></span> <span data-ttu-id="ce547-603">`ConstraintMap` è un dizionario che esegue il mapping delle chiavi dei vincoli di route alle implementazioni di `IRouteConstraint` che convalidano tali vincoli.</span><span class="sxs-lookup"><span data-stu-id="ce547-603">A `ConstraintMap` is a dictionary that maps route constraint keys to `IRouteConstraint` implementations that validate those constraints.</span></span> <span data-ttu-id="ce547-604">La proprietà `ConstraintMap` di un'app può essere aggiornata in `Startup.ConfigureServices` come parte di una chiamata [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) o configurando <xref:Microsoft.AspNetCore.Routing.RouteOptions> direttamente con `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="ce547-604">An app's `ConstraintMap` can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="ce547-605">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="ce547-605">For example:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint.cs?name=snippet)]

<span data-ttu-id="ce547-606">Il vincolo precedente viene applicato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-606">The preceding constraint is applied in the following code:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/TestController.cs?name=snippet&highlight=6,13)]

[!INCLUDE[](~/includes/MyDisplayRouteInfo.md)]

<span data-ttu-id="ce547-607">L'implementazione di `MyCustomConstraint` impedisce `0` che venga applicato a un parametro di route:</span><span class="sxs-lookup"><span data-stu-id="ce547-607">The implementation of `MyCustomConstraint` prevents `0` being applied to a route parameter:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint.cs?name=snippet2)]

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="ce547-608">Il codice precedente:</span><span class="sxs-lookup"><span data-stu-id="ce547-608">The preceding code:</span></span>

* <span data-ttu-id="ce547-609">Impedisce `0` il `{id}` segmento della route.</span><span class="sxs-lookup"><span data-stu-id="ce547-609">Prevents `0` in the `{id}` segment of the route.</span></span>
* <span data-ttu-id="ce547-610">Viene illustrato come fornire un esempio di base per l'implementazione di un vincolo personalizzato.</span><span class="sxs-lookup"><span data-stu-id="ce547-610">Is shown to provide a basic example of implementing a custom constraint.</span></span> <span data-ttu-id="ce547-611">Non deve essere usato in un'app di produzione.</span><span class="sxs-lookup"><span data-stu-id="ce547-611">It should not be used in a production app.</span></span>

<span data-ttu-id="ce547-612">Il codice seguente rappresenta un approccio migliore per impedire l'elaborazione di un oggetto `id` che contiene un oggetto `0` :</span><span class="sxs-lookup"><span data-stu-id="ce547-612">The following code is a better approach to preventing an `id` containing a `0` from being processed:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/TestController.cs?name=snippet2)]

<span data-ttu-id="ce547-613">Il codice precedente presenta i vantaggi seguenti rispetto all' `MyCustomConstraint` approccio:</span><span class="sxs-lookup"><span data-stu-id="ce547-613">The preceding code has the following advantages over the `MyCustomConstraint` approach:</span></span>

* <span data-ttu-id="ce547-614">Non richiede un vincolo personalizzato.</span><span class="sxs-lookup"><span data-stu-id="ce547-614">It doesn't require a custom constraint.</span></span>
* <span data-ttu-id="ce547-615">Restituisce un errore più descrittivo quando il parametro di route include `0` .</span><span class="sxs-lookup"><span data-stu-id="ce547-615">It returns a more descriptive error when the route parameter includes `0`.</span></span>

## <a name="parameter-transformer-reference"></a><span data-ttu-id="ce547-616">Riferimento ai trasformatori di parametro</span><span class="sxs-lookup"><span data-stu-id="ce547-616">Parameter transformer reference</span></span>

<span data-ttu-id="ce547-617">I trasformatori di parametro:</span><span class="sxs-lookup"><span data-stu-id="ce547-617">Parameter transformers:</span></span>

* <span data-ttu-id="ce547-618">Eseguire quando si genera un collegamento utilizzando <xref:Microsoft.AspNetCore.Routing.LinkGenerator> .</span><span class="sxs-lookup"><span data-stu-id="ce547-618">Execute when generating a link using <xref:Microsoft.AspNetCore.Routing.LinkGenerator>.</span></span>
* <span data-ttu-id="ce547-619">Implementare <xref:Microsoft.AspNetCore.Routing.IOutboundParameterTransformer?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="ce547-619">Implement <xref:Microsoft.AspNetCore.Routing.IOutboundParameterTransformer?displayProperty=fullName>.</span></span>
* <span data-ttu-id="ce547-620">Vengono configurati tramite <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span><span class="sxs-lookup"><span data-stu-id="ce547-620">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="ce547-621">Acquisire il valore della route del parametro e trasformarlo in un nuovo valore stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-621">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="ce547-622">Il valore trasformato viene usato nel collegamento generato.</span><span class="sxs-lookup"><span data-stu-id="ce547-622">Result in using the transformed value in the generated link.</span></span>

<span data-ttu-id="ce547-623">Ad esempio, un trasformatore di parametro `slugify` personalizzato nel modello di route `blog\{article:slugify}` con `Url.Action(new { article = "MyTestArticle" })` genera `blog\my-test-article`.</span><span class="sxs-lookup"><span data-stu-id="ce547-623">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="ce547-624">Si consideri l' `IOutboundParameterTransformer` implementazione seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-624">Consider the following `IOutboundParameterTransformer` implementation:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint2.cs?name=snippet2)]

<span data-ttu-id="ce547-625">Per usare un trasformatore di parametro in un modello di route, configurarlo usando <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="ce547-625">To use a parameter transformer in a route pattern, configure it using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint2.cs?name=snippet)]

<span data-ttu-id="ce547-626">Il framework ASP.NET Core usa i trasformatori di parametro per trasformare l'URI in cui viene risolto un endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-626">The ASP.NET Core framework uses parameter transformers to transform the URI where an endpoint resolves.</span></span> <span data-ttu-id="ce547-627">I trasformatori dei parametri, ad esempio, trasformano i valori di route utilizzati per la corrispondenza di `area` , `controller` , `action` e `page` .</span><span class="sxs-lookup"><span data-stu-id="ce547-627">For example, parameter transformers transform the route values used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapControllerRoute(
    name: "default",
    template: "{controller:slugify=Home}/{action:slugify=Index}/{id?}");
```

<span data-ttu-id="ce547-628">Con il modello di route precedente, l'azione `SubscriptionManagementController.GetAll` viene confrontata con l'URI `/subscription-management/get-all` .</span><span class="sxs-lookup"><span data-stu-id="ce547-628">With the preceding route template, the action `SubscriptionManagementController.GetAll` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="ce547-629">Un trasformatore di parametro non modifica i valori della route usati per generare un collegamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-629">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="ce547-630">Ad esempio, `Url.Action("GetAll", "SubscriptionManagement")` restituisce `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="ce547-630">For example, `Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="ce547-631">ASP.NET Core fornisce le convenzioni API per l'uso di trasformatori di parametri con route generate:</span><span class="sxs-lookup"><span data-stu-id="ce547-631">ASP.NET Core provides API conventions for using parameter transformers with generated routes:</span></span>

* <span data-ttu-id="ce547-632">La <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention?displayProperty=fullName> convenzione MVC applica un trasformatore di parametro specificato a tutte le route di attributi nell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-632">The <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention?displayProperty=fullName> MVC convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="ce547-633">Il trasformatore di parametro trasforma i token di route di attributi man mano che vengono sostituiti.</span><span class="sxs-lookup"><span data-stu-id="ce547-633">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="ce547-634">Per altre informazioni vedere [Use a parameter transformer to customize token replacement](xref:mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement) (Usare un trasformatore di parametro per personalizzare la sostituzione di token).</span><span class="sxs-lookup"><span data-stu-id="ce547-634">For more information, see [Use a parameter transformer to customize token replacement](xref:mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="ce547-635">Razor Pages usa la <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention> convenzione API.</span><span class="sxs-lookup"><span data-stu-id="ce547-635">Razor Pages uses the <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention> API convention.</span></span> <span data-ttu-id="ce547-636">Questa convenzione applica un trasformatore di parametro specificato a tutte le pagine individuate automaticamente Razor .</span><span class="sxs-lookup"><span data-stu-id="ce547-636">This convention applies a specified parameter transformer to all automatically discovered Razor Pages.</span></span> <span data-ttu-id="ce547-637">Il trasformatore di parametri trasforma la cartella e i segmenti dei nomi di file delle Razor Route di pagine.</span><span class="sxs-lookup"><span data-stu-id="ce547-637">The parameter transformer transforms the folder and file name segments of Razor Pages routes.</span></span> <span data-ttu-id="ce547-638">Per altre informazioni, vedere [Use a parameter transformer to customize page routes](xref:razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes) (Usare un trasformatore di parametro per personalizzare route di pagine).</span><span class="sxs-lookup"><span data-stu-id="ce547-638">For more information, see [Use a parameter transformer to customize page routes](xref:razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

<a name="ugr"></a>

## <a name="url-generation-reference"></a><span data-ttu-id="ce547-639">Riferimento per la generazione di URL</span><span class="sxs-lookup"><span data-stu-id="ce547-639">URL generation reference</span></span>

<span data-ttu-id="ce547-640">Questa sezione contiene un riferimento per l'algoritmo implementato dalla generazione di URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-640">This section contains a reference for the algorithm implemented by URL generation.</span></span> <span data-ttu-id="ce547-641">In pratica, gli esempi più complessi di generazione di URL utilizzano controller o Razor pagine.</span><span class="sxs-lookup"><span data-stu-id="ce547-641">In practice, most complex examples of URL generation use controllers or Razor Pages.</span></span> <span data-ttu-id="ce547-642">Per ulteriori informazioni, vedere  [routing nei controller](xref:mvc/controllers/routing) .</span><span class="sxs-lookup"><span data-stu-id="ce547-642">See  [routing in controllers](xref:mvc/controllers/routing) for additional information.</span></span>

<span data-ttu-id="ce547-643">Il processo di generazione dell'URL inizia con una chiamata a [LinkGenerator. GetPathByAddress](xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*) o a un metodo simile.</span><span class="sxs-lookup"><span data-stu-id="ce547-643">The URL generation process begins with a call to [LinkGenerator.GetPathByAddress](xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*) or a similar method.</span></span> <span data-ttu-id="ce547-644">Il metodo viene fornito con un indirizzo, un set di valori di route e, facoltativamente, informazioni sulla richiesta corrente da `HttpContext` .</span><span class="sxs-lookup"><span data-stu-id="ce547-644">The method is provided with an address, a set of route values, and optionally information about the current request from `HttpContext`.</span></span>

<span data-ttu-id="ce547-645">Il primo passaggio consiste nell'usare l'indirizzo per risolvere un set di endpoint candidati usando un oggetto [`IEndpointAddressScheme<TAddress>`](xref:Microsoft.AspNetCore.Routing.IEndpointAddressScheme`1) che corrisponde al tipo dell'indirizzo.</span><span class="sxs-lookup"><span data-stu-id="ce547-645">The first step is to use the address to resolve a set of candidate endpoints using an [`IEndpointAddressScheme<TAddress>`](xref:Microsoft.AspNetCore.Routing.IEndpointAddressScheme`1) that matches the address's type.</span></span>

<span data-ttu-id="ce547-646">Una volta che il set di candidati viene trovato dallo schema degli indirizzi, gli endpoint vengono ordinati ed elaborati in modo iterativo fino a quando un'operazione di generazione URL non riesce.</span><span class="sxs-lookup"><span data-stu-id="ce547-646">Once the set of candidates is found by the address scheme, the endpoints are ordered and processed iteratively until a URL generation operation succeeds.</span></span> <span data-ttu-id="ce547-647">La generazione di URL **non** controlla le ambiguità, il primo risultato restituito è il risultato finale.</span><span class="sxs-lookup"><span data-stu-id="ce547-647">URL generation does **not** check for ambiguities, the first result returned is the final result.</span></span>

### <a name="troubleshooting-url-generation-with-logging"></a><span data-ttu-id="ce547-648">Risoluzione dei problemi di generazione URL con registrazione</span><span class="sxs-lookup"><span data-stu-id="ce547-648">Troubleshooting URL generation with logging</span></span>

<span data-ttu-id="ce547-649">Il primo passaggio nella risoluzione dei problemi di generazione degli URL consiste nell'impostazione del livello di registrazione di `Microsoft.AspNetCore.Routing` su `TRACE` .</span><span class="sxs-lookup"><span data-stu-id="ce547-649">The first step in troubleshooting URL generation is setting the logging level of `Microsoft.AspNetCore.Routing` to `TRACE`.</span></span> <span data-ttu-id="ce547-650">`LinkGenerator` registra molti dettagli sull'elaborazione che possono essere utili per la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="ce547-650">`LinkGenerator` logs many details about its processing which can be useful to troubleshoot problems.</span></span>

<span data-ttu-id="ce547-651">Per informazioni dettagliate sulla generazione di URL, vedere riferimento per la [generazione di URL](#ugr) .</span><span class="sxs-lookup"><span data-stu-id="ce547-651">See [URL generation reference](#ugr) for details on URL generation.</span></span>

### <a name="addresses"></a><span data-ttu-id="ce547-652">Indirizzi</span><span class="sxs-lookup"><span data-stu-id="ce547-652">Addresses</span></span>

<span data-ttu-id="ce547-653">Gli indirizzi rappresentano il concetto di generazione di URL usato per associare una chiamata al generatore di collegamenti a un set di endpoint candidati.</span><span class="sxs-lookup"><span data-stu-id="ce547-653">Addresses are the concept in URL generation used to bind a call into the link generator to a set of candidate endpoints.</span></span>

<span data-ttu-id="ce547-654">Gli indirizzi sono un concetto estendibile che include due implementazioni per impostazione predefinita:</span><span class="sxs-lookup"><span data-stu-id="ce547-654">Addresses are an extensible concept that come with two implementations by default:</span></span>

* <span data-ttu-id="ce547-655">Utilizzando il *nome dell'endpoint* ( `string` ) come indirizzo:</span><span class="sxs-lookup"><span data-stu-id="ce547-655">Using *endpoint name* (`string`) as the address:</span></span>
    * <span data-ttu-id="ce547-656">Fornisce funzionalità simili al nome della route MVC.</span><span class="sxs-lookup"><span data-stu-id="ce547-656">Provides similar functionality to MVC's route name.</span></span>
    * <span data-ttu-id="ce547-657">Usa il <xref:Microsoft.AspNetCore.Routing.IEndpointNameMetadata> tipo di metadati.</span><span class="sxs-lookup"><span data-stu-id="ce547-657">Uses the <xref:Microsoft.AspNetCore.Routing.IEndpointNameMetadata> metadata type.</span></span>
    * <span data-ttu-id="ce547-658">Risolve la stringa fornita in base ai metadati di tutti gli endpoint registrati.</span><span class="sxs-lookup"><span data-stu-id="ce547-658">Resolves the provided string against the metadata of all registered endpoints.</span></span>
    * <span data-ttu-id="ce547-659">Genera un'eccezione all'avvio se più endpoint utilizzano lo stesso nome.</span><span class="sxs-lookup"><span data-stu-id="ce547-659">Throws an exception on startup if multiple endpoints use the same name.</span></span>
    * <span data-ttu-id="ce547-660">Consigliato per uso generico all'esterno dei controller e delle Razor pagine.</span><span class="sxs-lookup"><span data-stu-id="ce547-660">Recommended for general-purpose use outside of controllers and Razor Pages.</span></span>
* <span data-ttu-id="ce547-661">Utilizzando *i valori di route* ( <xref:Microsoft.AspNetCore.Routing.RouteValuesAddress> ) come indirizzo:</span><span class="sxs-lookup"><span data-stu-id="ce547-661">Using *route values* (<xref:Microsoft.AspNetCore.Routing.RouteValuesAddress>) as the address:</span></span>
    * <span data-ttu-id="ce547-662">Fornisce funzionalità simili a controller e Razor pagine di generazione URL legacy.</span><span class="sxs-lookup"><span data-stu-id="ce547-662">Provides similar functionality to controllers and Razor Pages legacy URL generation.</span></span>
    * <span data-ttu-id="ce547-663">Molto complesso da estendere ed eseguire il debug.</span><span class="sxs-lookup"><span data-stu-id="ce547-663">Very complex to extend and debug.</span></span>
    * <span data-ttu-id="ce547-664">Fornisce l'implementazione usata da `IUrlHelper` , helper tag, helper HTML, risultati dell'azione e così via.</span><span class="sxs-lookup"><span data-stu-id="ce547-664">Provides the implementation used by `IUrlHelper`, Tag Helpers, HTML Helpers, Action Results, etc.</span></span>

<span data-ttu-id="ce547-665">Il ruolo dello schema di indirizzi è quello di fare in modo che l'associazione tra l'indirizzo e gli endpoint corrispondenti venga stabilita da criteri arbitrari:</span><span class="sxs-lookup"><span data-stu-id="ce547-665">The role of the address scheme is to make the association between the address and matching endpoints by arbitrary criteria:</span></span>

* <span data-ttu-id="ce547-666">Lo schema nome endpoint esegue una ricerca dizionario di base.</span><span class="sxs-lookup"><span data-stu-id="ce547-666">The endpoint name scheme performs a basic dictionary lookup.</span></span>
* <span data-ttu-id="ce547-667">Lo schema dei valori di route ha un subset migliore complesso di algoritmo set.</span><span class="sxs-lookup"><span data-stu-id="ce547-667">The route values scheme has a complex best subset of set algorithm.</span></span>

<a name="ambient"></a>

### <a name="ambient-values-and-explicit-values"></a><span data-ttu-id="ce547-668">Valori di ambiente e valori espliciti</span><span class="sxs-lookup"><span data-stu-id="ce547-668">Ambient values and explicit values</span></span>

<span data-ttu-id="ce547-669">Dalla richiesta corrente, il routing accede ai valori della route della richiesta corrente `HttpContext.Request.RouteValues` .</span><span class="sxs-lookup"><span data-stu-id="ce547-669">From the current request, routing accesses the route values of the current request `HttpContext.Request.RouteValues`.</span></span> <span data-ttu-id="ce547-670">I valori associati alla richiesta corrente sono detti **valori di ambiente**.</span><span class="sxs-lookup"><span data-stu-id="ce547-670">The values associated with the current request are referred to as the **ambient values**.</span></span> <span data-ttu-id="ce547-671">Per maggiore chiarezza, la documentazione fa riferimento ai valori di route passati ai metodi come **valori espliciti**.</span><span class="sxs-lookup"><span data-stu-id="ce547-671">For the purpose of clarity, the documentation refers to the route values passed in to methods as **explicit values**.</span></span>

<span data-ttu-id="ce547-672">Nell'esempio seguente vengono illustrati i valori di ambiente e i valori espliciti.</span><span class="sxs-lookup"><span data-stu-id="ce547-672">The following example shows ambient values and explicit values.</span></span> <span data-ttu-id="ce547-673">Fornisce valori di ambiente dalla richiesta corrente e valori espliciti: `{ id = 17, }` :</span><span class="sxs-lookup"><span data-stu-id="ce547-673">It provides ambient values from the current request and explicit values: `{ id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet)]

<span data-ttu-id="ce547-674">Il codice precedente:</span><span class="sxs-lookup"><span data-stu-id="ce547-674">The preceding code:</span></span>

* <span data-ttu-id="ce547-675">Restituisce `/Widget/Index/17`.</span><span class="sxs-lookup"><span data-stu-id="ce547-675">Returns `/Widget/Index/17`</span></span>
* <span data-ttu-id="ce547-676">Ottiene <xref:Microsoft.AspNetCore.Routing.LinkGenerator> tramite [di](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="ce547-676">Gets <xref:Microsoft.AspNetCore.Routing.LinkGenerator> via [DI](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="ce547-677">Il codice seguente non fornisce valori di ambiente e valori espliciti: `{ controller = "Home", action = "Subscribe", id = 17, }` :</span><span class="sxs-lookup"><span data-stu-id="ce547-677">The following code provides no ambient values and explicit values: `{ controller = "Home", action = "Subscribe", id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet2)]

<span data-ttu-id="ce547-678">Il metodo precedente restituisce `/Home/Subscribe/17`</span><span class="sxs-lookup"><span data-stu-id="ce547-678">The preceding  method returns `/Home/Subscribe/17`</span></span>

<span data-ttu-id="ce547-679">Il codice seguente nell'oggetto `WidgetController` restituisce `/Widget/Subscribe/17` :</span><span class="sxs-lookup"><span data-stu-id="ce547-679">The following code in the `WidgetController` returns `/Widget/Subscribe/17`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet3)]

<span data-ttu-id="ce547-680">Il codice seguente fornisce al controller i valori di ambiente nella richiesta corrente e i valori espliciti: `{ action = "Edit", id = 17, }` :</span><span class="sxs-lookup"><span data-stu-id="ce547-680">The following code provides the controller from ambient values in the current request and explicit values: `{ action = "Edit", id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/GadgetController.cs?name=snippet)]

<span data-ttu-id="ce547-681">Nel codice precedente:</span><span class="sxs-lookup"><span data-stu-id="ce547-681">In the preceding code:</span></span>

* <span data-ttu-id="ce547-682">`/Gadget/Edit/17` viene restituito.</span><span class="sxs-lookup"><span data-stu-id="ce547-682">`/Gadget/Edit/17` is returned.</span></span>
* <span data-ttu-id="ce547-683"><xref:Microsoft.AspNetCore.Mvc.ControllerBase.Url> Ottiene l'oggetto <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> .</span><span class="sxs-lookup"><span data-stu-id="ce547-683"><xref:Microsoft.AspNetCore.Mvc.ControllerBase.Url> gets the <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>.</span></span>
* <xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*>   
<span data-ttu-id="ce547-684">genera un URL con un percorso assoluto per un metodo di azione.</span><span class="sxs-lookup"><span data-stu-id="ce547-684">generates a URL with an absolute path for an action method.</span></span> <span data-ttu-id="ce547-685">L'URL contiene il `action` nome e i `route` valori specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-685">The URL contains the specified `action` name and `route` values.</span></span>

<span data-ttu-id="ce547-686">Il codice seguente fornisce valori di ambiente dalla richiesta corrente e valori espliciti: `{ page = "./Edit, id = 17, }` :</span><span class="sxs-lookup"><span data-stu-id="ce547-686">The following code provides ambient values from the current request and explicit values: `{ page = "./Edit, id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Pages/Index.cshtml.cs?name=snippet)]

<span data-ttu-id="ce547-687">Il codice precedente imposta `url` su  `/Edit/17` quando la pagina di modifica Razor contiene la direttiva della pagina seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-687">The preceding code sets `url` to  `/Edit/17` when the Edit Razor Page contains the following page directive:</span></span>

 `@page "{id:int}"`

<span data-ttu-id="ce547-688">Se la pagina di modifica non contiene il `"{id:int}"` modello di route, `url` è `/Edit?id=17` .</span><span class="sxs-lookup"><span data-stu-id="ce547-688">If the Edit page doesn't contain the `"{id:int}"` route template, `url` is `/Edit?id=17`.</span></span>

<span data-ttu-id="ce547-689">Il comportamento di MVC <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> aggiunge un livello di complessità oltre alle regole descritte di seguito:</span><span class="sxs-lookup"><span data-stu-id="ce547-689">The behavior of MVC's <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> adds a layer of complexity in addition to the rules described here:</span></span>

* <span data-ttu-id="ce547-690">`IUrlHelper` fornisce sempre i valori di route della richiesta corrente come valori di ambiente.</span><span class="sxs-lookup"><span data-stu-id="ce547-690">`IUrlHelper` always provides the route values from the current request as ambient values.</span></span>
* <span data-ttu-id="ce547-691">[IUrlHelper. Action](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*) copia sempre i `action` `controller` valori di route e correnti come valori espliciti a meno che non vengano sostituiti dallo sviluppatore.</span><span class="sxs-lookup"><span data-stu-id="ce547-691">[IUrlHelper.Action](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*) always copies the current `action` and `controller` route values as explicit values unless overridden by the developer.</span></span>
* <span data-ttu-id="ce547-692">[IUrlHelper. Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*) copia sempre il `page` valore di route corrente come valore esplicito a meno che non venga sottoposto a override.</span><span class="sxs-lookup"><span data-stu-id="ce547-692">[IUrlHelper.Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*) always copies the current `page` route value as an explicit value unless overridden.</span></span> <!--by the user-->
* <span data-ttu-id="ce547-693">`IUrlHelper.Page` esegue sempre l'override del `handler` valore di route corrente con `null` come valori espliciti a meno che non venga sottoposto a override.</span><span class="sxs-lookup"><span data-stu-id="ce547-693">`IUrlHelper.Page` always overrides the current `handler` route value with `null` as an explicit values unless overridden.</span></span>

<span data-ttu-id="ce547-694">Spesso gli utenti sono sorpresi dai dettagli comportamentali dei valori di ambiente, perché MVC non sembra rispettare le proprie regole.</span><span class="sxs-lookup"><span data-stu-id="ce547-694">Users are often surprised by the behavioral details of ambient values, because MVC doesn't seem to follow its own rules.</span></span> <span data-ttu-id="ce547-695">Per motivi cronologici e di compatibilità, determinati valori di route, ad esempio `action` ,, `controller` `page` e `handler` hanno il proprio comportamento speciale.</span><span class="sxs-lookup"><span data-stu-id="ce547-695">For historical and compatibility reasons, certain route values such as `action`, `controller`, `page`, and `handler` have their own special-case behavior.</span></span>

<span data-ttu-id="ce547-696">La funzionalità equivalente fornita da `LinkGenerator.GetPathByAction` e `LinkGenerator.GetPathByPage` Duplica le anomalie di `IUrlHelper` per la compatibilità.</span><span class="sxs-lookup"><span data-stu-id="ce547-696">The equivalent functionality provided by `LinkGenerator.GetPathByAction` and `LinkGenerator.GetPathByPage` duplicates these anomalies of `IUrlHelper` for compatibility.</span></span>

### <a name="url-generation-process"></a><span data-ttu-id="ce547-697">Processo di generazione URL</span><span class="sxs-lookup"><span data-stu-id="ce547-697">URL generation process</span></span>

<span data-ttu-id="ce547-698">Una volta individuato il set di endpoint candidati, l'algoritmo di generazione dell'URL:</span><span class="sxs-lookup"><span data-stu-id="ce547-698">Once the set of candidate endpoints are found, the URL generation algorithm:</span></span>

* <span data-ttu-id="ce547-699">Elabora gli endpoint in modo iterativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-699">Processes the endpoints iteratively.</span></span>
* <span data-ttu-id="ce547-700">Restituisce il primo risultato riuscito.</span><span class="sxs-lookup"><span data-stu-id="ce547-700">Returns the first successful result.</span></span>

<span data-ttu-id="ce547-701">Il primo passaggio di questo processo è denominato **invalidamento del valore di route**.</span><span class="sxs-lookup"><span data-stu-id="ce547-701">The first step in this process is called **route value invalidation**.</span></span>  <span data-ttu-id="ce547-702">L'invalidamento del valore di route è il processo mediante il quale il routing decide i valori di route dei valori di ambiente da utilizzare e che devono essere ignorati.</span><span class="sxs-lookup"><span data-stu-id="ce547-702">Route value invalidation is the process by which routing decides which route values from the ambient values should be used and which should be ignored.</span></span> <span data-ttu-id="ce547-703">Ogni valore di ambiente viene considerato e combinato con i valori espliciti o ignorati.</span><span class="sxs-lookup"><span data-stu-id="ce547-703">Each ambient value is considered and either combined with the explicit values, or ignored.</span></span>

<span data-ttu-id="ce547-704">Il modo migliore per considerare il ruolo dei valori di ambiente è che tentano di salvare gli sviluppatori di applicazioni che digitano, in alcuni casi comuni.</span><span class="sxs-lookup"><span data-stu-id="ce547-704">The best way to think about the role of ambient values is that they attempt to save application developers typing, in some common cases.</span></span> <span data-ttu-id="ce547-705">Tradizionalmente, gli scenari in cui i valori di ambiente sono utili sono correlati a MVC:</span><span class="sxs-lookup"><span data-stu-id="ce547-705">Traditionally, the scenarios where ambient values are helpful are related to MVC:</span></span>

* <span data-ttu-id="ce547-706">Quando si esegue il collegamento a un'altra azione nello stesso controller, non è necessario specificare il nome del controller.</span><span class="sxs-lookup"><span data-stu-id="ce547-706">When linking to another action in the same controller, the controller name doesn't need to be specified.</span></span>
* <span data-ttu-id="ce547-707">Quando si esegue il collegamento a un altro controller nella stessa area, non è necessario specificare il nome dell'area.</span><span class="sxs-lookup"><span data-stu-id="ce547-707">When linking to another controller in the same area, the area name doesn't need to be specified.</span></span>
* <span data-ttu-id="ce547-708">Quando si esegue il collegamento allo stesso metodo di azione, non è necessario specificare i valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-708">When linking to the same action method, route values don't need to be specified.</span></span>
* <span data-ttu-id="ce547-709">Quando si esegue il collegamento a un'altra parte dell'app, non si vuole trasferire i valori di route che non hanno significato in questa parte dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-709">When linking to another part of the app, you don't want to carry over route values that have no meaning in that part of the app.</span></span>

<span data-ttu-id="ce547-710">Le chiamate a `LinkGenerator` o `IUrlHelper` che restituiscono `null` sono in genere dovute alla mancata comprensione dell'invalidamento del valore della route.</span><span class="sxs-lookup"><span data-stu-id="ce547-710">Calls to `LinkGenerator` or `IUrlHelper` that return `null` are usually caused by not understanding route value invalidation.</span></span> <span data-ttu-id="ce547-711">Risolvere i problemi di invalidamento del valore della route specificando in modo esplicito più valori di route per vedere se il problema viene risolto.</span><span class="sxs-lookup"><span data-stu-id="ce547-711">Troubleshoot route value invalidation by explicitly specifying more of the route values to see if that solves the problem.</span></span>

<span data-ttu-id="ce547-712">L'invalidamento del valore di route si basa sul presupposto che lo schema dell'URL dell'app sia gerarchico, con una gerarchia formata da sinistra verso destra.</span><span class="sxs-lookup"><span data-stu-id="ce547-712">Route value invalidation works on the assumption that the app's URL scheme is hierarchical, with a hierarchy formed from left-to-right.</span></span> <span data-ttu-id="ce547-713">Si consideri il modello di route del controller `{controller}/{action}/{id?}` di base per ottenere un senso intuitivo di come funziona in pratica.</span><span class="sxs-lookup"><span data-stu-id="ce547-713">Consider the basic controller route template `{controller}/{action}/{id?}` to get an intuitive sense of how this works in practice.</span></span> <span data-ttu-id="ce547-714">Una **modifica** a un valore **invalida** tutti i valori di route visualizzati a destra.</span><span class="sxs-lookup"><span data-stu-id="ce547-714">A **change** to a value **invalidates** all of the route values that appear to the right.</span></span> <span data-ttu-id="ce547-715">Ciò riflette il presupposto della gerarchia.</span><span class="sxs-lookup"><span data-stu-id="ce547-715">This reflects the assumption about hierarchy.</span></span> <span data-ttu-id="ce547-716">Se l'app ha un valore di ambiente per `id` e l'operazione specifica un valore diverso per `controller` :</span><span class="sxs-lookup"><span data-stu-id="ce547-716">If the app has an ambient value for `id`, and the operation specifies a different value for the `controller`:</span></span>

* <span data-ttu-id="ce547-717">`id` non verrà riutilizzato perché `{controller}` è a sinistra di `{id?}` .</span><span class="sxs-lookup"><span data-stu-id="ce547-717">`id` won't be reused because `{controller}` is to the left of `{id?}`.</span></span>

<span data-ttu-id="ce547-718">Di seguito sono riportati alcuni esempi che illustrano questo principio:</span><span class="sxs-lookup"><span data-stu-id="ce547-718">Some examples demonstrating this principle:</span></span>

* <span data-ttu-id="ce547-719">Se i valori espliciti contengono un valore per `id` , il valore di ambiente per `id` viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="ce547-719">If the explicit values contain a value for `id`, the ambient value for `id` is ignored.</span></span> <span data-ttu-id="ce547-720">I valori di ambiente per `controller` e `action` possono essere utilizzati.</span><span class="sxs-lookup"><span data-stu-id="ce547-720">The ambient values for `controller` and `action` can be used.</span></span>
* <span data-ttu-id="ce547-721">Se i valori espliciti contengono un valore per `action` , qualsiasi valore di ambiente per `action` viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="ce547-721">If the explicit values contain a value for `action`, any ambient value for `action` is ignored.</span></span> <span data-ttu-id="ce547-722">I valori di ambiente per `controller` possono essere utilizzati.</span><span class="sxs-lookup"><span data-stu-id="ce547-722">The ambient values for `controller` can be used.</span></span> <span data-ttu-id="ce547-723">Se il valore esplicito per `action` è diverso dal valore di ambiente per `action` , il `id` valore non verrà utilizzato.</span><span class="sxs-lookup"><span data-stu-id="ce547-723">If the explicit value for `action` is different from the ambient value for `action`, the `id` value won't be used.</span></span>  <span data-ttu-id="ce547-724">Se il valore esplicito per `action` è uguale al valore di ambiente di `action` , è `id` possibile utilizzare il valore.</span><span class="sxs-lookup"><span data-stu-id="ce547-724">If the explicit value for `action` is the same as the ambient value for `action`, the `id` value can be used.</span></span>
* <span data-ttu-id="ce547-725">Se i valori espliciti contengono un valore per `controller` , qualsiasi valore di ambiente per `controller` viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="ce547-725">If the explicit values contain a value for `controller`, any ambient value for `controller` is ignored.</span></span> <span data-ttu-id="ce547-726">Se il valore esplicito per `controller` è diverso dal valore di ambiente per `controller` , `action` i `id` valori e non verranno utilizzati.</span><span class="sxs-lookup"><span data-stu-id="ce547-726">If the explicit value for `controller` is different from the ambient value for `controller`, the `action` and `id` values won't be used.</span></span> <span data-ttu-id="ce547-727">Se il valore esplicito per `controller` è uguale al valore di ambiente di `controller` , è `action` `id` possibile utilizzare i valori e.</span><span class="sxs-lookup"><span data-stu-id="ce547-727">If the explicit value for `controller` is the same as the ambient value for `controller`, the `action` and `id` values can be used.</span></span>

<span data-ttu-id="ce547-728">Questo processo è ulteriormente complicato dall'esistenza delle route degli attributi e delle route convenzionali dedicate.</span><span class="sxs-lookup"><span data-stu-id="ce547-728">This process is further complicated by the existence of attribute routes and dedicated conventional routes.</span></span> <span data-ttu-id="ce547-729">Route convenzionali del controller come `{controller}/{action}/{id?}` specificare una gerarchia usando i parametri di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-729">Controller conventional routes such as `{controller}/{action}/{id?}` specify a hierarchy using route parameters.</span></span> <span data-ttu-id="ce547-730">Per route [convenzionali dedicate](xref:mvc/controllers/routing#dcr) e [Route di attributi](xref:mvc/controllers/routing#ar) a controller e Razor pagine:</span><span class="sxs-lookup"><span data-stu-id="ce547-730">For [dedicated conventional routes](xref:mvc/controllers/routing#dcr) and [attribute routes](xref:mvc/controllers/routing#ar) to controllers and Razor Pages:</span></span>

* <span data-ttu-id="ce547-731">Esiste una gerarchia di valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-731">There is a hierarchy of route values.</span></span>
* <span data-ttu-id="ce547-732">Non vengono visualizzati nel modello.</span><span class="sxs-lookup"><span data-stu-id="ce547-732">They don't appear in the template.</span></span>

<span data-ttu-id="ce547-733">In questi casi, la generazione di URL definisce il concetto di **valori richiesti** .</span><span class="sxs-lookup"><span data-stu-id="ce547-733">For these cases, URL generation defines the **required values** concept.</span></span> <span data-ttu-id="ce547-734">Per gli endpoint creati da controller e Razor pagine sono specificati i valori obbligatori che consentono il funzionamento dell'invalidamento del valore di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-734">Endpoints created by controllers and Razor Pages have required values specified that allow route value invalidation to work.</span></span>

<span data-ttu-id="ce547-735">Algoritmo di invalidamento del valore di route in dettaglio:</span><span class="sxs-lookup"><span data-stu-id="ce547-735">The route value invalidation algorithm in detail:</span></span>

* <span data-ttu-id="ce547-736">I nomi dei valori obbligatori vengono combinati con i parametri di route, quindi elaborati da sinistra a destra.</span><span class="sxs-lookup"><span data-stu-id="ce547-736">The required value names are combined with the route parameters, then processed from left-to-right.</span></span>
* <span data-ttu-id="ce547-737">Per ogni parametro, vengono confrontati il valore di ambiente e il valore esplicito:</span><span class="sxs-lookup"><span data-stu-id="ce547-737">For each parameter, the ambient value and explicit value are compared:</span></span>
    * <span data-ttu-id="ce547-738">Se il valore di ambiente e il valore esplicito sono uguali, il processo continua.</span><span class="sxs-lookup"><span data-stu-id="ce547-738">If the ambient value and explicit value are the same, the process continues.</span></span>
    * <span data-ttu-id="ce547-739">Se il valore di ambiente è presente e il valore esplicito non è, il valore di ambiente viene usato durante la generazione dell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-739">If the ambient value is present and the explicit value isn't, the ambient value is used when generating the URL.</span></span>
    * <span data-ttu-id="ce547-740">Se il valore di ambiente non è presente e il valore esplicito è, rifiutare il valore di ambiente e tutti i valori di ambiente successivi.</span><span class="sxs-lookup"><span data-stu-id="ce547-740">If the ambient value isn't present and the explicit value is, reject the ambient value and all subsequent ambient values.</span></span>
    * <span data-ttu-id="ce547-741">Se il valore di ambiente e il valore esplicito sono presenti e i due valori sono diversi, rifiutare il valore di ambiente e tutti i valori di ambiente successivi.</span><span class="sxs-lookup"><span data-stu-id="ce547-741">If the ambient value and the explicit value are present, and the two values are different, reject the ambient value and all subsequent ambient values.</span></span>

<span data-ttu-id="ce547-742">A questo punto, l'operazione di generazione URL è pronta per valutare i vincoli di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-742">At this point, the URL generation operation is ready to evaluate route constraints.</span></span> <span data-ttu-id="ce547-743">Il set di valori accettati viene combinato con i valori predefiniti del parametro, fornito ai vincoli.</span><span class="sxs-lookup"><span data-stu-id="ce547-743">The set of accepted values is combined with the parameter default values, which is provided to constraints.</span></span> <span data-ttu-id="ce547-744">Se tutti i vincoli passano, l'operazione continua.</span><span class="sxs-lookup"><span data-stu-id="ce547-744">If the constraints all pass, the operation continues.</span></span>

<span data-ttu-id="ce547-745">Successivamente, è possibile usare i **valori accettati** per espandere il modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-745">Next, the **accepted values** can be used to expand the route template.</span></span> <span data-ttu-id="ce547-746">Il modello di route viene elaborato:</span><span class="sxs-lookup"><span data-stu-id="ce547-746">The route template is processed:</span></span>

* <span data-ttu-id="ce547-747">Da sinistra a destra.</span><span class="sxs-lookup"><span data-stu-id="ce547-747">From left-to-right.</span></span>
* <span data-ttu-id="ce547-748">Ogni parametro ha il valore accettato sostituito.</span><span class="sxs-lookup"><span data-stu-id="ce547-748">Each parameter has its accepted value substituted.</span></span>
* <span data-ttu-id="ce547-749">Con i casi speciali seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-749">With the following special cases:</span></span>
  * <span data-ttu-id="ce547-750">Se nei valori accettati manca un valore e il parametro ha un valore predefinito, viene usato il valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="ce547-750">If the accepted values is missing a value and the parameter has a default value, the default value is used.</span></span>
  * <span data-ttu-id="ce547-751">Se nei valori accettati manca un valore e il parametro è facoltativo, l'elaborazione continua.</span><span class="sxs-lookup"><span data-stu-id="ce547-751">If the accepted values is missing a value and the parameter is optional, processing continues.</span></span>
  * <span data-ttu-id="ce547-752">Se un parametro di route a destra di un parametro facoltativo mancante ha un valore, l'operazione ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-752">If any route parameter to the right of a missing optional parameter has a value, the operation fails.</span></span>
  * <!-- review default-valued parameters optional parameters --> <span data-ttu-id="ce547-753">I parametri con valori predefiniti contigui e i parametri facoltativi vengono compressi laddove possibile.</span><span class="sxs-lookup"><span data-stu-id="ce547-753">Contiguous default-valued parameters and optional parameters are collapsed where possible.</span></span>

<span data-ttu-id="ce547-754">I valori specificati in modo esplicito che non corrispondono a un segmento della route vengono aggiunti alla stringa di query.</span><span class="sxs-lookup"><span data-stu-id="ce547-754">Values explicitly provided that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="ce547-755">La tabella seguente illustra il risultato ottenuto quando si usa il modello di route `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-755">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="ce547-756">Valori di ambiente</span><span class="sxs-lookup"><span data-stu-id="ce547-756">Ambient Values</span></span>                     | <span data-ttu-id="ce547-757">Valori espliciti</span><span class="sxs-lookup"><span data-stu-id="ce547-757">Explicit Values</span></span>                        | <span data-ttu-id="ce547-758">Risultato</span><span class="sxs-lookup"><span data-stu-id="ce547-758">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="ce547-759">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-759">controller = "Home"</span></span>                | <span data-ttu-id="ce547-760">action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-760">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="ce547-761">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-761">controller = "Home"</span></span>                | <span data-ttu-id="ce547-762">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-762">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="ce547-763">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="ce547-763">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="ce547-764">action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-764">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="ce547-765">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-765">controller = "Home"</span></span>                | <span data-ttu-id="ce547-766">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="ce547-766">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

### <a name="problems-with-route-value-invalidation"></a><span data-ttu-id="ce547-767">Problemi di invalidamento del valore di route</span><span class="sxs-lookup"><span data-stu-id="ce547-767">Problems with route value invalidation</span></span>

<span data-ttu-id="ce547-768">A partire da ASP.NET Core 3,0, alcuni schemi di generazione URL usati nelle versioni precedenti ASP.NET Core non funzionano correttamente con la generazione di URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-768">As of ASP.NET Core 3.0, some URL generation schemes used in earlier ASP.NET Core versions don't work well with URL generation.</span></span> <span data-ttu-id="ce547-769">Il team ASP.NET Core prevede di aggiungere funzionalità per soddisfare queste esigenze in una versione futura.</span><span class="sxs-lookup"><span data-stu-id="ce547-769">The ASP.NET Core team plans to add features to address these needs in a future release.</span></span> <span data-ttu-id="ce547-770">Per ora, la soluzione migliore consiste nell'usare il routing legacy.</span><span class="sxs-lookup"><span data-stu-id="ce547-770">For now the best solution is to use legacy routing.</span></span>

<span data-ttu-id="ce547-771">Il codice seguente illustra un esempio di uno schema di generazione URL non supportato dal routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-771">The following code shows an example of a URL generation scheme that's not supported by routing.</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupUnsupported.cs?name=snippet)]

<span data-ttu-id="ce547-772">Nel codice precedente, il `culture` parametro di route viene usato per la localizzazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-772">In the preceding code, the `culture` route parameter is used for localization.</span></span> <span data-ttu-id="ce547-773">Il desiderio è che il `culture` parametro sia sempre accettato come valore di ambiente.</span><span class="sxs-lookup"><span data-stu-id="ce547-773">The desire is to have the `culture` parameter always accepted as an ambient value.</span></span> <span data-ttu-id="ce547-774">Tuttavia, il `culture` parametro non viene accettato come valore di ambiente a causa del modo in cui i valori richiesti funzionano:</span><span class="sxs-lookup"><span data-stu-id="ce547-774">However, the `culture` parameter is not accepted as an ambient value because of the way required values work:</span></span>

* <span data-ttu-id="ce547-775">Nel `"default"` modello di route, il `culture` parametro di route è a sinistra di `controller` , quindi le modifiche a `controller` non invalidano `culture` .</span><span class="sxs-lookup"><span data-stu-id="ce547-775">In the `"default"` route template, the `culture` route parameter is to the left of `controller`, so changes to `controller` won't invalidate `culture`.</span></span>
* <span data-ttu-id="ce547-776">Nel `"blog"` modello di route, il `culture` parametro di route viene considerato a destra di `controller` , che viene visualizzato nei valori richiesti.</span><span class="sxs-lookup"><span data-stu-id="ce547-776">In the `"blog"` route template, the `culture` route parameter is considered to be to the right of `controller`, which appears in the required values.</span></span>

## <a name="configuring-endpoint-metadata"></a><span data-ttu-id="ce547-777">Configurazione dei metadati dell'endpoint</span><span class="sxs-lookup"><span data-stu-id="ce547-777">Configuring endpoint metadata</span></span>

<span data-ttu-id="ce547-778">I collegamenti seguenti forniscono informazioni sulla configurazione dei metadati dell'endpoint:</span><span class="sxs-lookup"><span data-stu-id="ce547-778">The following links provide information on configuring endpoint metadata:</span></span>

* [<span data-ttu-id="ce547-779">Abilitare cors con routing degli endpoint</span><span class="sxs-lookup"><span data-stu-id="ce547-779">Enable Cors with endpoint routing</span></span>](xref:security/cors#enable-cors-with-endpoint-routing)
* <span data-ttu-id="ce547-780">[Esempio di IAuthorizationPolicyProvider](https://github.com/dotnet/AspNetCore/tree/release/3.1/src/Security/samples/CustomPolicyProvider) con un `[MinimumAgeAuthorize]` attributo personalizzato</span><span class="sxs-lookup"><span data-stu-id="ce547-780">[IAuthorizationPolicyProvider sample](https://github.com/dotnet/AspNetCore/tree/release/3.1/src/Security/samples/CustomPolicyProvider) using a custom `[MinimumAgeAuthorize]` attribute</span></span>
* <span data-ttu-id="ce547-781">[Testare l'autenticazione con l'attributo [autorizzate]](xref:security/authentication/identity#test-identity)</span><span class="sxs-lookup"><span data-stu-id="ce547-781">[Test authentication with the [Authorize] attribute](xref:security/authentication/identity#test-identity)</span></span>
* <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*>
* <span data-ttu-id="ce547-782">[Selezione dello schema con l'attributo [autorizzate]](xref:security/authorization/limitingidentitybyscheme#selecting-the-scheme-with-the-authorize-attribute)</span><span class="sxs-lookup"><span data-stu-id="ce547-782">[Selecting the scheme with the [Authorize] attribute](xref:security/authorization/limitingidentitybyscheme#selecting-the-scheme-with-the-authorize-attribute)</span></span>
* <span data-ttu-id="ce547-783">[Applicare i criteri usando l'attributo [autorizzate]](xref:security/authorization/policies#apply-policies-to-mvc-controllers)</span><span class="sxs-lookup"><span data-stu-id="ce547-783">[Apply policies using the [Authorize] attribute](xref:security/authorization/policies#apply-policies-to-mvc-controllers)</span></span>
* <xref:security/authorization/roles>

<a name="hostmatch"></a>

## <a name="host-matching-in-routes-with-requirehost"></a><span data-ttu-id="ce547-784">Corrispondenza host nelle route con RequireHost</span><span class="sxs-lookup"><span data-stu-id="ce547-784">Host matching in routes with RequireHost</span></span>

<span data-ttu-id="ce547-785"><xref:Microsoft.AspNetCore.Builder.RoutingEndpointConventionBuilderExtensions.RequireHost*> applica un vincolo alla route che richiede l'host specificato.</span><span class="sxs-lookup"><span data-stu-id="ce547-785"><xref:Microsoft.AspNetCore.Builder.RoutingEndpointConventionBuilderExtensions.RequireHost*> applies a constraint to the route which requires the specified host.</span></span> <span data-ttu-id="ce547-786">Il `RequireHost` parametro o [[host]](xref:Microsoft.AspNetCore.Routing.HostAttribute) può essere:</span><span class="sxs-lookup"><span data-stu-id="ce547-786">The `RequireHost` or [[Host]](xref:Microsoft.AspNetCore.Routing.HostAttribute) parameter can be:</span></span>

* <span data-ttu-id="ce547-787">Host: `www.domain.com` , corrisponde `www.domain.com` a qualsiasi porta.</span><span class="sxs-lookup"><span data-stu-id="ce547-787">Host: `www.domain.com`, matches `www.domain.com` with any port.</span></span>
* <span data-ttu-id="ce547-788">Host con carattere jolly: `*.domain.com` , `www.domain.com` corrisponde `subdomain.domain.com` a, `www.subdomain.domain.com` o su qualsiasi porta.</span><span class="sxs-lookup"><span data-stu-id="ce547-788">Host with wildcard: `*.domain.com`, matches `www.domain.com`, `subdomain.domain.com`, or `www.subdomain.domain.com` on any port.</span></span>
* <span data-ttu-id="ce547-789">Port: `*:5000` , corrisponde alla porta 5000 con qualsiasi host.</span><span class="sxs-lookup"><span data-stu-id="ce547-789">Port: `*:5000`, matches port 5000 with any host.</span></span>
* <span data-ttu-id="ce547-790">Host e porta: `www.domain.com:5000` oppure `*.domain.com:5000` corrisponde a host e porta.</span><span class="sxs-lookup"><span data-stu-id="ce547-790">Host and port: `www.domain.com:5000` or `*.domain.com:5000`, matches host and port.</span></span>

<span data-ttu-id="ce547-791">È possibile specificare più parametri usando `RequireHost` o `[Host]` .</span><span class="sxs-lookup"><span data-stu-id="ce547-791">Multiple parameters can be specified using `RequireHost` or `[Host]`.</span></span> <span data-ttu-id="ce547-792">Il vincolo corrisponde a host validi per uno qualsiasi dei parametri.</span><span class="sxs-lookup"><span data-stu-id="ce547-792">The constraint  matches hosts valid for any of the parameters.</span></span> <span data-ttu-id="ce547-793">Ad esempio, `[Host("domain.com", "*.domain.com")]` corrisponde a `domain.com` , `www.domain.com` e `subdomain.domain.com` .</span><span class="sxs-lookup"><span data-stu-id="ce547-793">For example, `[Host("domain.com", "*.domain.com")]` matches `domain.com`, `www.domain.com`, and `subdomain.domain.com`.</span></span>

<span data-ttu-id="ce547-794">Il codice seguente usa `RequireHost` per richiedere l'host specificato nella route:</span><span class="sxs-lookup"><span data-stu-id="ce547-794">The following code uses `RequireHost` to require the specified host on the route:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRequireHost.cs?name=snippet)]

<span data-ttu-id="ce547-795">Il codice seguente usa l' `[Host]` attributo sul controller per richiedere uno degli host specificati:</span><span class="sxs-lookup"><span data-stu-id="ce547-795">The following code uses the `[Host]` attribute on the controller to require any of the specified hosts:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/ProductController.cs?name=snippet)]

<span data-ttu-id="ce547-796">Quando l' `[Host]` attributo viene applicato sia al controller che al metodo di azione:</span><span class="sxs-lookup"><span data-stu-id="ce547-796">When the `[Host]` attribute is applied to both the controller and action method:</span></span>

* <span data-ttu-id="ce547-797">Viene utilizzato l'attributo sull'azione.</span><span class="sxs-lookup"><span data-stu-id="ce547-797">The attribute on the action is used.</span></span>
* <span data-ttu-id="ce547-798">L'attributo controller viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="ce547-798">The controller attribute is ignored.</span></span>

## <a name="performance-guidance-for-routing"></a><span data-ttu-id="ce547-799">Linee guida sulle prestazioni per il routing</span><span class="sxs-lookup"><span data-stu-id="ce547-799">Performance guidance for routing</span></span>

<span data-ttu-id="ce547-800">La maggior parte del routing è stata aggiornata in ASP.NET Core 3,0 per migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ce547-800">Most of routing was updated in ASP.NET Core 3.0 to increase performance.</span></span>

<span data-ttu-id="ce547-801">Quando un'applicazione presenta problemi di prestazioni, il routing è spesso sospetto come il problema.</span><span class="sxs-lookup"><span data-stu-id="ce547-801">When an app has performance problems, routing is often suspected as the problem.</span></span> <span data-ttu-id="ce547-802">Il motivo per cui il routing è sospetto è che i Framework come i controller e Razor le pagine segnalino la quantità di tempo impiegato all'interno del Framework nei messaggi di registrazione.</span><span class="sxs-lookup"><span data-stu-id="ce547-802">The reason routing is suspected is that frameworks like controllers and Razor Pages report the amount of time spent inside the framework in their logging messages.</span></span> <span data-ttu-id="ce547-803">Quando esiste una differenza significativa tra il tempo segnalato dai controller e il tempo totale della richiesta:</span><span class="sxs-lookup"><span data-stu-id="ce547-803">When there's a significant difference between the time reported by controllers and the total time of the request:</span></span>

* <span data-ttu-id="ce547-804">Gli sviluppatori eliminano il codice dell'app come origine del problema.</span><span class="sxs-lookup"><span data-stu-id="ce547-804">Developers eliminate their app code as the source of the problem.</span></span>
* <span data-ttu-id="ce547-805">Si presuppone che il routing sia la ragione.</span><span class="sxs-lookup"><span data-stu-id="ce547-805">It's common to assume routing is the cause.</span></span>

<span data-ttu-id="ce547-806">Il routing è sottoposto a test delle prestazioni con migliaia di endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-806">Routing is performance tested using thousands of endpoints.</span></span> <span data-ttu-id="ce547-807">È improbabile che un'app tipica riscontri un problema di prestazioni semplicemente troppo grande.</span><span class="sxs-lookup"><span data-stu-id="ce547-807">It's unlikely that a typical app will encounter a performance problem just by being too large.</span></span> <span data-ttu-id="ce547-808">La causa principale più comune di rallentamento delle prestazioni del routing è in genere un middleware personalizzato.</span><span class="sxs-lookup"><span data-stu-id="ce547-808">The most common root cause of slow routing performance is usually a badly-behaving custom middleware.</span></span>

<span data-ttu-id="ce547-809">Nell'esempio di codice seguente viene illustrata una tecnica di base per limitare l'origine del ritardo:</span><span class="sxs-lookup"><span data-stu-id="ce547-809">This following code sample demonstrates a basic technique for narrowing down the source of delay:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupDelay.cs?name=snippet)]

<span data-ttu-id="ce547-810">Al routing temporale:</span><span class="sxs-lookup"><span data-stu-id="ce547-810">To time routing:</span></span>

* <span data-ttu-id="ce547-811">Interleave ogni middleware con una copia del middleware di temporizzazione illustrato nel codice precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-811">Interleave each middleware with a copy of the timing middleware shown in the preceding code.</span></span>
* <span data-ttu-id="ce547-812">Aggiungere un identificatore univoco per correlare i dati di intervallo con il codice.</span><span class="sxs-lookup"><span data-stu-id="ce547-812">Add a unique identifier to correlate the timing data with the code.</span></span>

<span data-ttu-id="ce547-813">Si tratta di un metodo di base per limitare il ritardo quando è significativo, ad esempio più di `10ms` .</span><span class="sxs-lookup"><span data-stu-id="ce547-813">This is a basic way to narrow down the delay when it's significant, for example, more than `10ms`.</span></span>  <span data-ttu-id="ce547-814">La sottrazione `Time 2` da `Time 1` segnala il tempo impiegato all'interno del `UseRouting` middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-814">Subtracting `Time 2` from `Time 1` reports the time spent inside the `UseRouting` middleware.</span></span>

<span data-ttu-id="ce547-815">Il codice seguente usa un approccio più compatto al codice temporale precedente:</span><span class="sxs-lookup"><span data-stu-id="ce547-815">The following code uses a more compact approach to the preceding timing code:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupSW.cs?name=snippetSW)]

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupSW.cs?name=snippet)]

### <a name="potentially-expensive-routing-features"></a><span data-ttu-id="ce547-816">Funzionalità di routing potenzialmente costose</span><span class="sxs-lookup"><span data-stu-id="ce547-816">Potentially expensive routing features</span></span>

<span data-ttu-id="ce547-817">Nell'elenco seguente vengono fornite informazioni dettagliate sulle funzionalità di routing relativamente dispendiose rispetto ai modelli di route di base:</span><span class="sxs-lookup"><span data-stu-id="ce547-817">The following list provides some insight into routing features that are relatively expensive compared with basic route templates:</span></span>

* <span data-ttu-id="ce547-818">Espressioni regolari: è possibile scrivere espressioni regolari complesse o con tempi di esecuzione prolungati con una piccola quantità di input.</span><span class="sxs-lookup"><span data-stu-id="ce547-818">Regular expressions: It's possible to write regular expressions that are complex, or have long running time with a small amount of input.</span></span>

* <span data-ttu-id="ce547-819">Segmenti complessi ( `{x}-{y}-{z}` ):</span><span class="sxs-lookup"><span data-stu-id="ce547-819">Complex segments (`{x}-{y}-{z}`):</span></span> 
  * <span data-ttu-id="ce547-820">Sono molto più costosi dell'analisi di un segmento di percorso URL normale.</span><span class="sxs-lookup"><span data-stu-id="ce547-820">Are significantly more expensive than parsing a regular URL path segment.</span></span>
  * <span data-ttu-id="ce547-821">Comporta l'allocazione di molte altre sottostringhe.</span><span class="sxs-lookup"><span data-stu-id="ce547-821">Result in many more substrings being allocated.</span></span>
  * <span data-ttu-id="ce547-822">La logica del segmento complesso non è stata aggiornata nell'aggiornamento delle prestazioni di routing ASP.NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="ce547-822">The complex segment logic was not updated in ASP.NET Core 3.0 routing performance update.</span></span>

* <span data-ttu-id="ce547-823">Accesso sincrono ai dati: molte app complesse hanno accesso al database come parte del routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-823">Synchronous data access: Many complex apps have database access as part of their routing.</span></span> <span data-ttu-id="ce547-824">ASP.NET Core 2,2 e il routing precedente potrebbero non fornire i punti di estendibilità corretti per supportare il routing di accesso al database.</span><span class="sxs-lookup"><span data-stu-id="ce547-824">ASP.NET Core 2.2 and earlier routing might not provide the right extensibility points to support database access routing.</span></span> <span data-ttu-id="ce547-825">Ad esempio, <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> e <xref:Microsoft.AspNetCore.Mvc.ActionConstraints.IActionConstraint> sono sincroni.</span><span class="sxs-lookup"><span data-stu-id="ce547-825">For example, <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, and <xref:Microsoft.AspNetCore.Mvc.ActionConstraints.IActionConstraint> are synchronous.</span></span> <span data-ttu-id="ce547-826">I punti di estendibilità, ad esempio <xref:Microsoft.AspNetCore.Routing.MatcherPolicy> e, <xref:Microsoft.AspNetCore.Routing.EndpointSelectorContext> sono asincroni.</span><span class="sxs-lookup"><span data-stu-id="ce547-826">Extensibility points such as <xref:Microsoft.AspNetCore.Routing.MatcherPolicy> and <xref:Microsoft.AspNetCore.Routing.EndpointSelectorContext> are asynchronous.</span></span>

## <a name="guidance-for-library-authors"></a><span data-ttu-id="ce547-827">Linee guida per gli autori di librerie</span><span class="sxs-lookup"><span data-stu-id="ce547-827">Guidance for library authors</span></span>

<span data-ttu-id="ce547-828">Questa sezione contiene indicazioni per gli autori di librerie che si basano sul routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-828">This section contains guidance for library authors building on top of routing.</span></span> <span data-ttu-id="ce547-829">Questi dettagli sono destinati a garantire che gli sviluppatori di app abbiano un'esperienza ottimale usando le librerie e i Framework che estendono il routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-829">These details are intended to ensure that app developers have a good experience using libraries and frameworks that extend routing.</span></span>

### <a name="define-endpoints"></a><span data-ttu-id="ce547-830">Definire gli endpoint</span><span class="sxs-lookup"><span data-stu-id="ce547-830">Define endpoints</span></span>

<span data-ttu-id="ce547-831">Per creare un Framework che usa il routing per la corrispondenza degli URL, iniziare definendo un'esperienza utente basata su <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> .</span><span class="sxs-lookup"><span data-stu-id="ce547-831">To create a framework that uses routing for URL matching, start by defining a user experience that builds on top of <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>

<span data-ttu-id="ce547-832">**Eseguire** la compilazione sopra <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder> .</span><span class="sxs-lookup"><span data-stu-id="ce547-832">**DO** build on top of <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder>.</span></span> <span data-ttu-id="ce547-833">Ciò consente agli utenti di comporre il Framework con altre ASP.NET Core funzionalità senza confusione.</span><span class="sxs-lookup"><span data-stu-id="ce547-833">This allows users to compose your framework with other ASP.NET Core features without confusion.</span></span> <span data-ttu-id="ce547-834">Ogni modello di ASP.NET Core include il routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-834">Every ASP.NET Core template includes routing.</span></span> <span data-ttu-id="ce547-835">Si supponga che il routing sia presente e familiare per gli utenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-835">Assume routing is present and familiar for users.</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...);

    endpoints.MapHealthChecks("/healthz");
});
```

<span data-ttu-id="ce547-836">**Restituisce un** tipo concreto sealed da una chiamata a `MapMyFramework(...)` che implementa <xref:Microsoft.AspNetCore.Builder.IEndpointConventionBuilder> .</span><span class="sxs-lookup"><span data-stu-id="ce547-836">**DO** return a sealed concrete type from a call to `MapMyFramework(...)` that implements <xref:Microsoft.AspNetCore.Builder.IEndpointConventionBuilder>.</span></span> <span data-ttu-id="ce547-837">La maggior parte dei metodi del Framework `Map...` seguono questo modello.</span><span class="sxs-lookup"><span data-stu-id="ce547-837">Most framework `Map...` methods follow this pattern.</span></span> <span data-ttu-id="ce547-838">`IEndpointConventionBuilder`Interfaccia:</span><span class="sxs-lookup"><span data-stu-id="ce547-838">The `IEndpointConventionBuilder` interface:</span></span>

* <span data-ttu-id="ce547-839">Consente la composizione dei metadati.</span><span class="sxs-lookup"><span data-stu-id="ce547-839">Allows composability of metadata.</span></span>
* <span data-ttu-id="ce547-840">È destinato a un'ampia gamma di metodi di estensione.</span><span class="sxs-lookup"><span data-stu-id="ce547-840">Is targeted by a variety of extension methods.</span></span>

<span data-ttu-id="ce547-841">La dichiarazione di un tipo personalizzato consente di aggiungere funzionalità specifiche del Framework al generatore.</span><span class="sxs-lookup"><span data-stu-id="ce547-841">Declaring your own type allows you to add your own framework-specific functionality to the builder.</span></span> <span data-ttu-id="ce547-842">È possibile eseguire il wrapping di un generatore dichiarato dal Framework e inviare le chiamate.</span><span class="sxs-lookup"><span data-stu-id="ce547-842">It's ok to wrap a framework-declared builder and forward calls to it.</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...).RequireAuthorization()
                                 .WithMyFrameworkFeature(awesome: true);

    endpoints.MapHealthChecks("/healthz");
});
```

<span data-ttu-id="ce547-843">**Prendere in considerazione** la scrittura <xref:Microsoft.AspNetCore.Routing.EndpointDataSource> .</span><span class="sxs-lookup"><span data-stu-id="ce547-843">**CONSIDER** writing your own <xref:Microsoft.AspNetCore.Routing.EndpointDataSource>.</span></span> <span data-ttu-id="ce547-844">`EndpointDataSource` è la primitiva di basso livello per la dichiarazione e l'aggiornamento di una raccolta di endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-844">`EndpointDataSource` is the low-level primitive for declaring and updating a collection of endpoints.</span></span> <span data-ttu-id="ce547-845">`EndpointDataSource` è un'API potente utilizzata dai controller e dalle Razor pagine.</span><span class="sxs-lookup"><span data-stu-id="ce547-845">`EndpointDataSource` is a powerful API used by controllers and Razor Pages.</span></span>

<span data-ttu-id="ce547-846">I test di routing hanno un [esempio di base](https://github.com/dotnet/AspNetCore/blob/main/src/Http/Routing/test/testassets/RoutingSandbox/Framework/FrameworkEndpointDataSource.cs#L17) di un'origine dati che non esegue l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-846">The routing tests have a [basic example](https://github.com/dotnet/AspNetCore/blob/main/src/Http/Routing/test/testassets/RoutingSandbox/Framework/FrameworkEndpointDataSource.cs#L17) of a non-updating data source.</span></span>

<span data-ttu-id="ce547-847">**Non** tentare di registrare un per `EndpointDataSource` impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="ce547-847">**DO NOT** attempt to register an `EndpointDataSource` by default.</span></span> <span data-ttu-id="ce547-848">Richiedere agli utenti di registrare il Framework in <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> .</span><span class="sxs-lookup"><span data-stu-id="ce547-848">Require users to register your framework in <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span> <span data-ttu-id="ce547-849">La filosofia del routing è che nulla è incluso per impostazione predefinita ed `UseEndpoints` è la posizione in cui registrare gli endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-849">The philosophy of routing is that nothing is included by default, and that `UseEndpoints` is the place to register endpoints.</span></span>

### <a name="creating-routing-integrated-middleware"></a><span data-ttu-id="ce547-850">Creazione del middleware integrato per il routing</span><span class="sxs-lookup"><span data-stu-id="ce547-850">Creating routing-integrated middleware</span></span>

<span data-ttu-id="ce547-851">**Prendere in considerazione** la definizione di tipi di metadati come interfaccia.</span><span class="sxs-lookup"><span data-stu-id="ce547-851">**CONSIDER** defining metadata types as an interface.</span></span>

<span data-ttu-id="ce547-852"> È possibile utilizzare i tipi di metadati come attributo per classi e metodi.</span><span class="sxs-lookup"><span data-stu-id="ce547-852">**DO** make it possible to use metadata types as an attribute on classes and methods.</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/ICoolMetadata.cs?name=snippet2)]

<span data-ttu-id="ce547-853">I Framework come controller e Razor pagine supportano l'applicazione di attributi di metadati ai tipi e ai metodi.</span><span class="sxs-lookup"><span data-stu-id="ce547-853">Frameworks like controllers and Razor Pages support applying metadata attributes to types and methods.</span></span> <span data-ttu-id="ce547-854">Se si dichiarano i tipi di metadati:</span><span class="sxs-lookup"><span data-stu-id="ce547-854">If you declare metadata types:</span></span>

* <span data-ttu-id="ce547-855">Renderli accessibili come [attributi](/dotnet/csharp/programming-guide/concepts/attributes/).</span><span class="sxs-lookup"><span data-stu-id="ce547-855">Make them accessible as [attributes](/dotnet/csharp/programming-guide/concepts/attributes/).</span></span>
* <span data-ttu-id="ce547-856">La maggior parte degli utenti ha familiarità con l'applicazione di attributi.</span><span class="sxs-lookup"><span data-stu-id="ce547-856">Most users are familiar with applying attributes.</span></span>

<span data-ttu-id="ce547-857">La dichiarazione di un tipo di metadati come interfaccia comporta l'aggiunta di un altro livello di flessibilità:</span><span class="sxs-lookup"><span data-stu-id="ce547-857">Declaring a metadata type as an interface adds another layer of flexibility:</span></span>

* <span data-ttu-id="ce547-858">Le interfacce sono componibili.</span><span class="sxs-lookup"><span data-stu-id="ce547-858">Interfaces are composable.</span></span>
* <span data-ttu-id="ce547-859">Gli sviluppatori possono dichiarare tipi propri che combinano più criteri.</span><span class="sxs-lookup"><span data-stu-id="ce547-859">Developers can declare their own types that combine multiple policies.</span></span>

<span data-ttu-id="ce547-860">È **possibile eseguire l'** override dei metadati, come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-860">**DO** make it possible to override metadata, as shown in the following example:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/ICoolMetadata.cs?name=snippet)]

<span data-ttu-id="ce547-861">Il modo migliore per seguire queste linee guida consiste nell'evitare di definire i **metadati del marcatore**:</span><span class="sxs-lookup"><span data-stu-id="ce547-861">The best way to follow these guidelines is to avoid defining **marker metadata**:</span></span>

* <span data-ttu-id="ce547-862">Non solo cercare la presenza di un tipo di metadati.</span><span class="sxs-lookup"><span data-stu-id="ce547-862">Don't just look for the presence of a metadata type.</span></span>
* <span data-ttu-id="ce547-863">Definire una proprietà nei metadati e controllare la proprietà.</span><span class="sxs-lookup"><span data-stu-id="ce547-863">Define a property on the metadata and check the property.</span></span>

<span data-ttu-id="ce547-864">La raccolta dei metadati è ordinata e supporta l'override per priorità.</span><span class="sxs-lookup"><span data-stu-id="ce547-864">The metadata collection is ordered and supports overriding by priority.</span></span> <span data-ttu-id="ce547-865">Nel caso di controller, i metadati del metodo di azione sono più specifici.</span><span class="sxs-lookup"><span data-stu-id="ce547-865">In the case of controllers, metadata on the action method is most specific.</span></span>

<span data-ttu-id="ce547-866">**Rendere il** middleware utile con e senza routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-866">**DO** make middleware useful with and without routing.</span></span>

```csharp
app.UseRouting();

app.UseAuthorization(new AuthorizationPolicy() { ... });

app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...).RequireAuthorization();
});
```

<span data-ttu-id="ce547-867">Come esempio di questa linea guida, prendere in considerazione il `UseAuthorization` middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-867">As an example of this guideline, consider the `UseAuthorization` middleware.</span></span> <span data-ttu-id="ce547-868">Il middleware di autorizzazione consente di passare un criterio di fallback.</span><span class="sxs-lookup"><span data-stu-id="ce547-868">The authorization middleware allows you to pass in a fallback policy.</span></span> <!-- shown where?  (shown here) --> <span data-ttu-id="ce547-869">I criteri di fallback, se specificati, si applicano a entrambi:</span><span class="sxs-lookup"><span data-stu-id="ce547-869">The fallback policy, if specified, applies to both:</span></span>

* <span data-ttu-id="ce547-870">Endpoint senza criteri specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-870">Endpoints without a specified policy.</span></span>
* <span data-ttu-id="ce547-871">Richieste che non corrispondono a un endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-871">Requests that don't match an endpoint.</span></span>

<span data-ttu-id="ce547-872">In questo modo il middleware di autorizzazione risulta utile al di fuori del contesto di routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-872">This makes the authorization middleware useful outside of the context of routing.</span></span> <span data-ttu-id="ce547-873">Il middleware di autorizzazione può essere usato per la programmazione middleware tradizionale.</span><span class="sxs-lookup"><span data-stu-id="ce547-873">The authorization middleware can be used for traditional middleware programming.</span></span>

[!INCLUDE[](~/includes/dbg-route.md)]

::: moniker-end

::: moniker range="= aspnetcore-2.2"

<span data-ttu-id="ce547-874">Il routing è responsabile del mapping degli URI di richiesta agli endpoint e dell'invio di richieste in ingresso a tali endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-874">Routing is responsible for mapping request URIs to endpoints and dispatching incoming requests to those endpoints.</span></span> <span data-ttu-id="ce547-875">Le route sono definite nell'app e vengono configurate all'avvio dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-875">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="ce547-876">Una route può facoltativamente estrarre valori dall'URL contenuto nella richiesta e questi valori possono quindi essere usati per l'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-876">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="ce547-877">Usando le informazioni sulla route dall'app, il routing è anche in grado di generare URL con mapping agli endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-877">Using route information from the app, routing is also able to generate URLs that map to endpoints.</span></span>

<span data-ttu-id="ce547-878">Per usare gli scenari di routing più recenti in ASP.NET Core 2.2, specificare la [versione di compatibilità](xref:mvc/compatibility-version) nella registrazione dei servizi MVC in `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="ce547-878">To use the latest routing scenarios in ASP.NET Core 2.2, specify the [compatibility version](xref:mvc/compatibility-version) to the MVC services registration in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);
```

<span data-ttu-id="ce547-879">L'opzione <xref:Microsoft.AspNetCore.Mvc.MvcOptions.EnableEndpointRouting> determina se il routing deve usare internamente la logica basata sugli endpoint o la logica basata su <xref:Microsoft.AspNetCore.Routing.IRouter> di ASP.NET Core 2.1 o versioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-879">The <xref:Microsoft.AspNetCore.Mvc.MvcOptions.EnableEndpointRouting> option determines if routing should internally use endpoint-based logic or the <xref:Microsoft.AspNetCore.Routing.IRouter>-based logic of ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="ce547-880">Quando la versione di compatibilità è impostata su 2.2 o versioni successive, il valore predefinito è `true`.</span><span class="sxs-lookup"><span data-stu-id="ce547-880">When the compatibility version is set to 2.2 or later, the default value is `true`.</span></span> <span data-ttu-id="ce547-881">Impostare il valore su `false` per usare la logica di routing precedente:</span><span class="sxs-lookup"><span data-stu-id="ce547-881">Set the value to `false` to use the prior routing logic:</span></span>

```csharp
// Use the routing logic of ASP.NET Core 2.1 or earlier:
services.AddMvc(options => options.EnableEndpointRouting = false)
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);
```

<span data-ttu-id="ce547-882">Per altre informazioni sul routing basato su <xref:Microsoft.AspNetCore.Routing.IRouter>, vedere la [versione per ASP.NET Core 2.1 di questo argomento](?view=aspnetcore-2.1).</span><span class="sxs-lookup"><span data-stu-id="ce547-882">For more information on <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, see the [ASP.NET Core 2.1 version of this topic](?view=aspnetcore-2.1).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ce547-883">Questo documento descrive il routing di basso livello di ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="ce547-883">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="ce547-884">Per informazioni sul routing di ASP.NET Core MVC, vedere <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="ce547-884">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="ce547-885">Per informazioni sulle convenzioni di routing nelle Razor pagine, vedere <xref:razor-pages/razor-pages-conventions> .</span><span class="sxs-lookup"><span data-stu-id="ce547-885">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="ce547-886">[Visualizzare o scaricare il codice di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples) ([procedura per il download](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="ce547-886">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="ce547-887">Nozioni fondamentali sul routing</span><span class="sxs-lookup"><span data-stu-id="ce547-887">Routing basics</span></span>

<span data-ttu-id="ce547-888">La maggior parte delle app dovrebbe scegliere uno schema di routing semplice e descrittivo in modo che gli URL siano leggibili e significativi.</span><span class="sxs-lookup"><span data-stu-id="ce547-888">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="ce547-889">La route convenzionale predefinita `{controller=Home}/{action=Index}/{id?}`:</span><span class="sxs-lookup"><span data-stu-id="ce547-889">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="ce547-890">Supporta uno schema di routing semplice e descrittivo.</span><span class="sxs-lookup"><span data-stu-id="ce547-890">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="ce547-891">È un punto iniziale utile per le app basate su interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="ce547-891">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="ce547-892">Gli sviluppatori aggiungono in genere Route concise aggiuntive a aree con traffico elevato di un'app in situazioni specializzate usando il [routing degli attributi](xref:mvc/controllers/routing#attribute-routing) o route convenzionali dedicate.</span><span class="sxs-lookup"><span data-stu-id="ce547-892">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span> <span data-ttu-id="ce547-893">Esempi di situazioni specializzate sono gli endpoint di Blog e ecommerce.</span><span class="sxs-lookup"><span data-stu-id="ce547-893">Specialized situations examples include, blog and ecommerce endpoints.</span></span>

<span data-ttu-id="ce547-894">Le API Web devono usare il routing degli attributi per modellare le funzionalità dell'app come set di risorse in cui le operazioni sono rappresentate da verbi HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce547-894">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="ce547-895">Ciò significa che molte operazioni, ad esempio GET e POST, sulla stessa risorsa logica utilizzano lo stesso URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-895">This means that many operations, for example, GET, and POST, on the same logical resource use the same URL.</span></span> <span data-ttu-id="ce547-896">Il routing degli attributi offre un livello di controllo necessario per progettare con attenzione il layout dell'endpoint pubblico di un'API.</span><span class="sxs-lookup"><span data-stu-id="ce547-896">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="ce547-897">Razor Le app di pagine usano il routing convenzionale predefinito per gestire le risorse denominate nella cartella *pagine* di un'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-897">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="ce547-898">Sono disponibili convenzioni aggiuntive che consentono di personalizzare il Razor comportamento di routing delle pagine.</span><span class="sxs-lookup"><span data-stu-id="ce547-898">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="ce547-899">Per altre informazioni, vedere <xref:razor-pages/index> e <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="ce547-899">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="ce547-900">Il supporto della generazione di URL consente di sviluppare l'app senza URL hardcoded per collegare l'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-900">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="ce547-901">Il supporto consente di iniziare con una configurazione di routing di base e di modificare le route dopo aver determinato il layout delle risorse dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-901">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="ce547-902">Il routing usa gli *endpoint* ( `Endpoint` ) per rappresentare gli endpoint logici in un'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-902">Routing uses *endpoints* (`Endpoint`) to represent logical endpoints in an app.</span></span>

<span data-ttu-id="ce547-903">Un endpoint definisce un delegato per l'elaborazione delle richieste e una raccolta di metadati arbitrari.</span><span class="sxs-lookup"><span data-stu-id="ce547-903">An endpoint defines a delegate to process requests and a collection of arbitrary metadata.</span></span> <span data-ttu-id="ce547-904">I metadati vengono usati per implementare gli elementi trasversali in base ai criteri e la configurazione associata a ogni endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-904">The metadata is used implement cross-cutting concerns based on policies and configuration attached to each endpoint.</span></span>

<span data-ttu-id="ce547-905">Il sistema di routing ha le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-905">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="ce547-906">La sintassi del modello di route viene usata per definire le route con parametri di route in formato token.</span><span class="sxs-lookup"><span data-stu-id="ce547-906">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="ce547-907">La configurazione degli endpoint basata su convenzioni e attributi è consentita.</span><span class="sxs-lookup"><span data-stu-id="ce547-907">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="ce547-908"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> consente di determinare se un parametro URL contiene un valore valido per il vincolo di un endpoint specifico.</span><span class="sxs-lookup"><span data-stu-id="ce547-908"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="ce547-909">I modelli di app, ad esempio MVC/ Razor pages, registrano tutti i relativi endpoint, che hanno un'implementazione prevedibile degli scenari di routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-909">App models, such as MVC/Razor Pages, register all of their endpoints, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="ce547-910">L'implementazione del routing determina le decisioni relative al routing nel punto desiderato della pipeline del middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-910">The routing implementation makes routing decisions wherever desired in the middleware pipeline.</span></span>
* <span data-ttu-id="ce547-911">Il middleware successivo a un middleware di routing può esaminare il risultato della decisione dell'endpoint del middleware di routing per un URI di richiesta specifico.</span><span class="sxs-lookup"><span data-stu-id="ce547-911">Middleware that appears after a Routing Middleware can inspect the result of the Routing Middleware's endpoint decision for a given request URI.</span></span>
* <span data-ttu-id="ce547-912">È possibile enumerare tutti gli endpoint nell'app in un punto qualsiasi della pipeline del middleware.</span><span class="sxs-lookup"><span data-stu-id="ce547-912">It's possible to enumerate all of the endpoints in the app anywhere in the middleware pipeline.</span></span>
* <span data-ttu-id="ce547-913">Un'app può usare il routing per generare URL, ad esempio per il reindirizzamento o i collegamenti, in base alle informazioni degli endpoint. In questo modo si evita di impostare gli URL come hardcoded ottimizzando la manutenibilità.</span><span class="sxs-lookup"><span data-stu-id="ce547-913">An app can use routing to generate URLs (for example, for redirection or links) based on endpoint information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="ce547-914">La generazione degli URL è basata sugli indirizzi, che supportano l'estensibilità arbitraria:</span><span class="sxs-lookup"><span data-stu-id="ce547-914">URL generation is based on addresses, which support arbitrary extensibility:</span></span>

  * <span data-ttu-id="ce547-915">L'API del generatore di collegamenti (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) può essere risolta ovunque tramite l'[inserimento delle dipendenze](xref:fundamentals/dependency-injection) per generare gli URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-915">The Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) can be resolved anywhere using [dependency injection (DI)](xref:fundamentals/dependency-injection) to generate URLs.</span></span>
  * <span data-ttu-id="ce547-916">Se l'API del generatore di collegamenti non è disponibile tramite l'inserimento delle dipendenze, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offre metodi per la generazione degli URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-916">Where the Link Generator API isn't available via DI, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>

> [!NOTE]
> <span data-ttu-id="ce547-917">Con il rilascio del routing degli endpoint in ASP.NET Core 2,2, il collegamento dell'endpoint è limitato alle Razor azioni e alle pagine MVC/pagine.</span><span class="sxs-lookup"><span data-stu-id="ce547-917">With the release of endpoint routing in ASP.NET Core 2.2, endpoint linking is limited to MVC/Razor Pages actions and pages.</span></span> <span data-ttu-id="ce547-918">Le espansioni delle funzionalità di collegamento degli endpoint sono previste per le versioni future.</span><span class="sxs-lookup"><span data-stu-id="ce547-918">The expansions of endpoint-linking capabilities is planned for future releases.</span></span>

<span data-ttu-id="ce547-919">Il routing è connesso alla pipeline [middleware](xref:fundamentals/middleware/index) per mezzo della classe <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>.</span><span class="sxs-lookup"><span data-stu-id="ce547-919">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="ce547-920">[ASP.NET Core MVC](xref:mvc/overview) aggiunge il routing alla pipeline middleware come parte della configurazione e gestisce il routing nelle app MVC e Razor pages.</span><span class="sxs-lookup"><span data-stu-id="ce547-920">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="ce547-921">Per informazioni sull'uso del routing come componente autonomo, vedere la sezione [Usare il middleware di routing](#use-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="ce547-921">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="ce547-922">Corrispondenza URL</span><span class="sxs-lookup"><span data-stu-id="ce547-922">URL matching</span></span>

<span data-ttu-id="ce547-923">La corrispondenza dell'URL è il processo con cui il routing invia una richiesta in ingresso a un *endpoint*.</span><span class="sxs-lookup"><span data-stu-id="ce547-923">URL matching is the process by which routing dispatches an incoming request to an *endpoint*.</span></span> <span data-ttu-id="ce547-924">Questo processo si basa sui dati presenti nel percorso URL, ma può essere esteso in modo da prendere in considerazione tutti i dati della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-924">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="ce547-925">La possibilità di inviare le richieste a gestori separati è fondamentale per ridurre le dimensioni e la complessità di un'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-925">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="ce547-926">Il sistema di routing nell'endpoint di routing è responsabile di tutte le decisioni relative all'invio.</span><span class="sxs-lookup"><span data-stu-id="ce547-926">The routing system in endpoint routing is responsible for all dispatching decisions.</span></span> <span data-ttu-id="ce547-927">Poiché il middleware applica i criteri in base all'endpoint selezionato, è importante che qualsiasi decisione che può influire sull'invio o l'applicazione dei criteri di sicurezza venga effettuata all'interno del sistema di routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-927">Since the middleware applies policies based on the selected endpoint, it's important that any decision that can affect dispatching or the application of security policies is made inside the routing system.</span></span>

<span data-ttu-id="ce547-928">Quando viene eseguito il delegato dell'endpoint, le proprietà di [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) vengono impostate sui valori appropriati in base all'elaborazione della richiesta eseguita fino a quel punto.</span><span class="sxs-lookup"><span data-stu-id="ce547-928">When the endpoint delegate is executed, the properties of [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) are set to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="ce547-929">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) è un dizionario di *valori di route* prodotti dalla route.</span><span class="sxs-lookup"><span data-stu-id="ce547-929">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="ce547-930">Questi valori in genere sono determinati dalla suddivisione in token dell'URL e possono essere usati per accettare l'input dell'utente o per prendere ulteriori decisioni riguardo all'invio all'interno dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-930">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="ce547-931">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) è un elenco proprietà dei dati aggiuntivi correlati alla route corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-931">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="ce547-932">Gli elementi <xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> vengono forniti per supportare l'associazione dei dati sullo stato con ogni route in modo che l'app sia in grado di prendere decisioni in base alla route corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-932"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="ce547-933">Questi valori sono definiti dallo sviluppatore e **non** influiscono sul comportamento del routing in alcun modo.</span><span class="sxs-lookup"><span data-stu-id="ce547-933">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="ce547-934">Inoltre, i valori accantonati in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) possono essere di qualsiasi tipo, a differenza dei valori [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values) che devono essere convertibili in e da stringhe.</span><span class="sxs-lookup"><span data-stu-id="ce547-934">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="ce547-935">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) è un elenco delle route che hanno preso parte alla corrispondenza corretta della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-935">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="ce547-936">Le route possono essere annidate l'una nell'altra.</span><span class="sxs-lookup"><span data-stu-id="ce547-936">Routes can be nested inside of one another.</span></span> <span data-ttu-id="ce547-937">La proprietà <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> rispecchia il percorso tramite l'albero logico di route che hanno prodotto una corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-937">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="ce547-938">In genere il primo elemento in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> è la raccolta di route e deve essere usato per la generazione di URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-938">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="ce547-939">L'ultimo elemento in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> è il gestore di route corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-939">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation-with-linkgenerator"></a><span data-ttu-id="ce547-940">Generazione di URL con LinkGenerator</span><span class="sxs-lookup"><span data-stu-id="ce547-940">URL generation with LinkGenerator</span></span>

<span data-ttu-id="ce547-941">La generazione di URL è il processo con cui il routing crea un percorso URL basato su un set di valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-941">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="ce547-942">Questo consente di avere una separazione logica tra gli endpoint e gli URL che vi accedono.</span><span class="sxs-lookup"><span data-stu-id="ce547-942">This allows for a logical separation between your endpoints and the URLs that access them.</span></span>

<span data-ttu-id="ce547-943">Il routing di endpoint include l'API del generatore di collegamenti (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span><span class="sxs-lookup"><span data-stu-id="ce547-943">Endpoint routing includes the Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span></span> <span data-ttu-id="ce547-944"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> è un servizio singleton che può essere recuperato da [di](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="ce547-944"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is a singleton service that can be retrieved from [DI](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="ce547-945">L'API può essere usata all'esterno del contesto di una richiesta in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="ce547-945">The API can be used outside of the context of an executing request.</span></span> <span data-ttu-id="ce547-946"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> e gli scenari di MVC basati su <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, ad esempio [helper tag](xref:mvc/views/tag-helpers/intro), helper HTML e [risultati delle azioni](xref:mvc/controllers/actions), usano il generatore di collegamenti per offrire le funzionalità di generazione di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-946">MVC's <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> and scenarios that rely on <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, such as [Tag Helpers](xref:mvc/views/tag-helpers/intro), HTML Helpers, and [Action Results](xref:mvc/controllers/actions), use the link generator to provide link generating capabilities.</span></span>

<span data-ttu-id="ce547-947">Il generatore di collegamenti si basa sui concetti di *indirizzo* e di *schemi di indirizzi*.</span><span class="sxs-lookup"><span data-stu-id="ce547-947">The link generator is backed by the concept of an *address* and *address schemes*.</span></span> <span data-ttu-id="ce547-948">Lo schema di indirizzi consente di determinare gli endpoint che devono essere considerati per la generazione dei collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-948">An address scheme is a way of determining the endpoints that should be considered for link generation.</span></span> <span data-ttu-id="ce547-949">Ad esempio, gli scenari relativi al nome della route e ai valori di route molti utenti hanno familiarità con MVC/ Razor pages sono implementati come uno schema di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="ce547-949">For example, the route name and route values scenarios many users are familiar with from MVC/Razor Pages are implemented as an address scheme.</span></span>

<span data-ttu-id="ce547-950">Il generatore di collegamenti può essere collegato a Razor pagine e azioni MVC/pagine tramite i metodi di estensione seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-950">The link generator can link to MVC/Razor Pages actions and pages via the following extension methods:</span></span>

* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetPathByAction*>
* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetUriByAction*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetPathByPage*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetUriByPage*>

<span data-ttu-id="ce547-951">Un overload di questi metodi accetta gli argomenti che includono `HttpContext`.</span><span class="sxs-lookup"><span data-stu-id="ce547-951">An overload of these methods accepts arguments that include the `HttpContext`.</span></span> <span data-ttu-id="ce547-952">Questi metodi sono funzionalmente equivalenti a `Url.Action` e `Url.Page` ma offrono una maggiore flessibilità e altre opzioni.</span><span class="sxs-lookup"><span data-stu-id="ce547-952">These methods are functionally equivalent to `Url.Action` and `Url.Page` but offer additional flexibility and options.</span></span>

<span data-ttu-id="ce547-953">I metodi `GetPath*` sono più simili a `Url.Action` e `Url.Page` poiché generano un URI che contiene un percorso assoluto.</span><span class="sxs-lookup"><span data-stu-id="ce547-953">The `GetPath*` methods are most similar to `Url.Action` and `Url.Page` in that they generate a URI containing an absolute path.</span></span> <span data-ttu-id="ce547-954">I metodi `GetUri*` generano sempre un URI assoluto contenente uno schema e un host.</span><span class="sxs-lookup"><span data-stu-id="ce547-954">The `GetUri*` methods always generate an absolute URI containing a scheme and host.</span></span> <span data-ttu-id="ce547-955">I metodi che accettano `HttpContext` generano un URI nel contesto della richiesta in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="ce547-955">The methods that accept an `HttpContext` generate a URI in the context of the executing request.</span></span> <span data-ttu-id="ce547-956">Se non vengono sovrascritti, vengono usati i valori di route di ambiente, il percorso base dell'URL, lo schema e l'host dalla richiesta in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="ce547-956">The ambient route values, URL base path, scheme, and host from the executing request are used unless overridden.</span></span>

<span data-ttu-id="ce547-957"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> viene chiamato con un indirizzo.</span><span class="sxs-lookup"><span data-stu-id="ce547-957"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is called with an address.</span></span> <span data-ttu-id="ce547-958">La generazione di un URI viene eseguita in due passaggi:</span><span class="sxs-lookup"><span data-stu-id="ce547-958">Generating a URI occurs in two steps:</span></span>

1. <span data-ttu-id="ce547-959">Un indirizzo viene associato a un elenco di endpoint che corrispondono all'indirizzo.</span><span class="sxs-lookup"><span data-stu-id="ce547-959">An address is bound to a list of endpoints that match the address.</span></span>
1. <span data-ttu-id="ce547-960">`RoutePattern` di ogni endpoint viene valutato fino a quando non viene individuato un formato di route che corrisponde ai valori specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-960">Each endpoint's `RoutePattern` is evaluated until a route pattern that matches the supplied values is found.</span></span> <span data-ttu-id="ce547-961">L'output risultante viene unito alle altre parti dell'URI specificate nel generatore di collegamenti e restituito.</span><span class="sxs-lookup"><span data-stu-id="ce547-961">The resulting output is combined with the other URI parts supplied to the link generator and returned.</span></span>

<span data-ttu-id="ce547-962">I metodi forniti da <xref:Microsoft.AspNetCore.Routing.LinkGenerator> supportano le funzionalità di generazione di collegamenti standard per tutti i tipi di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="ce547-962">The methods provided by <xref:Microsoft.AspNetCore.Routing.LinkGenerator> support standard link generation capabilities for any type of address.</span></span> <span data-ttu-id="ce547-963">È consigliabile usare il generatore di collegamenti tramite i metodi di estensione che eseguono le operazioni per un tipo di indirizzo specifico.</span><span class="sxs-lookup"><span data-stu-id="ce547-963">The most convenient way to use the link generator is through extension methods that perform operations for a specific address type.</span></span>

| <span data-ttu-id="ce547-964">Metodo di estensione</span><span class="sxs-lookup"><span data-stu-id="ce547-964">Extension Method</span></span>   | <span data-ttu-id="ce547-965">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ce547-965">Description</span></span>                                                         |
| ------------------ | ------------------------------------------------------------------- |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*> | <span data-ttu-id="ce547-966">Genera un URI con un percorso assoluto in base ai valori specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-966">Generates a URI with an absolute path based on the provided values.</span></span> |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetUriByAddress*> | <span data-ttu-id="ce547-967">Genera un URI assoluto in base ai valori specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-967">Generates an absolute URI based on the provided values.</span></span>             |

> [!WARNING]
> <span data-ttu-id="ce547-968">Prestare attenzione alle implicazioni seguenti della chiamata ai metodi <xref:Microsoft.AspNetCore.Routing.LinkGenerator>:</span><span class="sxs-lookup"><span data-stu-id="ce547-968">Pay attention to the following implications of calling <xref:Microsoft.AspNetCore.Routing.LinkGenerator> methods:</span></span>
>
> * <span data-ttu-id="ce547-969">Usare i metodi di estensione `GetUri*` con cautela in una configurazione di app che non convalida l'intestazione `Host` delle richieste in ingresso.</span><span class="sxs-lookup"><span data-stu-id="ce547-969">Use `GetUri*` extension methods with caution in an app configuration that doesn't validate the `Host` header of incoming requests.</span></span> <span data-ttu-id="ce547-970">Se l'intestazione `Host` delle richieste in ingresso non viene convalidata, l'input delle richieste non attendibili può essere inviato nuovamente al client negli URI di una visualizzazione o pagina.</span><span class="sxs-lookup"><span data-stu-id="ce547-970">If the `Host` header of incoming requests isn't validated, untrusted request input can be sent back to the client in URIs in a view/page.</span></span> <span data-ttu-id="ce547-971">È consigliabile che in tutte le app di produzione il server sia configurato per la convalida dell'intestazione `Host` rispetto ai valori validi noti.</span><span class="sxs-lookup"><span data-stu-id="ce547-971">We recommend that all production apps configure their server to validate the `Host` header against known valid values.</span></span>
>
> * <span data-ttu-id="ce547-972">Usare <xref:Microsoft.AspNetCore.Routing.LinkGenerator> con cautela nel middleware in associazione a `Map` o `MapWhen`.</span><span class="sxs-lookup"><span data-stu-id="ce547-972">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> with caution in middleware in combination with `Map` or `MapWhen`.</span></span> <span data-ttu-id="ce547-973">`Map*` modifica il percorso di base della richiesta in esecuzione, che ha effetto sull'output della generazione di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-973">`Map*` changes the base path of the executing request, which affects the output of link generation.</span></span> <span data-ttu-id="ce547-974">Tutte le API <xref:Microsoft.AspNetCore.Routing.LinkGenerator> consentono di specificare un percorso di base.</span><span class="sxs-lookup"><span data-stu-id="ce547-974">All of the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> APIs allow specifying a base path.</span></span> <span data-ttu-id="ce547-975">Specificare sempre un percorso di base vuoto per annullare l'effetto di `Map*` sulla generazione di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-975">Always specify an empty base path to undo `Map*`'s affect on link generation.</span></span>

## <a name="differences-from-earlier-versions-of-routing"></a><span data-ttu-id="ce547-976">Differenze rispetto alle versioni precedenti del routing</span><span class="sxs-lookup"><span data-stu-id="ce547-976">Differences from earlier versions of routing</span></span>

<span data-ttu-id="ce547-977">Tra il routing di endpoint in ASP.NET Core 2.2 o versioni successive e le versioni precedenti del routing in ASP.NET Core esistono alcune differenze:</span><span class="sxs-lookup"><span data-stu-id="ce547-977">A few differences exist between endpoint routing in ASP.NET Core 2.2 or later and earlier versions of routing in ASP.NET Core:</span></span>

* <span data-ttu-id="ce547-978">Il sistema di routing di endpoint non supporta l'estensibilità basata su <xref:Microsoft.AspNetCore.Routing.IRouter>, inclusa l'eredità da <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="ce547-978">The endpoint routing system doesn't support <xref:Microsoft.AspNetCore.Routing.IRouter>-based extensibility, including inheriting from <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>

* <span data-ttu-id="ce547-979">Il routing di endpoint non supporta [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span><span class="sxs-lookup"><span data-stu-id="ce547-979">Endpoint routing doesn't support [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span></span> <span data-ttu-id="ce547-980">Usare la [versione di compatibilità](xref:mvc/compatibility-version) 2,1 ( `.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)` ) per continuare a usare lo shim di compatibilità.</span><span class="sxs-lookup"><span data-stu-id="ce547-980">Use the 2.1 [compatibility version](xref:mvc/compatibility-version) (`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`) to continue using the compatibility shim.</span></span>

* <span data-ttu-id="ce547-981">Il routing di endpoint ha un comportamento diverso per l'utilizzo delle maiuscole e delle minuscole degli URI generati quando si usano le route convenzionali.</span><span class="sxs-lookup"><span data-stu-id="ce547-981">Endpoint Routing has different behavior for the casing of generated URIs when using conventional routes.</span></span>

  <span data-ttu-id="ce547-982">Esaminare il modello di route predefinito seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-982">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="ce547-983">Si supponga di generare un collegamento a un'azione usando la route seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-983">Suppose you generate a link to an action using the following route:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "blog", new { id = 17, });
  ```

  <span data-ttu-id="ce547-984">Con il routing basato su <xref:Microsoft.AspNetCore.Routing.IRouter>, questo codice genera un URI di `/blog/ReadPost/17`, che rispetta le maiuscole e le minuscole del valore di route specificato.</span><span class="sxs-lookup"><span data-stu-id="ce547-984">With <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, this code generates a URI of `/blog/ReadPost/17`, which respects the casing of the provided route value.</span></span> <span data-ttu-id="ce547-985">Il routing di endpoint in ASP.NET Core 2.2 o versioni successive produce `/Blog/ReadPost/17` ("Blog" viene convertita in lettere maiuscole).</span><span class="sxs-lookup"><span data-stu-id="ce547-985">Endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` ("Blog" is capitalized).</span></span> <span data-ttu-id="ce547-986">Il routing di endpoint offre l'interfaccia `IOutboundParameterTransformer` che può essere usata per personalizzare questo comportamento globalmente o per applicare convenzioni diverse per il mapping degli URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-986">Endpoint routing provides the `IOutboundParameterTransformer` interface that can be used to customize this behavior globally or to apply different conventions for mapping URLs.</span></span>

  <span data-ttu-id="ce547-987">Per altre informazioni, vedere la sezione [Riferimento ai trasformatori di parametro](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-987">For more information, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

* <span data-ttu-id="ce547-988">La generazione di collegamenti utilizzata da MVC/ Razor pagine con route convenzionali si comporta in modo diverso quando si tenta di eseguire il collegamento a un controller, un'azione o una pagina che non esiste.</span><span class="sxs-lookup"><span data-stu-id="ce547-988">Link Generation used by MVC/Razor Pages with conventional routes behaves differently when attempting to link to an controller/action or page that doesn't exist.</span></span>

  <span data-ttu-id="ce547-989">Esaminare il modello di route predefinito seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-989">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="ce547-990">Si supponga di generare un collegamento a un'azione usando il modello predefinito con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="ce547-990">Suppose you generate a link to an action using the default template with the following:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "Blog", new { id = 17, });
  ```

  <span data-ttu-id="ce547-991">Con il routing basato su `IRouter`, il risultato è sempre `/Blog/ReadPost/17`, anche se `BlogController` non è presente o non ha un metodo di azione `ReadPost`.</span><span class="sxs-lookup"><span data-stu-id="ce547-991">With `IRouter`-based routing, the result is always `/Blog/ReadPost/17`, even if the `BlogController` doesn't exist or doesn't have a `ReadPost` action method.</span></span> <span data-ttu-id="ce547-992">Come previsto, il routing di endpoint in ASP.NET Core 2.2 o versioni successive produce `/Blog/ReadPost/17` se è presente il metodo di azione.</span><span class="sxs-lookup"><span data-stu-id="ce547-992">As expected, endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` if the action method exists.</span></span> <span data-ttu-id="ce547-993">*Tuttavia, il routing di endpoint produce una stringa vuota se l'azione non è presente.*</span><span class="sxs-lookup"><span data-stu-id="ce547-993">*However, endpoint routing produces an empty string if the action doesn't exist.*</span></span> <span data-ttu-id="ce547-994">Concettualmente, il routing di endpoint non presume che l'endpoint sia presente se l'azione non è presente.</span><span class="sxs-lookup"><span data-stu-id="ce547-994">Conceptually, endpoint routing doesn't assume that the endpoint exists if the action doesn't exist.</span></span>

* <span data-ttu-id="ce547-995">L'*algoritmo di invalidamento dei valori di ambiente* della generazione di collegamenti ha un comportamento diverso quando viene usato con il routing di endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-995">The link generation *ambient value invalidation algorithm* behaves differently when used with endpoint routing.</span></span>

  <span data-ttu-id="ce547-996">L'*invalidamento dei valori di ambiente* è l'algoritmo che decide quali valori di route della richiesta in esecuzione (valori di ambiente) possono essere usati nelle operazioni di generazione di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-996">*Ambient value invalidation* is the algorithm that decides which route values from the currently executing request (the ambient values) can be used in link generation operations.</span></span> <span data-ttu-id="ce547-997">Il routing convenzionale ha sempre invalidato i valori di route aggiuntivi durante il collegamento a un'azione diversa.</span><span class="sxs-lookup"><span data-stu-id="ce547-997">Conventional routing always invalidated extra route values when linking to a different action.</span></span> <span data-ttu-id="ce547-998">Prima del rilascio di ASP.NET Core 2.2, il routing degli attributi non aveva questo comportamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-998">Attribute routing didn't have this behavior prior to the release of ASP.NET Core 2.2.</span></span> <span data-ttu-id="ce547-999">Nelle versioni precedenti di ASP.NET Core i collegamenti a un'altra azione con gli stessi nomi di parametro di route causavano errori nella generazione dei collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-999">In earlier versions of ASP.NET Core, links to another action that use the same route parameter names resulted in link generation errors.</span></span> <span data-ttu-id="ce547-1000">In ASP.NET Core 2.2 o versioni successive entrambi i tipi di routing invalidano i valori in caso di collegamento a un'altra azione.</span><span class="sxs-lookup"><span data-stu-id="ce547-1000">In ASP.NET Core 2.2 or later, both forms of routing invalidate values when linking to another action.</span></span>

  <span data-ttu-id="ce547-1001">Esaminare l'esempio seguente in ASP.NET Core 2.1 o versioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-1001">Consider the following example in ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="ce547-1002">In caso di collegamento a un'altra azione o a un'altra pagina, i valori di route possono essere riutilizzati in modi indesiderati.</span><span class="sxs-lookup"><span data-stu-id="ce547-1002">When linking to another action (or another page), route values can be reused in undesirable ways.</span></span>

  <span data-ttu-id="ce547-1003">In */Pages/Store/Product.cshtml*:</span><span class="sxs-lookup"><span data-stu-id="ce547-1003">In */Pages/Store/Product.cshtml*:</span></span>

  ```cshtml
  @page "{id}"
  @Url.Page("/Login")
  ```

  <span data-ttu-id="ce547-1004">In */Pages/Login.cshtml*:</span><span class="sxs-lookup"><span data-stu-id="ce547-1004">In */Pages/Login.cshtml*:</span></span>

  ```cshtml
  @page "{id?}"
  ```

  <span data-ttu-id="ce547-1005">Se l'URI è `/Store/Product/18` in ASP.NET Core 2.1 o versioni precedenti, il collegamento generato nella pagina Store/Info da `@Url.Page("/Login")` è `/Login/18`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1005">If the URI is `/Store/Product/18` in ASP.NET Core 2.1 or earlier, the link generated on the Store/Info page by `@Url.Page("/Login")` is `/Login/18`.</span></span> <span data-ttu-id="ce547-1006">Il valore `id` di 18 viene riutilizzato, anche se la destinazione del collegamento è una parte diversa dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1006">The `id` value of 18 is reused, even though the link destination is different part of the app entirely.</span></span> <span data-ttu-id="ce547-1007">Il valore di route `id` nel contesto della pagina `/Login` è probabilmente un valore di ID utente, non un valore di ID prodotto del punto vendita.</span><span class="sxs-lookup"><span data-stu-id="ce547-1007">The `id` route value in the context of the `/Login` page is probably a user ID value, not a store product ID value.</span></span>

  <span data-ttu-id="ce547-1008">Nel routing di endpoint con ASP.NET Core 2.2 o versioni successive, il risultato è `/Login`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1008">In endpoint routing with ASP.NET Core 2.2 or later, the result is `/Login`.</span></span> <span data-ttu-id="ce547-1009">I valori di ambiente non vengono riutilizzati quando la destinazione collegata è costituita da un'azione o una pagina diversa.</span><span class="sxs-lookup"><span data-stu-id="ce547-1009">Ambient values aren't reused when the linked destination is a different action or page.</span></span>

* <span data-ttu-id="ce547-1010">Sintassi dei parametri di route di round trip: le barre non vengono codificate quando viene usata una sintassi del parametro catch-all con doppio asterisco (`**`).</span><span class="sxs-lookup"><span data-stu-id="ce547-1010">Round-tripping route parameter syntax: Forward slashes aren't encoded when using a double-asterisk (`**`) catch-all parameter syntax.</span></span>

  <span data-ttu-id="ce547-1011">Durante la generazione di collegamenti, il sistema di routing codifica il valore acquisito in un parametro catch-all con doppio asterisco (`**`) (ad esempio, `{**myparametername}`) escludendo le barre.</span><span class="sxs-lookup"><span data-stu-id="ce547-1011">During link generation, the routing system encodes the value captured in a double-asterisk (`**`) catch-all parameter (for example, `{**myparametername}`) except the forward slashes.</span></span> <span data-ttu-id="ce547-1012">Il parametro catch-all con doppio asterisco è supportato con il routing basato su `IRouter` in ASP.NET Core 2.2 o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="ce547-1012">The double-asterisk catch-all is supported with `IRouter`-based routing in ASP.NET Core 2.2 or later.</span></span>

  <span data-ttu-id="ce547-1013">La sintassi del parametro catch-all con asterisco singolo nelle versioni precedenti di ASP.NET Core (`{*myparametername}`) resta supportata e le barre vengono codificate.</span><span class="sxs-lookup"><span data-stu-id="ce547-1013">The single asterisk catch-all parameter syntax in prior versions of ASP.NET Core (`{*myparametername}`) remains supported, and forward slashes are encoded.</span></span>

  | <span data-ttu-id="ce547-1014">Route</span><span class="sxs-lookup"><span data-stu-id="ce547-1014">Route</span></span>              | <span data-ttu-id="ce547-1015">Collegamento generato con</span><span class="sxs-lookup"><span data-stu-id="ce547-1015">Link generated with</span></span><br>`Url.Action(new { category = "admin/products" })`&hellip; |
  | ------------------ | --------------------------------------------------------------------- |
  | `/search/{*page}`  | <span data-ttu-id="ce547-1016">`/search/admin%2Fproducts` (la barra viene codificata)</span><span class="sxs-lookup"><span data-stu-id="ce547-1016">`/search/admin%2Fproducts` (the forward slash is encoded)</span></span>             |
  | `/search/{**page}` | `/search/admin/products`                                              |

### <a name="middleware-example"></a><span data-ttu-id="ce547-1017">Esempio di middleware</span><span class="sxs-lookup"><span data-stu-id="ce547-1017">Middleware example</span></span>

<span data-ttu-id="ce547-1018">Nell'esempio seguente un middleware usa l'API <xref:Microsoft.AspNetCore.Routing.LinkGenerator> per creare il collegamento a un metodo di azione che elenca i prodotti del punto vendita.</span><span class="sxs-lookup"><span data-stu-id="ce547-1018">In the following example, a middleware uses the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API to create link to an action method that lists store products.</span></span> <span data-ttu-id="ce547-1019">L'uso del generatore di collegamenti tramite l'inserimento in una classe e la chiamata a `GenerateLink` è possibile in tutte le classi di un'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1019">Using the link generator by injecting it into a class and calling `GenerateLink` is available to any class in an app.</span></span>

```csharp
using Microsoft.AspNetCore.Routing;

public class ProductsLinkMiddleware
{
    private readonly LinkGenerator _linkGenerator;

    public ProductsLinkMiddleware(RequestDelegate next, LinkGenerator linkGenerator)
    {
        _linkGenerator = linkGenerator;
    }

    public async Task InvokeAsync(HttpContext httpContext)
    {
        var url = _linkGenerator.GetPathByAction("ListProducts", "Store");

        httpContext.Response.ContentType = "text/plain";

        await httpContext.Response.WriteAsync($"Go to {url} to see our products.");
    }
}
```

### <a name="create-routes"></a><span data-ttu-id="ce547-1020">Creare route</span><span class="sxs-lookup"><span data-stu-id="ce547-1020">Create routes</span></span>

<span data-ttu-id="ce547-1021">La maggior parte delle app crea le route chiamando <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> o uno dei metodi di estensione simili definiti per <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1021">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="ce547-1022">Tutti i metodi di estensione <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> creano un'istanza di <xref:Microsoft.AspNetCore.Routing.Route> e la aggiungono alla raccolta di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1022">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="ce547-1023"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> non accetta alcun parametro del gestore di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1023"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="ce547-1024"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> aggiunge solo le route che sono gestite da <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1024"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="ce547-1025">Per altre informazioni sul routing in MVC, vedere <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1025">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="ce547-1026">L'esempio di codice seguente si riferisce a una chiamata <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> usata da una tipica definizione di route di ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="ce547-1026">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="ce547-1027">Questo modello confronta un percorso URL ed estrae i valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1027">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="ce547-1028">Ad esempio, il percorso `/Products/Details/17` genera i valori di route seguenti: `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1028">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="ce547-1029">I valori di route vengono determinati suddividendo il percorso URL in segmenti e confrontando ogni segmento con il nome del *parametro di route* nel modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1029">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="ce547-1030">I parametri di route sono denominati.</span><span class="sxs-lookup"><span data-stu-id="ce547-1030">Route parameters are named.</span></span> <span data-ttu-id="ce547-1031">Parametri definiti racchiudendo il nome del parametro tra parentesi graffe `{ ... }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1031">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="ce547-1032">Il modello precedente può anche confrontare il percorso URL `/` e generare i valori `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1032">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="ce547-1033">Ciò accade perché i parametri di route `{controller}` e `{action}` hanno valori predefiniti e il parametro di route `id` è facoltativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1033">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="ce547-1034">Un segno di uguale (`=`) seguito da un valore dopo il nome del parametro di route definisce un valore predefinito per il parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-1034">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="ce547-1035">Un punto interrogativo (`?`) dopo il nome del parametro di route definisce un parametro facoltativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1035">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="ce547-1036">I parametri di route con un valore predefinito producono *sempre* un valore di route quando la route corrisponde.</span><span class="sxs-lookup"><span data-stu-id="ce547-1036">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="ce547-1037">I parametri facoltativi non producono un valore di route se non è presente un segmento di percorso URL corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1037">Optional parameters don't produce a route value if there is no corresponding URL path segment.</span></span> <span data-ttu-id="ce547-1038">Vedere la sezione [Riferimento per i modelli di route](#route-template-reference) per una descrizione completa degli scenari e della sintassi del modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1038">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="ce547-1039">Nell'esempio seguente la definizione del parametro di route `{id:int}` definisce un [vincolo di route](#route-constraint-reference) per il parametro di route `id`:</span><span class="sxs-lookup"><span data-stu-id="ce547-1039">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="ce547-1040">Questo modello confronta un percorso URL come `/Products/Details/17`, ma non `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1040">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="ce547-1041">I vincoli di route implementano <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> ed esaminano i valori di route per verificarli.</span><span class="sxs-lookup"><span data-stu-id="ce547-1041">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="ce547-1042">In questo esempio il valore di route `id` deve poter essere convertito in un numero intero.</span><span class="sxs-lookup"><span data-stu-id="ce547-1042">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="ce547-1043">Vedere [Riferimento per i vincoli di route](#route-constraint-reference) per una descrizione dei vincoli di route specificati dal framework.</span><span class="sxs-lookup"><span data-stu-id="ce547-1043">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="ce547-1044">Altri overload di <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accettano i valori per `constraints`, `dataTokens` e `defaults`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1044">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="ce547-1045">L'uso tipico di questi parametri è passare un oggetto tipizzato in modo anonimo, in cui i nomi di proprietà di tipo anonimo corrispondono ai nomi dei parametri di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1045">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="ce547-1046">Gli esempi <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> seguenti creano route equivalenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-1046">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="ce547-1047">La sintassi inline per definire i vincoli e i valori predefiniti può essere utile per le route semplici.</span><span class="sxs-lookup"><span data-stu-id="ce547-1047">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="ce547-1048">Esistono tuttavia scenari, come i token di dati, che non sono supportati dalla sintassi inline.</span><span class="sxs-lookup"><span data-stu-id="ce547-1048">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="ce547-1049">L'esempio seguente illustra alcuni scenari aggiuntivi:</span><span class="sxs-lookup"><span data-stu-id="ce547-1049">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{**article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="ce547-1050">Il modello precedente confronta un percorso URL come `/Blog/All-About-Routing/Introduction` ed estrae i valori `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1050">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="ce547-1051">I valori di route predefiniti per `controller` e `action` vengono generati dalla route anche se sono non presenti parametri di route corrispondenti nel modello.</span><span class="sxs-lookup"><span data-stu-id="ce547-1051">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="ce547-1052">I valori predefiniti possono essere specificati nel modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1052">Default values can be specified in the route template.</span></span> <span data-ttu-id="ce547-1053">Il parametro di route `article` è definito come *catch-all* in base alla presenza di un doppio asterisco (`**`) prima del nome del parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1053">The `article` route parameter is defined as a *catch-all* by the appearance of an double asterisk (`**`) before the route parameter name.</span></span> <span data-ttu-id="ce547-1054">I parametri di route catch-all acquisiscono il resto del percorso URL e possono anche corrispondere alla stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="ce547-1054">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="ce547-1055">L'esempio seguente aggiunge i vincoli di route e i token di dati:</span><span class="sxs-lookup"><span data-stu-id="ce547-1055">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="ce547-1056">Il modello precedente confronta un percorso URL come `/en-US/Products/5` ed estrae i valori `{ controller = Products, action = Details, id = 5 }` e i token di dati `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1056">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Token della finestra Variabili locali](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="ce547-1058">Generazione di URL della classe di route</span><span class="sxs-lookup"><span data-stu-id="ce547-1058">Route class URL generation</span></span>

<span data-ttu-id="ce547-1059">La classe <xref:Microsoft.AspNetCore.Routing.Route> è inoltre in grado di eseguire la generazione di URL combinando un set di valori di route con il relativo modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1059">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="ce547-1060">Questo è logicamente il processo inverso di corrispondenza del percorso URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1060">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="ce547-1061">Per comprendere meglio la generazione di URL, si pensi a quale URL si vuole generare e al modo in cui un modello di route deve corrispondere a tale URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1061">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="ce547-1062">Quali valori devono essere prodotti?</span><span class="sxs-lookup"><span data-stu-id="ce547-1062">What values would be produced?</span></span> <span data-ttu-id="ce547-1063">Questo equivale approssimativamente al funzionamento della generazione di URL nella classe <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1063">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="ce547-1064">L'esempio seguente usa una route predefinita di ASP.NET Core MVC generale:</span><span class="sxs-lookup"><span data-stu-id="ce547-1064">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="ce547-1065">Con i valori di route `{ controller = Products, action = List }`, viene generato l'URL `/Products/List`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1065">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="ce547-1066">I valori di route vengono sostituiti dai parametri di route corrispondenti per formare il percorso URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1066">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="ce547-1067">Poiché `id` è un parametro di route facoltativo, l'URL è stato generato senza un valore per `id`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1067">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="ce547-1068">Con i valori di route `{ controller = Home, action = Index }`, viene generato l'URL `/`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1068">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="ce547-1069">Poiché i valori di route specificati corrispondono ai valori predefiniti, i segmenti corrispondenti ai valori predefiniti possono essere omessi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1069">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="ce547-1070">Per entrambi gli URL generati viene eseguito il round trip con la definizione di route seguente (`/Home/Index` e `/`) e vengono prodotti gli stessi valori di route usati per generare l'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1070">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="ce547-1071">Un'app che usa ASP.NET Core MVC deve usare <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> per generare gli URL invece di eseguire la chiamata direttamente nel routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-1071">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="ce547-1072">Per altre informazioni sulla generazione di URL, vedere la sezione [Riferimento per la generazione di URL](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-1072">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="ce547-1073">Usare il middleware di routing</span><span class="sxs-lookup"><span data-stu-id="ce547-1073">Use Routing Middleware</span></span>

<span data-ttu-id="ce547-1074">Fare riferimento al [metapacchetto Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) nel file di progetto dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1074">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="ce547-1075">Aggiungere il routing al contenitore del servizio in `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="ce547-1075">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="ce547-1076">Le route devono essere configurate nel metodo `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1076">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="ce547-1077">L'app di esempio usa le API seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-1077">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="ce547-1078"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>: Corrisponde solo alle richieste HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="ce547-1078"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>: Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="ce547-1079">Nella tabella seguente sono elencate le risposte con gli URI specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-1079">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="ce547-1080">URI</span><span class="sxs-lookup"><span data-stu-id="ce547-1080">URI</span></span>                    | <span data-ttu-id="ce547-1081">Risposta</span><span class="sxs-lookup"><span data-stu-id="ce547-1081">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="ce547-1082">Hello!</span><span class="sxs-lookup"><span data-stu-id="ce547-1082">Hello!</span></span> <span data-ttu-id="ce547-1083">Route values: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="ce547-1083">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="ce547-1084">Hello!</span><span class="sxs-lookup"><span data-stu-id="ce547-1084">Hello!</span></span> <span data-ttu-id="ce547-1085">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="ce547-1085">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="ce547-1086">Hello!</span><span class="sxs-lookup"><span data-stu-id="ce547-1086">Hello!</span></span> <span data-ttu-id="ce547-1087">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="ce547-1087">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="ce547-1088">La richiesta non viene eseguita, nessuna corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-1088">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="ce547-1089">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="ce547-1089">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="ce547-1090">La richiesta non viene eseguita, corrispondenza solo con HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="ce547-1090">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="ce547-1091">La richiesta non viene eseguita, nessuna corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-1091">The request falls through, no match.</span></span>              |

<span data-ttu-id="ce547-1092">Il framework offre un set di metodi di estensione per la creazione di route (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span><span class="sxs-lookup"><span data-stu-id="ce547-1092">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="ce547-1093">I metodi `Map[Verb]` usano i vincoli per limitare la route al verbo HTTP nel nome del metodo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1093">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="ce547-1094">Vedere ad esempio <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> e <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1094">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="ce547-1095">Riferimento per il modello di route</span><span class="sxs-lookup"><span data-stu-id="ce547-1095">Route template reference</span></span>

<span data-ttu-id="ce547-1096">I token all'interno di parentesi graffe (`{ ... }`) definiscono i *parametri di route* che vengono associati se esiste una corrispondenza per la route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1096">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="ce547-1097">È possibile definire più parametri di route in un segmento di route, ma devono essere separati da un valore letterale.</span><span class="sxs-lookup"><span data-stu-id="ce547-1097">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="ce547-1098">Ad esempio, `{controller=Home}{action=Index}` non è una route valida perché non è presente un valore letterale tra `{controller}` e `{action}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1098">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="ce547-1099">Questi parametri di route devono avere un nome e possono avere attributi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1099">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="ce547-1100">Il testo letterale diverso dai parametri di route, ad esempio `{id}`, e il separatore di percorso `/` devono corrispondere al testo nell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1100">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="ce547-1101">La corrispondenza del testo non fa distinzione tra maiuscole e minuscole e si basa sulla rappresentazione decodificata del percorso degli URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1101">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="ce547-1102">Per verificare la corrispondenza di un delimitatore letterale dei parametri di route (`{` o `}`), eseguire l'escape del delimitatore ripetendo il carattere (`{{` o `}}`).</span><span class="sxs-lookup"><span data-stu-id="ce547-1102">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="ce547-1103">I modelli di URL che tentano di acquisire un nome file con un'estensione facoltativa hanno considerazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="ce547-1103">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="ce547-1104">Considerare ad esempio il modello `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1104">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="ce547-1105">Se esistono i valori per `filename` e `ext`, vengono popolati entrambi i valori.</span><span class="sxs-lookup"><span data-stu-id="ce547-1105">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="ce547-1106">Se esiste solo un valore per `filename` nell'URL, la route corrisponde perché il punto finale (`.`) è facoltativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1106">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="ce547-1107">Gli URL seguenti corrispondono a questa route:</span><span class="sxs-lookup"><span data-stu-id="ce547-1107">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="ce547-1108">È possibile usare un asterisco (`*`) o un doppio asterisco (`**`) come prefisso per un parametro di route da associare alla parte rimanente dell'URI.</span><span class="sxs-lookup"><span data-stu-id="ce547-1108">You can use an asterisk (`*`) or double asterisk (`**`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="ce547-1109">Si tratta di parametri chiamati parametri *catch-all*.</span><span class="sxs-lookup"><span data-stu-id="ce547-1109">These are called a *catch-all* parameters.</span></span> <span data-ttu-id="ce547-1110">Ad esempio, `blog/{**slug}` corrisponde a qualsiasi URI che inizia con `/blog` seguito da qualsiasi valore, che viene assegnato al valore di route `slug`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1110">For example, `blog/{**slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="ce547-1111">I parametri catch-all possono anche corrispondere alla stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="ce547-1111">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="ce547-1112">Il parametro catch-all esegue l'escape dei caratteri appropriati, incluso il separatore di percorso (`/`), quando la route viene usata per generare un URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1112">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="ce547-1113">Ad esempio, la route `foo/{*path}` con i valori di route `{ path = "my/path" }` genera `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1113">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="ce547-1114">Si noti la barra di escape.</span><span class="sxs-lookup"><span data-stu-id="ce547-1114">Note the escaped forward slash.</span></span> <span data-ttu-id="ce547-1115">Per eseguire il round trip dei caratteri di separatore di percorso, usare il prefisso del parametro di route `**`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1115">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="ce547-1116">La route `foo/{**path}` con `{ path = "my/path" }` genera `foo/my/path`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1116">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

<span data-ttu-id="ce547-1117">I parametri di route possono avere *valori predefiniti*, definiti specificando il valore predefinito dopo il nome del parametro, separato da un segno di uguale (`=`).</span><span class="sxs-lookup"><span data-stu-id="ce547-1117">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="ce547-1118">Ad esempio, `{controller=Home}` definisce `Home` come valore predefinito per `controller`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1118">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="ce547-1119">Il valore predefinito viene usato se nell'URL non è presente alcun valore per il parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-1119">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="ce547-1120">I parametri di route vengono resi facoltativi aggiungendo un punto interrogativo (`?`) alla fine del nome del parametro, come in `id?`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1120">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="ce547-1121">La differenza tra parametri facoltativi e parametri di route predefiniti è che un parametro di route con un valore predefinito produce sempre un valore, mentre un parametro facoltativo ha un valore solo se ne viene specificato uno dall'URL della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1121">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="ce547-1122">I parametri di route possono presentare dei vincoli che devono corrispondere al valore di route associato dall'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1122">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="ce547-1123">Aggiungendo due punti (`:`) e il nome del vincolo dopo il nome del parametro di route, si specifica un *vincolo inline* per un parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1123">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="ce547-1124">Se il vincolo richiede argomenti, vengono racchiusi tra parentesi (`(...)`) dopo il nome del vincolo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1124">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="ce547-1125">È possibile specificare più vincoli inline aggiungendo di nuovo i due punti (`:`) e il nome del vincolo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1125">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="ce547-1126">Il nome del vincolo e gli argomenti vengono passati al servizio <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> per creare un'istanza di <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> da usare nell'elaborazione dell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1126">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="ce547-1127">Il modello di route `blog/{article:minlength(10)}` specifica ad esempio un vincolo `minlength` con l'argomento `10`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1127">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="ce547-1128">Per altre informazioni sui vincoli di route e per un elenco dei vincoli specificati dal framework, vedere la sezione [Riferimento per i vincoli di route](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-1128">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="ce547-1129">I parametri di route possono avere anche trasformatori di parametro che trasformano un valore di parametro durante la generazione dei collegamenti e l'abbinamento delle azioni e delle pagine agli URI.</span><span class="sxs-lookup"><span data-stu-id="ce547-1129">Route parameters may also have parameter transformers, which transform a parameter's value when generating links and matching actions and pages to URLs.</span></span> <span data-ttu-id="ce547-1130">Come i vincoli, i trasformatori di parametro possono essere aggiunti inline a un parametro di route inserendo due punti (`:`) e il nome del trasformatore dopo il nome del parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1130">Like constraints, parameter transformers can be added inline to a route parameter by adding a colon (`:`) and transformer name after the route parameter name.</span></span> <span data-ttu-id="ce547-1131">Ad esempio, il modello di route `blog/{article:slugify}` specifica un trasformatore `slugify`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1131">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span> <span data-ttu-id="ce547-1132">Per altre informazioni sui trasformatori di parametro, vedere la sezione [Riferimento ai trasformatori di parametro](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-1132">For more information on parameter transformers, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

<span data-ttu-id="ce547-1133">La tabella seguente illustra i modelli di route di esempio e il relativo comportamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-1133">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="ce547-1134">Modello di route</span><span class="sxs-lookup"><span data-stu-id="ce547-1134">Route Template</span></span>                           | <span data-ttu-id="ce547-1135">URI corrispondente di esempio</span><span class="sxs-lookup"><span data-stu-id="ce547-1135">Example Matching URI</span></span>    | <span data-ttu-id="ce547-1136">L'URI della richiesta&hellip;</span><span class="sxs-lookup"><span data-stu-id="ce547-1136">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="ce547-1137">Verifica la corrispondenza solo del singolo percorso `/hello`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1137">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="ce547-1138">Verifica la corrispondenza e imposta `Page` su `Home`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1138">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="ce547-1139">Verifica la corrispondenza e imposta `Page` su `Contact`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1139">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="ce547-1140">Esegue il mapping al controller `Products` e all'azione `List`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1140">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="ce547-1141">Esegue il mapping al controller `Products` e all'azione `Details` (`id` impostato su 123).</span><span class="sxs-lookup"><span data-stu-id="ce547-1141">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="ce547-1142">Esegue il mapping al controller `Home` e al metodo `Index` (`id` viene ignorato).</span><span class="sxs-lookup"><span data-stu-id="ce547-1142">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="ce547-1143">L'uso di un modello è in genere l'approccio più semplice al routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-1143">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="ce547-1144">I vincoli e le impostazioni predefinite possono essere specificati anche all'esterno del modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1144">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="ce547-1145">Abilitare la [registrazione](xref:fundamentals/logging/index) per verificare in che modo le implementazioni del routing predefinite, ad esempio <xref:Microsoft.AspNetCore.Routing.Route>, corrispondono alle richieste.</span><span class="sxs-lookup"><span data-stu-id="ce547-1145">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="ce547-1146">Nomi riservati di routing</span><span class="sxs-lookup"><span data-stu-id="ce547-1146">Reserved routing names</span></span>

<span data-ttu-id="ce547-1147">Le parole chiave seguenti sono nomi riservati e non possono essere usate come nomi o parametri di route:</span><span class="sxs-lookup"><span data-stu-id="ce547-1147">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="ce547-1148">Riferimento per i vincoli di route</span><span class="sxs-lookup"><span data-stu-id="ce547-1148">Route constraint reference</span></span>

<span data-ttu-id="ce547-1149">I vincoli di route vengono eseguiti quando si verifica una corrispondenza nell'URL in ingresso e il percorso URL viene suddiviso in valori di route in formato token.</span><span class="sxs-lookup"><span data-stu-id="ce547-1149">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="ce547-1150">I vincoli di route in genere controllano il valore di route associato usando il modello di route e stabiliscono con una decisione Sì/No se il valore è accettabile o meno.</span><span class="sxs-lookup"><span data-stu-id="ce547-1150">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="ce547-1151">Alcuni vincoli di route usano i dati all'esterno del valore di route per stabilire se la richiesta può essere instradata.</span><span class="sxs-lookup"><span data-stu-id="ce547-1151">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="ce547-1152">Ad esempio, <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> può accettare o rifiutare una richiesta in base al relativo verbo HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce547-1152">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="ce547-1153">I vincoli vengono usati nelle richieste del routing e nella generazione di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-1153">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="ce547-1154">Non usare i vincoli per la **convalida dell'input**.</span><span class="sxs-lookup"><span data-stu-id="ce547-1154">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="ce547-1155">Se vengono usati vincoli per la **convalida dell'input**, un input non valido causa la visualizzazione di un errore di tipo *404 (Non trovato)* invece di un errore di tipo *400 - Richiesta non valida* con un messaggio di errore appropriato.</span><span class="sxs-lookup"><span data-stu-id="ce547-1155">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="ce547-1156">I vincoli di route vengono usati per evitare **ambiguità** tra route simili, non per convalidare gli input per una route specifica.</span><span class="sxs-lookup"><span data-stu-id="ce547-1156">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="ce547-1157">La tabella seguente illustra i vincoli di route di esempio e il relativo comportamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-1157">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="ce547-1158">Vincolo</span><span class="sxs-lookup"><span data-stu-id="ce547-1158">Constraint</span></span> | <span data-ttu-id="ce547-1159">Esempio</span><span class="sxs-lookup"><span data-stu-id="ce547-1159">Example</span></span> | <span data-ttu-id="ce547-1160">Corrispondenze di esempio</span><span class="sxs-lookup"><span data-stu-id="ce547-1160">Example matches</span></span> | <span data-ttu-id="ce547-1161">Note</span><span class="sxs-lookup"><span data-stu-id="ce547-1161">Notes</span></span> |
|------------|---------|-----------------|-------|
| `int` | `{id:int}` | <span data-ttu-id="ce547-1162">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="ce547-1162">`123456789`, `-123456789`</span></span> | <span data-ttu-id="ce547-1163">Corrisponde a qualsiasi numero intero.</span><span class="sxs-lookup"><span data-stu-id="ce547-1163">Matches any integer.</span></span>|
| `bool` | `{active:bool}` | <span data-ttu-id="ce547-1164">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="ce547-1164">`true`, `FALSE`</span></span> | <span data-ttu-id="ce547-1165">Corrisponde a `true` o `false` .</span><span class="sxs-lookup"><span data-stu-id="ce547-1165">Matches `true` or `false`.</span></span> <span data-ttu-id="ce547-1166">Senza distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="ce547-1166">Case-insensitive.</span></span>|
| `datetime` | `{dob:datetime}` | <span data-ttu-id="ce547-1167">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="ce547-1167">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="ce547-1168">Corrisponde a un `DateTime` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-1168">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="ce547-1169">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1169">See preceding warning.</span></span>|
| `decimal` | `{price:decimal}` | <span data-ttu-id="ce547-1170">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="ce547-1170">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="ce547-1171">Corrisponde a un `decimal` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-1171">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="ce547-1172">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1172">See  preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="ce547-1173">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="ce547-1173">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="ce547-1174">Corrisponde a un `double` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-1174">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="ce547-1175">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1175">See  preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="ce547-1176">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="ce547-1176">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="ce547-1177">Corrisponde a un `float` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-1177">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="ce547-1178">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1178">See  preceding warning.</span></span>|
| `guid` | `{id:guid}` | <span data-ttu-id="ce547-1179">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="ce547-1179">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="ce547-1180">Corrisponde a un `Guid` valore valido.</span><span class="sxs-lookup"><span data-stu-id="ce547-1180">Matches a valid `Guid` value.</span></span>|
| `long` | `{ticks:long}` | <span data-ttu-id="ce547-1181">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="ce547-1181">`123456789`, `-123456789`</span></span> | <span data-ttu-id="ce547-1182">Corrisponde a un `long` valore valido.</span><span class="sxs-lookup"><span data-stu-id="ce547-1182">Matches a valid `long` value.</span></span>|
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="ce547-1183">La stringa deve contenere almeno 4 caratteri.</span><span class="sxs-lookup"><span data-stu-id="ce547-1183">String must be at least 4 characters.</span></span>|
| `maxlength(value)` | `{filename:maxlength(8)}` | `MyFile` | <span data-ttu-id="ce547-1184">La stringa ha un massimo di 8 caratteri.</span><span class="sxs-lookup"><span data-stu-id="ce547-1184">String has maximum of 8 characters.</span></span>|
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="ce547-1185">La lunghezza della stringa deve essere uguale a 12 caratteri.</span><span class="sxs-lookup"><span data-stu-id="ce547-1185">String must be exactly 12 characters long.</span></span>|
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="ce547-1186">La stringa deve essere almeno 8 e può contenere un massimo di 16 caratteri.</span><span class="sxs-lookup"><span data-stu-id="ce547-1186">String must be at least 8 and has maximum of 16 characters.</span></span>|
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="ce547-1187">Il valore intero deve essere almeno 18.</span><span class="sxs-lookup"><span data-stu-id="ce547-1187">Integer value must be at least 18.</span></span>|
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="ce547-1188">Valore intero massimo di 120.</span><span class="sxs-lookup"><span data-stu-id="ce547-1188">Integer value maximum of 120.</span></span>|
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="ce547-1189">Il valore intero deve essere almeno 18 e un massimo di 120.</span><span class="sxs-lookup"><span data-stu-id="ce547-1189">Integer value must be at least 18 and maximum of 120.</span></span>|
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="ce547-1190">La stringa deve essere costituita da uno o più caratteri alfabetici `a` - `z` .</span><span class="sxs-lookup"><span data-stu-id="ce547-1190">String must consist of one or more alphabetical characters `a`-`z`.</span></span> <span data-ttu-id="ce547-1191">Senza distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="ce547-1191">Case-insensitive.</span></span>|
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="ce547-1192">La stringa deve corrispondere all'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="ce547-1192">String must match the regular expression.</span></span> <span data-ttu-id="ce547-1193">Vedere suggerimenti sulla definizione di un'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="ce547-1193">See tips about defining a regular expression.</span></span>|
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="ce547-1194">Utilizzato per imporre che un valore non di parametro sia presente durante la generazione dell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1194">Used to enforce that a non-parameter value is present during URL generation.</span></span>|

<span data-ttu-id="ce547-1195">Più vincoli delimitati da punti possono essere applicati a un singolo parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-1195">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="ce547-1196">Ad esempio il vincolo seguente limita un parametro a un valore intero maggiore o uguale a 1:</span><span class="sxs-lookup"><span data-stu-id="ce547-1196">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="ce547-1197">I vincoli di route che verificano l'URL e vengono convertiti in un tipo CLR, ad esempio `int` o `DateTime`, usano sempre le impostazioni cultura inglese non dipendenti da paese/area geografica,</span><span class="sxs-lookup"><span data-stu-id="ce547-1197">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="ce547-1198">presupponendo che l'URL sia non localizzabile.</span><span class="sxs-lookup"><span data-stu-id="ce547-1198">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="ce547-1199">I vincoli di route specificati dal framework non modificano i valori archiviati nei valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1199">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="ce547-1200">Tutti i valori di route analizzati dall'URL vengono archiviati come stringhe.</span><span class="sxs-lookup"><span data-stu-id="ce547-1200">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="ce547-1201">Ad esempio, il vincolo `float` prova a convertire il valore di route in un valore float, ma il valore convertito viene usato solo per verificare che può essere convertito in un valore float.</span><span class="sxs-lookup"><span data-stu-id="ce547-1201">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="ce547-1202">Espressioni regolari</span><span class="sxs-lookup"><span data-stu-id="ce547-1202">Regular expressions</span></span>

<span data-ttu-id="ce547-1203">Il framework di ASP.NET Core aggiunge `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` al costruttore di espressioni regolari.</span><span class="sxs-lookup"><span data-stu-id="ce547-1203">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="ce547-1204">Per una descrizione di questi membri, vedere <xref:System.Text.RegularExpressions.RegexOptions>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1204">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="ce547-1205">Le espressioni regolari usano delimitatori e token simili a quelli usati dal routing e dal linguaggio C#.</span><span class="sxs-lookup"><span data-stu-id="ce547-1205">Regular expressions use delimiters and tokens similar to those used by routing and the C# language.</span></span> <span data-ttu-id="ce547-1206">Per i token di espressione è necessario aggiungere caratteri di escape.</span><span class="sxs-lookup"><span data-stu-id="ce547-1206">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="ce547-1207">Per utilizzare l'espressione regolare `^\d{3}-\d{2}-\d{4}$` nel routing:</span><span class="sxs-lookup"><span data-stu-id="ce547-1207">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing:</span></span>

* <span data-ttu-id="ce547-1208">L'espressione deve contenere i caratteri della barra rovesciata singola `\` specificati nella stringa come doppi caratteri di barra rovesciata `\\` nel codice sorgente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1208">The expression must have the single backslash `\` characters provided in the string as double backslash `\\` characters in the source code.</span></span>
* <span data-ttu-id="ce547-1209">Per `\\` eseguire l'escape del `\` carattere di escape della stringa, è necessario l'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="ce547-1209">The regular expression must us `\\` in order to escape the `\` string escape character.</span></span>
* <span data-ttu-id="ce547-1210">L'espressione regolare non richiede `\\` quando si usano [valori letterali stringa Verbatim](/dotnet/csharp/language-reference/keywords/string).</span><span class="sxs-lookup"><span data-stu-id="ce547-1210">The regular expression doesn't require `\\` when using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span>

<span data-ttu-id="ce547-1211">Per eseguire l'escape dei caratteri di delimitazione del parametro di routing,,, `{` `}` `[` `]` , raddoppiare i caratteri nell'espressione `{{` , `}` `[[` `]]` ,,.</span><span class="sxs-lookup"><span data-stu-id="ce547-1211">To escape routing parameter delimiter characters `{`, `}`, `[`, `]`, double the characters in the expression `{{`, `}`, `[[`, `]]`.</span></span> <span data-ttu-id="ce547-1212">La tabella seguente illustra un'espressione regolare e la versione di escape:</span><span class="sxs-lookup"><span data-stu-id="ce547-1212">The following table shows a regular expression and the escaped version:</span></span>

| <span data-ttu-id="ce547-1213">Espressione regolare</span><span class="sxs-lookup"><span data-stu-id="ce547-1213">Regular Expression</span></span>    | <span data-ttu-id="ce547-1214">Espressione regolare con caratteri di escape</span><span class="sxs-lookup"><span data-stu-id="ce547-1214">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="ce547-1215">Le espressioni regolari utilizzate nel routing spesso iniziano con il `^` carattere del punto di inserimento e corrispondono alla posizione iniziale della stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-1215">Regular expressions used in routing often start with the caret `^` character and match starting position of the string.</span></span> <span data-ttu-id="ce547-1216">Le espressioni spesso terminano con il `$` carattere di segno di dollaro e la fine della corrispondenza della stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-1216">The expressions often end with the dollar sign `$` character and match end of the string.</span></span> <span data-ttu-id="ce547-1217">I caratteri `^` e `$` consentono di verificare che l'espressione regolare corrisponda all'intero valore del parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1217">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="ce547-1218">Senza i caratteri `^` e `$` l'espressione regolare corrisponde a qualsiasi sottostringa all'interno della stringa e spesso questo non è il risultato desiderato.</span><span class="sxs-lookup"><span data-stu-id="ce547-1218">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="ce547-1219">La tabella seguente include alcuni esempi e descrive perché si verifica o non si verifica la corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-1219">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="ce547-1220">Expression</span><span class="sxs-lookup"><span data-stu-id="ce547-1220">Expression</span></span>   | <span data-ttu-id="ce547-1221">string</span><span class="sxs-lookup"><span data-stu-id="ce547-1221">String</span></span>    | <span data-ttu-id="ce547-1222">Corrispondenza</span><span class="sxs-lookup"><span data-stu-id="ce547-1222">Match</span></span> | <span data-ttu-id="ce547-1223">Commento</span><span class="sxs-lookup"><span data-stu-id="ce547-1223">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="ce547-1224">hello</span><span class="sxs-lookup"><span data-stu-id="ce547-1224">hello</span></span>     | <span data-ttu-id="ce547-1225">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-1225">Yes</span></span>   | <span data-ttu-id="ce547-1226">Corrispondenze di sottostringhe</span><span class="sxs-lookup"><span data-stu-id="ce547-1226">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="ce547-1227">123abc456</span><span class="sxs-lookup"><span data-stu-id="ce547-1227">123abc456</span></span> | <span data-ttu-id="ce547-1228">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-1228">Yes</span></span>   | <span data-ttu-id="ce547-1229">Corrispondenze di sottostringhe</span><span class="sxs-lookup"><span data-stu-id="ce547-1229">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="ce547-1230">mz</span><span class="sxs-lookup"><span data-stu-id="ce547-1230">mz</span></span>        | <span data-ttu-id="ce547-1231">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-1231">Yes</span></span>   | <span data-ttu-id="ce547-1232">Corrisponde all'espressione</span><span class="sxs-lookup"><span data-stu-id="ce547-1232">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="ce547-1233">MZ</span><span class="sxs-lookup"><span data-stu-id="ce547-1233">MZ</span></span>        | <span data-ttu-id="ce547-1234">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-1234">Yes</span></span>   | <span data-ttu-id="ce547-1235">Senza distinzione maiuscole/minuscole</span><span class="sxs-lookup"><span data-stu-id="ce547-1235">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="ce547-1236">hello</span><span class="sxs-lookup"><span data-stu-id="ce547-1236">hello</span></span>     | <span data-ttu-id="ce547-1237">No</span><span class="sxs-lookup"><span data-stu-id="ce547-1237">No</span></span>    | <span data-ttu-id="ce547-1238">Vedere `^` e `$` sopra</span><span class="sxs-lookup"><span data-stu-id="ce547-1238">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="ce547-1239">123abc456</span><span class="sxs-lookup"><span data-stu-id="ce547-1239">123abc456</span></span> | <span data-ttu-id="ce547-1240">No</span><span class="sxs-lookup"><span data-stu-id="ce547-1240">No</span></span>    | <span data-ttu-id="ce547-1241">Vedere `^` e `$` sopra</span><span class="sxs-lookup"><span data-stu-id="ce547-1241">See `^` and `$` above</span></span> |

<span data-ttu-id="ce547-1242">Per altre informazioni sulla sintassi delle espressioni regolari, vedere [Espressioni regolari di .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-1242">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="ce547-1243">Per limitare un parametro a un set noto di valori possibili, usare un'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="ce547-1243">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="ce547-1244">Ad esempio, `{action:regex(^(list|get|create)$)}` verifica la corrispondenza del valore di route `action` solo con `list`, `get` o `create`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1244">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="ce547-1245">Se viene passata nel dizionario di vincoli, la stringa `^(list|get|create)$` è equivalente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1245">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="ce547-1246">Anche i vincoli passati nel dizionario di vincoli (non inline all'interno di un modello) che non corrispondono a uno dei vincoli noti vengono considerati espressioni regolari.</span><span class="sxs-lookup"><span data-stu-id="ce547-1246">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="ce547-1247">Vincoli di Route personalizzati</span><span class="sxs-lookup"><span data-stu-id="ce547-1247">Custom route constraints</span></span>

<span data-ttu-id="ce547-1248">Oltre ai vincoli di route predefiniti, è possibile creare vincoli di route personalizzati implementando l'interfaccia <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1248">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="ce547-1249">L'interfaccia <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> contiene un singolo metodo, `Match`, che restituisce `true` se il vincolo viene soddisfatto e `false` in caso contrario.</span><span class="sxs-lookup"><span data-stu-id="ce547-1249">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="ce547-1250">Per usare un'interfaccia <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> personalizzata, il tipo di vincolo di route deve essere registrato con la proprietà <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> dell'app nel contenitore di servizi dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1250">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="ce547-1251"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> è un dizionario che esegue il mapping delle chiavi dei vincoli di route alle implementazioni di <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> che convalidano tali vincoli.</span><span class="sxs-lookup"><span data-stu-id="ce547-1251">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="ce547-1252">La proprietà <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> di un'app può essere aggiornata in `Startup.ConfigureServices` come parte di una chiamata [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) o configurando <xref:Microsoft.AspNetCore.Routing.RouteOptions> direttamente con `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1252">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="ce547-1253">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="ce547-1253">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="ce547-1254">Il vincolo può quindi essere applicato alle route nel modo consueto, usando il nome specificato al momento della registrazione del tipo di vincolo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1254">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="ce547-1255">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="ce547-1255">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="parameter-transformer-reference"></a><span data-ttu-id="ce547-1256">Riferimento ai trasformatori di parametro</span><span class="sxs-lookup"><span data-stu-id="ce547-1256">Parameter transformer reference</span></span>

<span data-ttu-id="ce547-1257">I trasformatori di parametro:</span><span class="sxs-lookup"><span data-stu-id="ce547-1257">Parameter transformers:</span></span>

* <span data-ttu-id="ce547-1258">Vengono eseguiti quando si genera un collegamento per <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1258">Execute when generating a link for a <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>
* <span data-ttu-id="ce547-1259">Implementare `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1259">Implement `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span></span>
* <span data-ttu-id="ce547-1260">Vengono configurati tramite <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1260">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="ce547-1261">Acquisire il valore della route del parametro e trasformarlo in un nuovo valore stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-1261">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="ce547-1262">Il valore trasformato viene usato nel collegamento generato.</span><span class="sxs-lookup"><span data-stu-id="ce547-1262">Result in using the transformed value in the generated link.</span></span>

<span data-ttu-id="ce547-1263">Ad esempio, un trasformatore di parametro `slugify` personalizzato nel modello di route `blog\{article:slugify}` con `Url.Action(new { article = "MyTestArticle" })` genera `blog\my-test-article`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1263">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="ce547-1264">Per usare un trasformatore di parametro in un modello di route, configurarlo prima usando <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="ce547-1264">To use a parameter transformer in a route pattern, configure it first using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddRouting(options =>
{
    // Replace the type and the name used to refer to it with your own
    // IOutboundParameterTransformer implementation
    options.ConstraintMap["slugify"] = typeof(SlugifyParameterTransformer);
});
```

<span data-ttu-id="ce547-1265">I trasformatori di parametro sono usati dai framework per trasformare l'URI in cui viene risolto un endpoint.</span><span class="sxs-lookup"><span data-stu-id="ce547-1265">Parameter transformers are used by the framework to transform the URI where an endpoint resolves.</span></span> <span data-ttu-id="ce547-1266">Ad esempio, ASP.NET Core MVC usa i trasformatori di parametro per trasformare il valore di route usato per abbinare `area`, `controller`, `action` e `page`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1266">For example, ASP.NET Core MVC uses parameter transformers to transform the route value used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller:slugify=Home}/{action:slugify=Index}/{id?}");
```

<span data-ttu-id="ce547-1267">Con la route precedente, l'azione `SubscriptionManagementController.GetAll` viene abbinata all'URI `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1267">With the preceding route, the action `SubscriptionManagementController.GetAll` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="ce547-1268">Un trasformatore di parametro non modifica i valori della route usati per generare un collegamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-1268">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="ce547-1269">Ad esempio, `Url.Action("GetAll", "SubscriptionManagement")` restituisce `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1269">For example, `Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="ce547-1270">ASP.NET Core offre convenzioni API per l'uso di trasformatori di parametro con le route generate:</span><span class="sxs-lookup"><span data-stu-id="ce547-1270">ASP.NET Core provides API conventions for using a parameter transformers with generated routes:</span></span>

* <span data-ttu-id="ce547-1271">ASP.NET Core MVC include la convenzione API `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1271">ASP.NET Core MVC has the `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API convention.</span></span> <span data-ttu-id="ce547-1272">Questa convenzione applica un trasformatore di parametro specifico a tutte le route di attributi nell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1272">This convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="ce547-1273">Il trasformatore di parametro trasforma i token di route di attributi man mano che vengono sostituiti.</span><span class="sxs-lookup"><span data-stu-id="ce547-1273">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="ce547-1274">Per altre informazioni vedere [Use a parameter transformer to customize token replacement](xref:mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement) (Usare un trasformatore di parametro per personalizzare la sostituzione di token).</span><span class="sxs-lookup"><span data-stu-id="ce547-1274">For more information, see [Use a parameter transformer to customize token replacement](xref:mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="ce547-1275">Razor Le pagine hanno la `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` convenzione API.</span><span class="sxs-lookup"><span data-stu-id="ce547-1275">Razor Pages has the `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API convention.</span></span> <span data-ttu-id="ce547-1276">Questa convenzione applica un trasformatore di parametro specificato a tutte le pagine individuate automaticamente Razor .</span><span class="sxs-lookup"><span data-stu-id="ce547-1276">This convention applies a specified parameter transformer to all automatically discovered Razor Pages.</span></span> <span data-ttu-id="ce547-1277">Il trasformatore di parametri trasforma la cartella e i segmenti dei nomi di file delle Razor Route di pagine.</span><span class="sxs-lookup"><span data-stu-id="ce547-1277">The parameter transformer transforms the folder and file name segments of Razor Pages routes.</span></span> <span data-ttu-id="ce547-1278">Per altre informazioni, vedere [Use a parameter transformer to customize page routes](xref:razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes) (Usare un trasformatore di parametro per personalizzare route di pagine).</span><span class="sxs-lookup"><span data-stu-id="ce547-1278">For more information, see [Use a parameter transformer to customize page routes](xref:razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

## <a name="url-generation-reference"></a><span data-ttu-id="ce547-1279">Riferimento per la generazione di URL</span><span class="sxs-lookup"><span data-stu-id="ce547-1279">URL generation reference</span></span>

<span data-ttu-id="ce547-1280">L'esempio seguente mostra come generare un collegamento a una route usando un dizionario di valori di route e un elemento <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1280">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="ce547-1281">L'elemento <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generato alla fine dell'esempio precedente è `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1281">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="ce547-1282">Il dizionario fornisce i valori di route `operation` e `id` del modello "Track Package Route", `package/{operation}/{id}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1282">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="ce547-1283">Per informazioni dettagliate, vedere il codice di esempio nella sezione [Usare il middleware di routing](#use-routing-middleware) oppure l'[app di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples).</span><span class="sxs-lookup"><span data-stu-id="ce547-1283">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="ce547-1284">Il secondo parametro per il costruttore <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> è una raccolta di *valori di ambiente*.</span><span class="sxs-lookup"><span data-stu-id="ce547-1284">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="ce547-1285">I valori di ambiente sono utili poiché limitano il numero di valori che uno sviluppatore deve specificare all'interno del contesto di una richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1285">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="ce547-1286">I valori di route correnti della richiesta corrente sono considerati valori di ambiente per la generazione del collegamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-1286">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="ce547-1287">Nell'azione `About` di un'app ASP.NET Core MVC di `HomeController`, non è necessario specificare il valore di route del controller per collegarsi all'azione `Index`. Viene usato il valore di ambiente `Home`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1287">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="ce547-1288">I valori di ambiente che non corrispondono a un parametro vengono ignorati.</span><span class="sxs-lookup"><span data-stu-id="ce547-1288">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="ce547-1289">I valori di ambiente vengono ignorati anche quando un valore specificato in modo esplicito esegue l'override del valore di ambiente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1289">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="ce547-1290">La corrispondenza si verifica da sinistra a destra nell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1290">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="ce547-1291">I valori specificati in modo esplicito ma che non corrispondono a un segmento della route vengono aggiunti alla stringa di query.</span><span class="sxs-lookup"><span data-stu-id="ce547-1291">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="ce547-1292">La tabella seguente illustra il risultato ottenuto quando si usa il modello di route `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1292">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="ce547-1293">Valori di ambiente</span><span class="sxs-lookup"><span data-stu-id="ce547-1293">Ambient Values</span></span>                     | <span data-ttu-id="ce547-1294">Valori espliciti</span><span class="sxs-lookup"><span data-stu-id="ce547-1294">Explicit Values</span></span>                        | <span data-ttu-id="ce547-1295">Risultato</span><span class="sxs-lookup"><span data-stu-id="ce547-1295">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="ce547-1296">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-1296">controller = "Home"</span></span>                | <span data-ttu-id="ce547-1297">action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-1297">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="ce547-1298">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-1298">controller = "Home"</span></span>                | <span data-ttu-id="ce547-1299">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-1299">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="ce547-1300">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="ce547-1300">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="ce547-1301">action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-1301">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="ce547-1302">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-1302">controller = "Home"</span></span>                | <span data-ttu-id="ce547-1303">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="ce547-1303">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="ce547-1304">Se una route ha un valore predefinito che non corrisponde a un parametro e tale valore viene specificato in modo esplicito, deve corrispondere al valore predefinito:</span><span class="sxs-lookup"><span data-stu-id="ce547-1304">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="ce547-1305">La generazione dei collegamenti genera un collegamento per questa route quando vengono specificati i valori corrispondenti per `controller` e `action`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1305">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="ce547-1306">Segmenti complessi</span><span class="sxs-lookup"><span data-stu-id="ce547-1306">Complex segments</span></span>

<span data-ttu-id="ce547-1307">I segmenti complessi (ad esempio, `[Route("/x{token}y")]`), vengono elaborati individuando corrispondenze per i valori letterali da destra a sinistra in modalità non-greedy.</span><span class="sxs-lookup"><span data-stu-id="ce547-1307">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="ce547-1308">Vedere [questo codice](https://github.com/dotnet/aspnetcore/blob/v2.2.13/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) per una spiegazione dettagliata di come vengono confrontati i segmenti complessi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1308">See [this code](https://github.com/dotnet/aspnetcore/blob/v2.2.13/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="ce547-1309">L'[esempio di codice](https://github.com/dotnet/aspnetcore/blob/v2.2.13/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) non viene usato da ASP.NET Core, ma offre una spiegazione esauriente dei segmenti complessi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1309">The [code sample](https://github.com/dotnet/aspnetcore/blob/v2.2.13/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>
<!-- While that code is no longer used by ASP.NET Core for complex segment matching, it provides a good match to the current algorithm. The [current code](https://github.com/dotnet/AspNetCore/blob/91514c9af7e0f4c44029b51f05a01c6fe4c96e4c/src/Http/Routing/src/Matching/DfaMatcherBuilder.cs#L227-L244) is too abstracted from matching to be useful for understanding complex segment matching.
-->

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="ce547-1310">Il routing è responsabile del mapping degli URI delle richieste ai gestori di route e dell'invio delle richieste in ingresso.</span><span class="sxs-lookup"><span data-stu-id="ce547-1310">Routing is responsible for mapping request URIs to route handlers and dispatching an incoming requests.</span></span> <span data-ttu-id="ce547-1311">Le route sono definite nell'app e vengono configurate all'avvio dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1311">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="ce547-1312">Una route può facoltativamente estrarre valori dall'URL contenuto nella richiesta e questi valori possono quindi essere usati per l'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1312">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="ce547-1313">Con l'uso di route configurate dall'app, il routing è in grado di generare gli URL che eseguono il mapping ai gestori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1313">Using configured routes from the app, routing is able to generate URLs that map to route handlers.</span></span>

<span data-ttu-id="ce547-1314">Per usare gli scenari di routing più recenti in ASP.NET Core 2.1, specificare la [versione di compatibilità](xref:mvc/compatibility-version) nella registrazione dei servizi MVC in `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="ce547-1314">To use the latest routing scenarios in ASP.NET Core 2.1, specify the [compatibility version](xref:mvc/compatibility-version) to the MVC services registration in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_1);
```

> [!IMPORTANT]
> <span data-ttu-id="ce547-1315">Questo documento descrive il routing di basso livello di ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="ce547-1315">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="ce547-1316">Per informazioni sul routing di ASP.NET Core MVC, vedere <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1316">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="ce547-1317">Per informazioni sulle convenzioni di routing nelle Razor pagine, vedere <xref:razor-pages/razor-pages-conventions> .</span><span class="sxs-lookup"><span data-stu-id="ce547-1317">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="ce547-1318">[Visualizzare o scaricare il codice di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples) ([procedura per il download](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="ce547-1318">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="ce547-1319">Nozioni fondamentali sul routing</span><span class="sxs-lookup"><span data-stu-id="ce547-1319">Routing basics</span></span>

<span data-ttu-id="ce547-1320">La maggior parte delle app dovrebbe scegliere uno schema di routing semplice e descrittivo in modo che gli URL siano leggibili e significativi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1320">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="ce547-1321">La route convenzionale predefinita `{controller=Home}/{action=Index}/{id?}`:</span><span class="sxs-lookup"><span data-stu-id="ce547-1321">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="ce547-1322">Supporta uno schema di routing semplice e descrittivo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1322">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="ce547-1323">È un punto iniziale utile per le app basate su interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1323">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="ce547-1324">Gli sviluppatori solitamente aggiungono ulteriori route brevi nelle aree a traffico elevato dell'app in situazioni specifiche (ad esempio, endpoint di blog e e-commerce) usando il [routing degli attributi](xref:mvc/controllers/routing#attribute-routing) o route convenzionali dedicate.</span><span class="sxs-lookup"><span data-stu-id="ce547-1324">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations (for example, blog and ecommerce endpoints) using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span>

<span data-ttu-id="ce547-1325">Le API Web devono usare il routing degli attributi per modellare le funzionalità dell'app come set di risorse in cui le operazioni sono rappresentate da verbi HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce547-1325">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="ce547-1326">Questo significa che molte operazioni (ad esempio, GET, POST) sulla stessa risorsa logica useranno lo stesso URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1326">This means that many operations (for example, GET, POST) on the same logical resource will use the same URL.</span></span> <span data-ttu-id="ce547-1327">Il routing degli attributi offre un livello di controllo necessario per progettare con attenzione il layout dell'endpoint pubblico di un'API.</span><span class="sxs-lookup"><span data-stu-id="ce547-1327">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="ce547-1328">Razor Le app di pagine usano il routing convenzionale predefinito per gestire le risorse denominate nella cartella *pagine* di un'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1328">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="ce547-1329">Sono disponibili convenzioni aggiuntive che consentono di personalizzare il Razor comportamento di routing delle pagine.</span><span class="sxs-lookup"><span data-stu-id="ce547-1329">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="ce547-1330">Per altre informazioni, vedere <xref:razor-pages/index> e <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1330">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="ce547-1331">Il supporto della generazione di URL consente di sviluppare l'app senza URL hardcoded per collegare l'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1331">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="ce547-1332">Il supporto consente di iniziare con una configurazione di routing di base e di modificare le route dopo aver determinato il layout delle risorse dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1332">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="ce547-1333">Il routing usa le implementazioni di route di <xref:Microsoft.AspNetCore.Routing.IRouter> a:</span><span class="sxs-lookup"><span data-stu-id="ce547-1333">Routing uses routes implementations of <xref:Microsoft.AspNetCore.Routing.IRouter> to:</span></span>

* <span data-ttu-id="ce547-1334">Eseguire il mapping di richieste in ingresso ai *gestori di route*.</span><span class="sxs-lookup"><span data-stu-id="ce547-1334">Map incoming requests to *route handlers*.</span></span>
* <span data-ttu-id="ce547-1335">Generare gli URL usati nelle risposte.</span><span class="sxs-lookup"><span data-stu-id="ce547-1335">Generate the URLs used in responses.</span></span>

<span data-ttu-id="ce547-1336">Per impostazione predefinita, un'app ha una sola raccolta di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1336">By default, an app has a single collection of routes.</span></span> <span data-ttu-id="ce547-1337">Quando arriva una richiesta, le route della raccolta vengono elaborate nell'ordine in cui si trovano nella raccolta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1337">When a request arrives, the routes in the collection are processed in the order that they exist in the collection.</span></span> <span data-ttu-id="ce547-1338">Il framework tenta di associare l'URL di una richiesta in ingresso a una route della raccolta chiamando il metodo <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> in ogni route della raccolta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1338">The framework attempts to match an incoming request URL to a route in the collection by calling the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in the collection.</span></span> <span data-ttu-id="ce547-1339">Una risposta può usare il routing per generare gli URL, ad esempio per il reindirizzamento o i collegamenti, in base alle informazioni delle route. In questo modo si evita di impostare gli URL come hardcoded ottimizzando la manutenibilità.</span><span class="sxs-lookup"><span data-stu-id="ce547-1339">A response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid hard-coded URLs, which helps maintainability.</span></span>

<span data-ttu-id="ce547-1340">Il sistema di routing ha le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-1340">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="ce547-1341">La sintassi del modello di route viene usata per definire le route con parametri di route in formato token.</span><span class="sxs-lookup"><span data-stu-id="ce547-1341">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="ce547-1342">La configurazione degli endpoint basata su convenzioni e attributi è consentita.</span><span class="sxs-lookup"><span data-stu-id="ce547-1342">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="ce547-1343"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> consente di determinare se un parametro URL contiene un valore valido per il vincolo di un endpoint specifico.</span><span class="sxs-lookup"><span data-stu-id="ce547-1343"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="ce547-1344">I modelli di app, ad esempio MVC/ Razor pages, registrano tutte le route, che hanno un'implementazione prevedibile degli scenari di routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-1344">App models, such as MVC/Razor Pages, register all of their routes, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="ce547-1345">Una risposta può usare il routing per generare gli URL, ad esempio per il reindirizzamento o i collegamenti, in base alle informazioni delle route. In questo modo si evita di impostare gli URL come hardcoded ottimizzando la manutenibilità.</span><span class="sxs-lookup"><span data-stu-id="ce547-1345">A response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="ce547-1346">La generazione degli URL è basata sulle route, che supportano l'estensibilità arbitraria.</span><span class="sxs-lookup"><span data-stu-id="ce547-1346">URL generation is based on routes, which support arbitrary extensibility.</span></span> <span data-ttu-id="ce547-1347"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offre metodi per generare gli URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1347"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>
<!-- fix [middleware](xref:fundamentals/middleware/index) -->
<span data-ttu-id="ce547-1348">Il routing è connesso alla pipeline [middleware](xref:fundamentals/middleware/index) per mezzo della classe <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1348">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="ce547-1349">[ASP.NET Core MVC](xref:mvc/overview) aggiunge il routing alla pipeline middleware come parte della configurazione e gestisce il routing nelle app MVC e Razor pages.</span><span class="sxs-lookup"><span data-stu-id="ce547-1349">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="ce547-1350">Per informazioni sull'uso del routing come componente autonomo, vedere la sezione [Usare il middleware di routing](#use-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="ce547-1350">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="ce547-1351">Corrispondenza URL</span><span class="sxs-lookup"><span data-stu-id="ce547-1351">URL matching</span></span>

<span data-ttu-id="ce547-1352">La corrispondenza dell'URL è il processo con cui il routing invia una richiesta in ingresso a un *gestore*.</span><span class="sxs-lookup"><span data-stu-id="ce547-1352">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="ce547-1353">Questo processo si basa sui dati presenti nel percorso URL, ma può essere esteso in modo da prendere in considerazione tutti i dati della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1353">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="ce547-1354">La possibilità di inviare le richieste a gestori separati è fondamentale per ridurre le dimensioni e la complessità di un'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1354">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="ce547-1355">Le richieste in ingresso immettono <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>, che chiama il metodo <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> per ogni route della sequenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-1355">Incoming requests enter the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>, which calls the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in sequence.</span></span> <span data-ttu-id="ce547-1356">L'istanza di <xref:Microsoft.AspNetCore.Routing.IRouter> sceglie se *gestire* la richiesta impostando [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) su un valore <xref:Microsoft.AspNetCore.Http.RequestDelegate> non Null.</span><span class="sxs-lookup"><span data-stu-id="ce547-1356">The <xref:Microsoft.AspNetCore.Routing.IRouter> instance chooses whether to *handle* the request by setting the [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) to a non-null <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="ce547-1357">Se una route imposta un gestore per la richiesta, l'elaborazione della route si interrompe e viene richiamato il gestore per elaborare la richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1357">If a route sets a handler for the request, route processing stops, and the handler is invoked to process the request.</span></span> <span data-ttu-id="ce547-1358">Se non viene individuato alcun gestore di route per elaborare la richiesta, il middleware passa la richiesta al middleware successivo nella pipeline delle richieste.</span><span class="sxs-lookup"><span data-stu-id="ce547-1358">If no route handler is found to process the request, the middleware hands the request off to the next middleware in the request pipeline.</span></span>

<span data-ttu-id="ce547-1359">L'input principale per <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> è l'elemento [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associato alla richiesta corrente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1359">The primary input to <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is the [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associated with the current request.</span></span> <span data-ttu-id="ce547-1360">[RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler) e [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) sono gli output che vengono impostati quando una route corrisponde.</span><span class="sxs-lookup"><span data-stu-id="ce547-1360">The [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler) and [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) are outputs set after a route is matched.</span></span>

<span data-ttu-id="ce547-1361">Una corrispondenza che chiama <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> imposta anche le proprietà di [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) sui valori appropriati in base all'elaborazione della richiesta eseguita fino a quel punto.</span><span class="sxs-lookup"><span data-stu-id="ce547-1361">A match that calls <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> also sets the properties of the [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="ce547-1362">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) è un dizionario di *valori di route* prodotti dalla route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1362">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="ce547-1363">Questi valori in genere sono determinati dalla suddivisione in token dell'URL e possono essere usati per accettare l'input dell'utente o per prendere ulteriori decisioni riguardo all'invio all'interno dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1363">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="ce547-1364">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) è un elenco proprietà dei dati aggiuntivi correlati alla route corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1364">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="ce547-1365">Gli elementi <xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> vengono forniti per supportare l'associazione dei dati sullo stato con ogni route in modo che l'app sia in grado di prendere decisioni in base alla route corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1365"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="ce547-1366">Questi valori sono definiti dallo sviluppatore e **non** influiscono sul comportamento del routing in alcun modo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1366">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="ce547-1367">Inoltre, i valori accantonati in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) possono essere di qualsiasi tipo, a differenza dei valori [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values) che devono essere convertibili in e da stringhe.</span><span class="sxs-lookup"><span data-stu-id="ce547-1367">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="ce547-1368">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) è un elenco delle route che hanno preso parte alla corrispondenza corretta della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1368">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="ce547-1369">Le route possono essere annidate l'una nell'altra.</span><span class="sxs-lookup"><span data-stu-id="ce547-1369">Routes can be nested inside of one another.</span></span> <span data-ttu-id="ce547-1370">La proprietà <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> rispecchia il percorso tramite l'albero logico di route che hanno prodotto una corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-1370">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="ce547-1371">In genere il primo elemento in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> è la raccolta di route e deve essere usato per la generazione di URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1371">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="ce547-1372">L'ultimo elemento in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> è il gestore di route corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1372">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation"></a><span data-ttu-id="ce547-1373">Generazione di URL</span><span class="sxs-lookup"><span data-stu-id="ce547-1373">URL generation</span></span>

<span data-ttu-id="ce547-1374">La generazione di URL è il processo con cui il routing crea un percorso URL basato su un set di valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1374">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="ce547-1375">Questo consente di avere una separazione logica tra i gestori di route e gli URL che vi accedono.</span><span class="sxs-lookup"><span data-stu-id="ce547-1375">This allows for a logical separation between route handlers and the URLs that access them.</span></span>

<span data-ttu-id="ce547-1376">La generazione di URL segue un processo iterativo simile, ma inizia con la chiamata del codice dell'utente o del framework nel metodo <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> della raccolta di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1376">URL generation follows a similar iterative process, but it starts with user or framework code calling into the <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method of the route collection.</span></span> <span data-ttu-id="ce547-1377">Per ogni *route* viene chiamato in sequenza il metodo <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> finché non viene restituito un valore <xref:Microsoft.AspNetCore.Routing.VirtualPathData> non Null.</span><span class="sxs-lookup"><span data-stu-id="ce547-1377">Each *route* has its <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method called in sequence until a non-null <xref:Microsoft.AspNetCore.Routing.VirtualPathData> is returned.</span></span>

<span data-ttu-id="ce547-1378">Gli input primari per <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> sono:</span><span class="sxs-lookup"><span data-stu-id="ce547-1378">The primary inputs to <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> are:</span></span>

* [<span data-ttu-id="ce547-1379">VirtualPathContext.HttpContext</span><span class="sxs-lookup"><span data-stu-id="ce547-1379">VirtualPathContext.HttpContext</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext)
* [<span data-ttu-id="ce547-1380">VirtualPathContext.Values</span><span class="sxs-lookup"><span data-stu-id="ce547-1380">VirtualPathContext.Values</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values)
* [<span data-ttu-id="ce547-1381">VirtualPathContext.AmbientValues</span><span class="sxs-lookup"><span data-stu-id="ce547-1381">VirtualPathContext.AmbientValues</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues)

<span data-ttu-id="ce547-1382">Le route usano principalmente i valori di route specificati da <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> e <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> per decidere se è possibile generare un URL e quali valori includere.</span><span class="sxs-lookup"><span data-stu-id="ce547-1382">Routes primarily use the route values provided by <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> and <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> to decide whether it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="ce547-1383">Gli elementi <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> sono il set di valori di route prodotti dalla corrispondenza della richiesta corrente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1383">The <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> are the set of route values that were produced from matching the current request.</span></span> <span data-ttu-id="ce547-1384">Al contrario, gli elementi <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> sono i valori di route che specificano in che modo viene generato l'URL per l'operazione corrente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1384">In contrast, <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="ce547-1385"><xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext> viene specificato nel caso in cui una route ottenga servizi o dati aggiuntivi associati al contesto corrente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1385">The <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext> is provided in case a route should obtain services or additional data associated with the current context.</span></span>

> [!TIP]
> <span data-ttu-id="ce547-1386">Considerare [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) come un set di override per [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span><span class="sxs-lookup"><span data-stu-id="ce547-1386">Think of [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) as a set of overrides for the [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span></span> <span data-ttu-id="ce547-1387">La generazione di URL prova a usare nuovamente i valori di route della richiesta corrente per generare URL per i collegamenti che usano la stessa route o gli stessi valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1387">URL generation attempts to reuse route values from the current request to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="ce547-1388">L'output di <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> è un oggetto <xref:Microsoft.AspNetCore.Routing.VirtualPathData>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1388">The output of <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> is a <xref:Microsoft.AspNetCore.Routing.VirtualPathData>.</span></span> <span data-ttu-id="ce547-1389"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> è un elemento parallelo di <xref:Microsoft.AspNetCore.Routing.RouteData>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1389"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> is a parallel of <xref:Microsoft.AspNetCore.Routing.RouteData>.</span></span> <span data-ttu-id="ce547-1390"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> contiene l'elemento <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> per l'URL di output e alcune proprietà aggiuntive che devono essere impostate dalla route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1390"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> contains the <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> for the output URL and some additional properties that should be set by the route.</span></span>

<span data-ttu-id="ce547-1391">La proprietà [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) contiene il *percorso virtuale* prodotto dalla route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1391">The [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="ce547-1392">In base alle esigenze specifiche, può essere necessario elaborare ulteriormente il percorso.</span><span class="sxs-lookup"><span data-stu-id="ce547-1392">Depending on your needs, you may need to process the path further.</span></span> <span data-ttu-id="ce547-1393">Se si vuole eseguire il rendering in HTML dell'URL generato, anteporre il percorso di base dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1393">If you want to render the generated URL in HTML, prepend the base path of the app.</span></span>

<span data-ttu-id="ce547-1394">[VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) è un riferimento alla route che ha generato correttamente l'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1394">The [VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="ce547-1395">[VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) è un dizionario di dati aggiuntivi correlati alla route che ha generato l'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1395">The [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="ce547-1396">È l'elemento parallelo di [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span><span class="sxs-lookup"><span data-stu-id="ce547-1396">This is the parallel of [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span></span>

### <a name="create-routes"></a><span data-ttu-id="ce547-1397">Creare route</span><span class="sxs-lookup"><span data-stu-id="ce547-1397">Create routes</span></span>

<span data-ttu-id="ce547-1398">Il routing specifica la classe <xref:Microsoft.AspNetCore.Routing.Route> come implementazione standard di <xref:Microsoft.AspNetCore.Routing.IRouter>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1398">Routing provides the <xref:Microsoft.AspNetCore.Routing.Route> class as the standard implementation of <xref:Microsoft.AspNetCore.Routing.IRouter>.</span></span> <span data-ttu-id="ce547-1399"><xref:Microsoft.AspNetCore.Routing.Route> usa la sintassi del *modello di route* per definire i criteri in base ai quali confrontare il percorso URL quando si chiama <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1399"><xref:Microsoft.AspNetCore.Routing.Route> uses the *route template* syntax to define patterns to match against the URL path when <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is called.</span></span> <span data-ttu-id="ce547-1400"><xref:Microsoft.AspNetCore.Routing.Route> usa lo stesso modello di route per generare un URL quando si chiama <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1400"><xref:Microsoft.AspNetCore.Routing.Route> uses the same route template to generate a URL when <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> is called.</span></span>

<span data-ttu-id="ce547-1401">La maggior parte delle app crea le route chiamando <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> o uno dei metodi di estensione simili definiti per <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1401">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="ce547-1402">Tutti i metodi di estensione <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> creano un'istanza di <xref:Microsoft.AspNetCore.Routing.Route> e la aggiungono alla raccolta di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1402">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="ce547-1403"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> non accetta alcun parametro del gestore di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1403"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="ce547-1404"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> aggiunge solo le route che sono gestite da <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1404"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="ce547-1405">Il gestore predefinito è `IRouter` e il gestore potrebbe non gestire la richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1405">The default handler is an `IRouter`, and the handler might not handle the request.</span></span> <span data-ttu-id="ce547-1406">Ad esempio, ASP.NET Core MVC viene in genere configurato come un gestore predefinito che gestisce solo le richieste che corrispondono a un'azione e un controller disponibili.</span><span class="sxs-lookup"><span data-stu-id="ce547-1406">For example, ASP.NET Core MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="ce547-1407">Per altre informazioni sul routing in MVC, vedere <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1407">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="ce547-1408">L'esempio di codice seguente si riferisce a una chiamata <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> usata da una tipica definizione di route di ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="ce547-1408">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="ce547-1409">Questo modello confronta un percorso URL ed estrae i valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1409">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="ce547-1410">Ad esempio, il percorso `/Products/Details/17` genera i valori di route seguenti: `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1410">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="ce547-1411">I valori di route vengono determinati suddividendo il percorso URL in segmenti e confrontando ogni segmento con il nome del *parametro di route* nel modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1411">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="ce547-1412">I parametri di route sono denominati.</span><span class="sxs-lookup"><span data-stu-id="ce547-1412">Route parameters are named.</span></span> <span data-ttu-id="ce547-1413">Parametri definiti racchiudendo il nome del parametro tra parentesi graffe `{ ... }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1413">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="ce547-1414">Il modello precedente può anche confrontare il percorso URL `/` e generare i valori `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1414">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="ce547-1415">Ciò accade perché i parametri di route `{controller}` e `{action}` hanno valori predefiniti e il parametro di route `id` è facoltativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1415">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="ce547-1416">Un segno di uguale (`=`) seguito da un valore dopo il nome del parametro di route definisce un valore predefinito per il parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-1416">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="ce547-1417">Un punto interrogativo (`?`) dopo il nome del parametro di route definisce un parametro facoltativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1417">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="ce547-1418">I parametri di route con un valore predefinito producono *sempre* un valore di route quando la route corrisponde.</span><span class="sxs-lookup"><span data-stu-id="ce547-1418">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="ce547-1419">I parametri facoltativi non producono un valore di route se non è presente un segmento di percorso URL corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1419">Optional parameters don't produce a route value if there is no corresponding URL path segment.</span></span> <span data-ttu-id="ce547-1420">Vedere la sezione [Riferimento per i modelli di route](#route-template-reference) per una descrizione completa degli scenari e della sintassi del modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1420">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="ce547-1421">Nell'esempio seguente la definizione del parametro di route `{id:int}` definisce un [vincolo di route](#route-constraint-reference) per il parametro di route `id`:</span><span class="sxs-lookup"><span data-stu-id="ce547-1421">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="ce547-1422">Questo modello confronta un percorso URL come `/Products/Details/17`, ma non `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1422">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="ce547-1423">I vincoli di route implementano <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> ed esaminano i valori di route per verificarli.</span><span class="sxs-lookup"><span data-stu-id="ce547-1423">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="ce547-1424">In questo esempio il valore di route `id` deve poter essere convertito in un numero intero.</span><span class="sxs-lookup"><span data-stu-id="ce547-1424">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="ce547-1425">Vedere [Riferimento per i vincoli di route](#route-constraint-reference) per una descrizione dei vincoli di route specificati dal framework.</span><span class="sxs-lookup"><span data-stu-id="ce547-1425">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="ce547-1426">Altri overload di <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accettano i valori per `constraints`, `dataTokens` e `defaults`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1426">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="ce547-1427">L'uso tipico di questi parametri è passare un oggetto tipizzato in modo anonimo, in cui i nomi di proprietà di tipo anonimo corrispondono ai nomi dei parametri di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1427">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="ce547-1428">Gli esempi <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> seguenti creano route equivalenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-1428">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="ce547-1429">La sintassi inline per definire i vincoli e i valori predefiniti può essere utile per le route semplici.</span><span class="sxs-lookup"><span data-stu-id="ce547-1429">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="ce547-1430">Esistono tuttavia scenari, come i token di dati, che non sono supportati dalla sintassi inline.</span><span class="sxs-lookup"><span data-stu-id="ce547-1430">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="ce547-1431">L'esempio seguente illustra alcuni scenari aggiuntivi:</span><span class="sxs-lookup"><span data-stu-id="ce547-1431">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{*article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="ce547-1432">Il modello precedente confronta un percorso URL come `/Blog/All-About-Routing/Introduction` ed estrae i valori `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1432">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="ce547-1433">I valori di route predefiniti per `controller` e `action` vengono generati dalla route anche se sono non presenti parametri di route corrispondenti nel modello.</span><span class="sxs-lookup"><span data-stu-id="ce547-1433">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="ce547-1434">I valori predefiniti possono essere specificati nel modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1434">Default values can be specified in the route template.</span></span> <span data-ttu-id="ce547-1435">Il parametro di route `article` è definito come *catch-all* in base alla presenza di un asterisco (`*`) prima del nome del parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1435">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk (`*`) before the route parameter name.</span></span> <span data-ttu-id="ce547-1436">I parametri di route catch-all acquisiscono il resto del percorso URL e possono anche corrispondere alla stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="ce547-1436">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="ce547-1437">L'esempio seguente aggiunge i vincoli di route e i token di dati:</span><span class="sxs-lookup"><span data-stu-id="ce547-1437">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="ce547-1438">Il modello precedente confronta un percorso URL come `/en-US/Products/5` ed estrae i valori `{ controller = Products, action = Details, id = 5 }` e i token di dati `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1438">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Token della finestra Variabili locali](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="ce547-1440">Generazione di URL della classe di route</span><span class="sxs-lookup"><span data-stu-id="ce547-1440">Route class URL generation</span></span>

<span data-ttu-id="ce547-1441">La classe <xref:Microsoft.AspNetCore.Routing.Route> è inoltre in grado di eseguire la generazione di URL combinando un set di valori di route con il relativo modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1441">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="ce547-1442">Questo è logicamente il processo inverso di corrispondenza del percorso URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1442">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="ce547-1443">Per comprendere meglio la generazione di URL, si pensi a quale URL si vuole generare e al modo in cui un modello di route deve corrispondere a tale URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1443">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="ce547-1444">Quali valori devono essere prodotti?</span><span class="sxs-lookup"><span data-stu-id="ce547-1444">What values would be produced?</span></span> <span data-ttu-id="ce547-1445">Questo equivale approssimativamente al funzionamento della generazione di URL nella classe <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1445">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="ce547-1446">L'esempio seguente usa una route predefinita di ASP.NET Core MVC generale:</span><span class="sxs-lookup"><span data-stu-id="ce547-1446">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="ce547-1447">Con i valori di route `{ controller = Products, action = List }`, viene generato l'URL `/Products/List`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1447">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="ce547-1448">I valori di route vengono sostituiti dai parametri di route corrispondenti per formare il percorso URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1448">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="ce547-1449">Poiché `id` è un parametro di route facoltativo, l'URL è stato generato senza un valore per `id`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1449">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="ce547-1450">Con i valori di route `{ controller = Home, action = Index }`, viene generato l'URL `/`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1450">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="ce547-1451">Poiché i valori di route specificati corrispondono ai valori predefiniti, i segmenti corrispondenti ai valori predefiniti possono essere omessi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1451">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="ce547-1452">Per entrambi gli URL generati viene eseguito il round trip con la definizione di route seguente (`/Home/Index` e `/`) e vengono prodotti gli stessi valori di route usati per generare l'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1452">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="ce547-1453">Un'app che usa ASP.NET Core MVC deve usare <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> per generare gli URL invece di eseguire la chiamata direttamente nel routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-1453">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="ce547-1454">Per altre informazioni sulla generazione di URL, vedere la sezione [Riferimento per la generazione di URL](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-1454">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="ce547-1455">USA middleware di routing</span><span class="sxs-lookup"><span data-stu-id="ce547-1455">Use routing middleware</span></span>

<span data-ttu-id="ce547-1456">Fare riferimento al [metapacchetto Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) nel file di progetto dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1456">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="ce547-1457">Aggiungere il routing al contenitore del servizio in `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="ce547-1457">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="ce547-1458">Le route devono essere configurate nel metodo `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1458">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="ce547-1459">L'app di esempio usa le API seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce547-1459">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="ce547-1460"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>: Corrisponde solo alle richieste HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="ce547-1460"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>: Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="ce547-1461">Nella tabella seguente sono elencate le risposte con gli URI specificati.</span><span class="sxs-lookup"><span data-stu-id="ce547-1461">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="ce547-1462">URI</span><span class="sxs-lookup"><span data-stu-id="ce547-1462">URI</span></span>                    | <span data-ttu-id="ce547-1463">Risposta</span><span class="sxs-lookup"><span data-stu-id="ce547-1463">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="ce547-1464">Hello!</span><span class="sxs-lookup"><span data-stu-id="ce547-1464">Hello!</span></span> <span data-ttu-id="ce547-1465">Route values: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="ce547-1465">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="ce547-1466">Hello!</span><span class="sxs-lookup"><span data-stu-id="ce547-1466">Hello!</span></span> <span data-ttu-id="ce547-1467">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="ce547-1467">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="ce547-1468">Hello!</span><span class="sxs-lookup"><span data-stu-id="ce547-1468">Hello!</span></span> <span data-ttu-id="ce547-1469">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="ce547-1469">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="ce547-1470">La richiesta non viene eseguita, nessuna corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-1470">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="ce547-1471">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="ce547-1471">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="ce547-1472">La richiesta non viene eseguita, corrispondenza solo con HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="ce547-1472">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="ce547-1473">La richiesta non viene eseguita, nessuna corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-1473">The request falls through, no match.</span></span>              |

<span data-ttu-id="ce547-1474">Se si sta configurando una singola route, chiamare <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passando un'istanza di `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1474">If you're configuring a single route, call <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passing in an `IRouter` instance.</span></span> <span data-ttu-id="ce547-1475">Non è necessario usare <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1475">You won't need to use <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span></span>

<span data-ttu-id="ce547-1476">Il framework offre un set di metodi di estensione per la creazione di route (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span><span class="sxs-lookup"><span data-stu-id="ce547-1476">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="ce547-1477">Alcuni dei metodi elencati, ad esempio <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>, richiedono <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1477">Some of listed methods, such as <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>, require a <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="ce547-1478"><xref:Microsoft.AspNetCore.Http.RequestDelegate> viene usato come *gestore di route* quando la route corrisponde.</span><span class="sxs-lookup"><span data-stu-id="ce547-1478">The <xref:Microsoft.AspNetCore.Http.RequestDelegate> is used as the *route handler* when the route matches.</span></span> <span data-ttu-id="ce547-1479">Altri metodi di questa famiglia consentono di configurare una pipeline middleware che verrà usata come gestore di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1479">Other methods in this family allow configuring a middleware pipeline for use as the route handler.</span></span> <span data-ttu-id="ce547-1480">Se il metodo `Map*` non accetta un gestore, ad esempio <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>, il metodo usa <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1480">If the `Map*` method doesn't accept a handler, such as <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>, it uses the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span>

<span data-ttu-id="ce547-1481">I metodi `Map[Verb]` usano i vincoli per limitare la route al verbo HTTP nel nome del metodo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1481">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="ce547-1482">Vedere ad esempio <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> e <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1482">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="ce547-1483">Riferimento per il modello di route</span><span class="sxs-lookup"><span data-stu-id="ce547-1483">Route template reference</span></span>

<span data-ttu-id="ce547-1484">I token all'interno di parentesi graffe (`{ ... }`) definiscono i *parametri di route* che vengono associati se esiste una corrispondenza per la route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1484">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="ce547-1485">È possibile definire più parametri di route in un segmento di route, ma devono essere separati da un valore letterale.</span><span class="sxs-lookup"><span data-stu-id="ce547-1485">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="ce547-1486">Ad esempio, `{controller=Home}{action=Index}` non è una route valida perché non è presente un valore letterale tra `{controller}` e `{action}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1486">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="ce547-1487">Questi parametri di route devono avere un nome e possono avere attributi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1487">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="ce547-1488">Il testo letterale diverso dai parametri di route, ad esempio `{id}`, e il separatore di percorso `/` devono corrispondere al testo nell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1488">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="ce547-1489">La corrispondenza del testo non fa distinzione tra maiuscole e minuscole e si basa sulla rappresentazione decodificata del percorso degli URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1489">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="ce547-1490">Per verificare la corrispondenza di un delimitatore letterale dei parametri di route (`{` o `}`), eseguire l'escape del delimitatore ripetendo il carattere (`{{` o `}}`).</span><span class="sxs-lookup"><span data-stu-id="ce547-1490">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="ce547-1491">I modelli di URL che tentano di acquisire un nome file con un'estensione facoltativa hanno considerazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="ce547-1491">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="ce547-1492">Considerare ad esempio il modello `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1492">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="ce547-1493">Se esistono i valori per `filename` e `ext`, vengono popolati entrambi i valori.</span><span class="sxs-lookup"><span data-stu-id="ce547-1493">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="ce547-1494">Se esiste solo un valore per `filename` nell'URL, la route corrisponde perché il punto finale (`.`) è facoltativo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1494">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="ce547-1495">Gli URL seguenti corrispondono a questa route:</span><span class="sxs-lookup"><span data-stu-id="ce547-1495">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="ce547-1496">È possibile usare l'asterisco (`*`) come prefisso per un parametro di route da associare alla parte rimanente dell'URI,</span><span class="sxs-lookup"><span data-stu-id="ce547-1496">You can use the asterisk (`*`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="ce547-1497">ovvero un parametro *catch-all*.</span><span class="sxs-lookup"><span data-stu-id="ce547-1497">This is called a *catch-all* parameter.</span></span> <span data-ttu-id="ce547-1498">Ad esempio, `blog/{*slug}` corrisponde a qualsiasi URI che inizia con `/blog` seguito da qualsiasi valore, che viene assegnato al valore di route `slug`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1498">For example, `blog/{*slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="ce547-1499">I parametri catch-all possono anche corrispondere alla stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="ce547-1499">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="ce547-1500">Il parametro catch-all esegue l'escape dei caratteri appropriati, incluso il separatore di percorso (`/`), quando la route viene usata per generare un URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1500">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="ce547-1501">Ad esempio, la route `foo/{*path}` con i valori di route `{ path = "my/path" }` genera `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1501">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="ce547-1502">Si noti la barra di escape.</span><span class="sxs-lookup"><span data-stu-id="ce547-1502">Note the escaped forward slash.</span></span>

<span data-ttu-id="ce547-1503">I parametri di route possono avere *valori predefiniti*, definiti specificando il valore predefinito dopo il nome del parametro, separato da un segno di uguale (`=`).</span><span class="sxs-lookup"><span data-stu-id="ce547-1503">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="ce547-1504">Ad esempio, `{controller=Home}` definisce `Home` come valore predefinito per `controller`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1504">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="ce547-1505">Il valore predefinito viene usato se nell'URL non è presente alcun valore per il parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-1505">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="ce547-1506">I parametri di route vengono resi facoltativi aggiungendo un punto interrogativo (`?`) alla fine del nome del parametro, come in `id?`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1506">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="ce547-1507">La differenza tra parametri facoltativi e parametri di route predefiniti è che un parametro di route con un valore predefinito produce sempre un valore, mentre un parametro facoltativo ha un valore solo se ne viene specificato uno dall'URL della richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1507">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="ce547-1508">I parametri di route possono presentare dei vincoli che devono corrispondere al valore di route associato dall'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1508">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="ce547-1509">Aggiungendo due punti (`:`) e il nome del vincolo dopo il nome del parametro di route, si specifica un *vincolo inline* per un parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1509">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="ce547-1510">Se il vincolo richiede argomenti, vengono racchiusi tra parentesi (`(...)`) dopo il nome del vincolo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1510">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="ce547-1511">È possibile specificare più vincoli inline aggiungendo di nuovo i due punti (`:`) e il nome del vincolo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1511">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="ce547-1512">Il nome del vincolo e gli argomenti vengono passati al servizio <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> per creare un'istanza di <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> da usare nell'elaborazione dell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1512">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="ce547-1513">Il modello di route `blog/{article:minlength(10)}` specifica ad esempio un vincolo `minlength` con l'argomento `10`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1513">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="ce547-1514">Per altre informazioni sui vincoli di route e per un elenco dei vincoli specificati dal framework, vedere la sezione [Riferimento per i vincoli di route](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-1514">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="ce547-1515">La tabella seguente illustra i modelli di route di esempio e il relativo comportamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-1515">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="ce547-1516">Modello di route</span><span class="sxs-lookup"><span data-stu-id="ce547-1516">Route Template</span></span>                           | <span data-ttu-id="ce547-1517">URI corrispondente di esempio</span><span class="sxs-lookup"><span data-stu-id="ce547-1517">Example Matching URI</span></span>    | <span data-ttu-id="ce547-1518">L'URI della richiesta&hellip;</span><span class="sxs-lookup"><span data-stu-id="ce547-1518">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="ce547-1519">Verifica la corrispondenza solo del singolo percorso `/hello`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1519">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="ce547-1520">Verifica la corrispondenza e imposta `Page` su `Home`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1520">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="ce547-1521">Verifica la corrispondenza e imposta `Page` su `Contact`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1521">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="ce547-1522">Esegue il mapping al controller `Products` e all'azione `List`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1522">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="ce547-1523">Esegue il mapping al controller `Products` e all'azione `Details` (`id` impostato su 123).</span><span class="sxs-lookup"><span data-stu-id="ce547-1523">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="ce547-1524">Esegue il mapping al controller `Home` e al metodo `Index` (`id` viene ignorato).</span><span class="sxs-lookup"><span data-stu-id="ce547-1524">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="ce547-1525">L'uso di un modello è in genere l'approccio più semplice al routing.</span><span class="sxs-lookup"><span data-stu-id="ce547-1525">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="ce547-1526">I vincoli e le impostazioni predefinite possono essere specificati anche all'esterno del modello di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1526">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="ce547-1527">Abilitare la [registrazione](xref:fundamentals/logging/index) per verificare in che modo le implementazioni del routing predefinite, ad esempio <xref:Microsoft.AspNetCore.Routing.Route>, corrispondono alle richieste.</span><span class="sxs-lookup"><span data-stu-id="ce547-1527">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="route-constraint-reference"></a><span data-ttu-id="ce547-1528">Riferimento per i vincoli di route</span><span class="sxs-lookup"><span data-stu-id="ce547-1528">Route constraint reference</span></span>

<span data-ttu-id="ce547-1529">I vincoli di route vengono eseguiti quando si verifica una corrispondenza nell'URL in ingresso e il percorso URL viene suddiviso in valori di route in formato token.</span><span class="sxs-lookup"><span data-stu-id="ce547-1529">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="ce547-1530">I vincoli di route in genere controllano il valore di route associato usando il modello di route e stabiliscono con una decisione Sì/No se il valore è accettabile o meno.</span><span class="sxs-lookup"><span data-stu-id="ce547-1530">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="ce547-1531">Alcuni vincoli di route usano i dati all'esterno del valore di route per stabilire se la richiesta può essere instradata.</span><span class="sxs-lookup"><span data-stu-id="ce547-1531">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="ce547-1532">Ad esempio, <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> può accettare o rifiutare una richiesta in base al relativo verbo HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce547-1532">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="ce547-1533">I vincoli vengono usati nelle richieste del routing e nella generazione di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="ce547-1533">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="ce547-1534">Non usare i vincoli per la **convalida dell'input**.</span><span class="sxs-lookup"><span data-stu-id="ce547-1534">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="ce547-1535">Se vengono usati vincoli per la **convalida dell'input**, un input non valido causa la visualizzazione di un errore di tipo *404 (Non trovato)* invece di un errore di tipo *400 - Richiesta non valida* con un messaggio di errore appropriato.</span><span class="sxs-lookup"><span data-stu-id="ce547-1535">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="ce547-1536">I vincoli di route vengono usati per evitare **ambiguità** tra route simili, non per convalidare gli input per una route specifica.</span><span class="sxs-lookup"><span data-stu-id="ce547-1536">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="ce547-1537">La tabella seguente illustra i vincoli di route di esempio e il relativo comportamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-1537">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="ce547-1538">vincolo</span><span class="sxs-lookup"><span data-stu-id="ce547-1538">constraint</span></span> | <span data-ttu-id="ce547-1539">Esempio</span><span class="sxs-lookup"><span data-stu-id="ce547-1539">Example</span></span> | <span data-ttu-id="ce547-1540">Esempi di corrispondenza</span><span class="sxs-lookup"><span data-stu-id="ce547-1540">Example Matches</span></span> | <span data-ttu-id="ce547-1541">Note</span><span class="sxs-lookup"><span data-stu-id="ce547-1541">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="ce547-1542">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="ce547-1542">`123456789`, `-123456789`</span></span> | <span data-ttu-id="ce547-1543">Corrisponde a qualsiasi numero intero</span><span class="sxs-lookup"><span data-stu-id="ce547-1543">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="ce547-1544">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="ce547-1544">`true`, `FALSE`</span></span> | <span data-ttu-id="ce547-1545">Corrisponde a `true` o `false` (senza distinzione tra maiuscole e minuscole)</span><span class="sxs-lookup"><span data-stu-id="ce547-1545">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="ce547-1546">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="ce547-1546">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="ce547-1547">Corrisponde a un `DateTime` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-1547">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="ce547-1548">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1548">See  preceding warning.</span></span>|
| `decimal` | `{price:decimal}` | <span data-ttu-id="ce547-1549">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="ce547-1549">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="ce547-1550">Corrisponde a un `decimal` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-1550">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="ce547-1551">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1551">See  preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="ce547-1552">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="ce547-1552">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="ce547-1553">Corrisponde a un `double` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-1553">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="ce547-1554">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1554">See  preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="ce547-1555">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="ce547-1555">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="ce547-1556">Corrisponde a un `float` valore valido della lingua inglese.</span><span class="sxs-lookup"><span data-stu-id="ce547-1556">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="ce547-1557">Vedere l'avviso precedente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1557">See  preceding warning.</span></span>|
| `guid` | `{id:guid}` | <span data-ttu-id="ce547-1558">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="ce547-1558">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="ce547-1559">Corrisponde a un valore `Guid` valido</span><span class="sxs-lookup"><span data-stu-id="ce547-1559">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="ce547-1560">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="ce547-1560">`123456789`, `-123456789`</span></span> | <span data-ttu-id="ce547-1561">Corrisponde a un valore `long` valido</span><span class="sxs-lookup"><span data-stu-id="ce547-1561">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="ce547-1562">La stringa deve contenere almeno 4 caratteri</span><span class="sxs-lookup"><span data-stu-id="ce547-1562">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="ce547-1563">La stringa non deve contenere più di 8 caratteri</span><span class="sxs-lookup"><span data-stu-id="ce547-1563">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="ce547-1564">La stringa deve contenere esattamente 12 caratteri</span><span class="sxs-lookup"><span data-stu-id="ce547-1564">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="ce547-1565">La stringa deve contenere almeno 8 e non più di 16 caratteri</span><span class="sxs-lookup"><span data-stu-id="ce547-1565">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="ce547-1566">Il valore intero deve essere almeno 18</span><span class="sxs-lookup"><span data-stu-id="ce547-1566">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="ce547-1567">Il valore intero non deve essere superiore a 120</span><span class="sxs-lookup"><span data-stu-id="ce547-1567">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="ce547-1568">Il valore intero deve essere almeno 18 ma non più di 120</span><span class="sxs-lookup"><span data-stu-id="ce547-1568">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="ce547-1569">La stringa deve essere costituita da uno o più caratteri alfabetici (`a`-`z`, senza distinzione tra maiuscole e minuscole)</span><span class="sxs-lookup"><span data-stu-id="ce547-1569">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="ce547-1570">La stringa deve corrispondere all'espressione regolare (vedere i suggerimenti per la definizione di un'espressione regolare)</span><span class="sxs-lookup"><span data-stu-id="ce547-1570">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="ce547-1571">Usato per imporre che un valore diverso da un parametro sia presente durante la generazione dell'URL</span><span class="sxs-lookup"><span data-stu-id="ce547-1571">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="ce547-1572">Più vincoli delimitati da punti possono essere applicati a un singolo parametro.</span><span class="sxs-lookup"><span data-stu-id="ce547-1572">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="ce547-1573">Ad esempio il vincolo seguente limita un parametro a un valore intero maggiore o uguale a 1:</span><span class="sxs-lookup"><span data-stu-id="ce547-1573">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="ce547-1574">I vincoli di route che verificano l'URL e vengono convertiti in un tipo CLR, ad esempio `int` o `DateTime`, usano sempre le impostazioni cultura inglese non dipendenti da paese/area geografica,</span><span class="sxs-lookup"><span data-stu-id="ce547-1574">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="ce547-1575">presupponendo che l'URL sia non localizzabile.</span><span class="sxs-lookup"><span data-stu-id="ce547-1575">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="ce547-1576">I vincoli di route specificati dal framework non modificano i valori archiviati nei valori di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1576">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="ce547-1577">Tutti i valori di route analizzati dall'URL vengono archiviati come stringhe.</span><span class="sxs-lookup"><span data-stu-id="ce547-1577">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="ce547-1578">Ad esempio, il vincolo `float` prova a convertire il valore di route in un valore float, ma il valore convertito viene usato solo per verificare che può essere convertito in un valore float.</span><span class="sxs-lookup"><span data-stu-id="ce547-1578">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="ce547-1579">Espressioni regolari</span><span class="sxs-lookup"><span data-stu-id="ce547-1579">Regular expressions</span></span>

<span data-ttu-id="ce547-1580">Il framework di ASP.NET Core aggiunge `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` al costruttore di espressioni regolari.</span><span class="sxs-lookup"><span data-stu-id="ce547-1580">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="ce547-1581">Per una descrizione di questi membri, vedere <xref:System.Text.RegularExpressions.RegexOptions>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1581">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="ce547-1582">Le espressioni regolari usano delimitatori e token simili a quelli usati dal routing e dal linguaggio C#.</span><span class="sxs-lookup"><span data-stu-id="ce547-1582">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="ce547-1583">Per i token di espressione è necessario aggiungere caratteri di escape.</span><span class="sxs-lookup"><span data-stu-id="ce547-1583">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="ce547-1584">Per usare l'espressione regolare `^\d{3}-\d{2}-\d{4}$` nel routing, l'espressione deve includere i caratteri `\` (barra rovesciata singola) specificati nella stringa come caratteri `\\` (barra rovesciata doppia) nel file di origine C# per eseguire l'escape del carattere di escape della stringa `\`, a meno che non si usino [valori letterali di stringa verbatim](/dotnet/csharp/language-reference/keywords/string).</span><span class="sxs-lookup"><span data-stu-id="ce547-1584">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing, the expression must have the `\` (single backslash) characters provided in the string as `\\` (double backslash) characters in the C# source file in order to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string)).</span></span> <span data-ttu-id="ce547-1585">Per eseguire l'escape dii caratteri delimitatori dei parametri di routing (`{`, `}`, `[`, `]`), raddoppiare i caratteri nell'espressione (`{{`, `}`, `[[`, `]]`).</span><span class="sxs-lookup"><span data-stu-id="ce547-1585">To escape routing parameter delimiter characters (`{`, `}`, `[`, `]`), double the characters in the expression (`{{`, `}`, `[[`, `]]`).</span></span> <span data-ttu-id="ce547-1586">La tabella seguente mostra un'espressione regolare e la versione dopo l'escape.</span><span class="sxs-lookup"><span data-stu-id="ce547-1586">The following table shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="ce547-1587">Espressione regolare</span><span class="sxs-lookup"><span data-stu-id="ce547-1587">Regular Expression</span></span>    | <span data-ttu-id="ce547-1588">Espressione regolare con caratteri di escape</span><span class="sxs-lookup"><span data-stu-id="ce547-1588">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="ce547-1589">Le espressioni regolari usate nel routing spesso iniziano con l'accento circonflesso (`^`) e corrispondono alla posizione iniziale della stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-1589">Regular expressions used in routing often start with the caret (`^`) character and match starting position of the string.</span></span> <span data-ttu-id="ce547-1590">Le espressioni spesso terminano con il segno di dollaro (`$`) e corrispondono alla fine della stringa.</span><span class="sxs-lookup"><span data-stu-id="ce547-1590">The expressions often end with the dollar sign (`$`) character and match end of the string.</span></span> <span data-ttu-id="ce547-1591">I caratteri `^` e `$` consentono di verificare che l'espressione regolare corrisponda all'intero valore del parametro di route.</span><span class="sxs-lookup"><span data-stu-id="ce547-1591">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="ce547-1592">Senza i caratteri `^` e `$` l'espressione regolare corrisponde a qualsiasi sottostringa all'interno della stringa e spesso questo non è il risultato desiderato.</span><span class="sxs-lookup"><span data-stu-id="ce547-1592">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="ce547-1593">La tabella seguente include alcuni esempi e descrive perché si verifica o non si verifica la corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="ce547-1593">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="ce547-1594">Expression</span><span class="sxs-lookup"><span data-stu-id="ce547-1594">Expression</span></span>   | <span data-ttu-id="ce547-1595">string</span><span class="sxs-lookup"><span data-stu-id="ce547-1595">String</span></span>    | <span data-ttu-id="ce547-1596">Corrispondenza</span><span class="sxs-lookup"><span data-stu-id="ce547-1596">Match</span></span> | <span data-ttu-id="ce547-1597">Commento</span><span class="sxs-lookup"><span data-stu-id="ce547-1597">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="ce547-1598">hello</span><span class="sxs-lookup"><span data-stu-id="ce547-1598">hello</span></span>     | <span data-ttu-id="ce547-1599">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-1599">Yes</span></span>   | <span data-ttu-id="ce547-1600">Corrispondenze di sottostringhe</span><span class="sxs-lookup"><span data-stu-id="ce547-1600">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="ce547-1601">123abc456</span><span class="sxs-lookup"><span data-stu-id="ce547-1601">123abc456</span></span> | <span data-ttu-id="ce547-1602">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-1602">Yes</span></span>   | <span data-ttu-id="ce547-1603">Corrispondenze di sottostringhe</span><span class="sxs-lookup"><span data-stu-id="ce547-1603">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="ce547-1604">mz</span><span class="sxs-lookup"><span data-stu-id="ce547-1604">mz</span></span>        | <span data-ttu-id="ce547-1605">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-1605">Yes</span></span>   | <span data-ttu-id="ce547-1606">Corrisponde all'espressione</span><span class="sxs-lookup"><span data-stu-id="ce547-1606">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="ce547-1607">MZ</span><span class="sxs-lookup"><span data-stu-id="ce547-1607">MZ</span></span>        | <span data-ttu-id="ce547-1608">Sì</span><span class="sxs-lookup"><span data-stu-id="ce547-1608">Yes</span></span>   | <span data-ttu-id="ce547-1609">Senza distinzione maiuscole/minuscole</span><span class="sxs-lookup"><span data-stu-id="ce547-1609">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="ce547-1610">hello</span><span class="sxs-lookup"><span data-stu-id="ce547-1610">hello</span></span>     | <span data-ttu-id="ce547-1611">No</span><span class="sxs-lookup"><span data-stu-id="ce547-1611">No</span></span>    | <span data-ttu-id="ce547-1612">Vedere `^` e `$` sopra</span><span class="sxs-lookup"><span data-stu-id="ce547-1612">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="ce547-1613">123abc456</span><span class="sxs-lookup"><span data-stu-id="ce547-1613">123abc456</span></span> | <span data-ttu-id="ce547-1614">No</span><span class="sxs-lookup"><span data-stu-id="ce547-1614">No</span></span>    | <span data-ttu-id="ce547-1615">Vedere `^` e `$` sopra</span><span class="sxs-lookup"><span data-stu-id="ce547-1615">See `^` and `$` above</span></span> |

<span data-ttu-id="ce547-1616">Per altre informazioni sulla sintassi delle espressioni regolari, vedere [Espressioni regolari di .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="ce547-1616">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="ce547-1617">Per limitare un parametro a un set noto di valori possibili, usare un'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="ce547-1617">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="ce547-1618">Ad esempio, `{action:regex(^(list|get|create)$)}` verifica la corrispondenza del valore di route `action` solo con `list`, `get` o `create`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1618">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="ce547-1619">Se viene passata nel dizionario di vincoli, la stringa `^(list|get|create)$` è equivalente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1619">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="ce547-1620">Anche i vincoli passati nel dizionario di vincoli (non inline all'interno di un modello) che non corrispondono a uno dei vincoli noti vengono considerati espressioni regolari.</span><span class="sxs-lookup"><span data-stu-id="ce547-1620">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="ce547-1621">Vincoli di route personalizzati</span><span class="sxs-lookup"><span data-stu-id="ce547-1621">Custom Route Constraints</span></span>

<span data-ttu-id="ce547-1622">Oltre ai vincoli di route predefiniti, è possibile creare vincoli di route personalizzati implementando l'interfaccia <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1622">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="ce547-1623">L'interfaccia <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> contiene un singolo metodo, `Match`, che restituisce `true` se il vincolo viene soddisfatto e `false` in caso contrario.</span><span class="sxs-lookup"><span data-stu-id="ce547-1623">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="ce547-1624">Per usare un'interfaccia <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> personalizzata, il tipo di vincolo di route deve essere registrato con la proprietà <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> dell'app nel contenitore di servizi dell'app.</span><span class="sxs-lookup"><span data-stu-id="ce547-1624">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="ce547-1625"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> è un dizionario che esegue il mapping delle chiavi dei vincoli di route alle implementazioni di <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> che convalidano tali vincoli.</span><span class="sxs-lookup"><span data-stu-id="ce547-1625">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="ce547-1626">La proprietà <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> di un'app può essere aggiornata in `Startup.ConfigureServices` come parte di una chiamata [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) o configurando <xref:Microsoft.AspNetCore.Routing.RouteOptions> direttamente con `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1626">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="ce547-1627">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="ce547-1627">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="ce547-1628">Il vincolo può quindi essere applicato alle route nel modo consueto, usando il nome specificato al momento della registrazione del tipo di vincolo.</span><span class="sxs-lookup"><span data-stu-id="ce547-1628">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="ce547-1629">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="ce547-1629">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="url-generation-reference"></a><span data-ttu-id="ce547-1630">Riferimento per la generazione di URL</span><span class="sxs-lookup"><span data-stu-id="ce547-1630">URL generation reference</span></span>

<span data-ttu-id="ce547-1631">L'esempio seguente mostra come generare un collegamento a una route usando un dizionario di valori di route e un elemento <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span><span class="sxs-lookup"><span data-stu-id="ce547-1631">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="ce547-1632">L'elemento <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generato alla fine dell'esempio precedente è `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1632">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="ce547-1633">Il dizionario fornisce i valori di route `operation` e `id` del modello "Track Package Route", `package/{operation}/{id}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1633">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="ce547-1634">Per informazioni dettagliate, vedere il codice di esempio nella sezione [Usare il middleware di routing](#use-routing-middleware) oppure l'[app di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples).</span><span class="sxs-lookup"><span data-stu-id="ce547-1634">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="ce547-1635">Il secondo parametro per il costruttore <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> è una raccolta di *valori di ambiente*.</span><span class="sxs-lookup"><span data-stu-id="ce547-1635">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="ce547-1636">I valori di ambiente sono utili poiché limitano il numero di valori che uno sviluppatore deve specificare all'interno del contesto di una richiesta.</span><span class="sxs-lookup"><span data-stu-id="ce547-1636">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="ce547-1637">I valori di route correnti della richiesta corrente sono considerati valori di ambiente per la generazione del collegamento.</span><span class="sxs-lookup"><span data-stu-id="ce547-1637">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="ce547-1638">Nell'azione `About` di un'app ASP.NET Core MVC di `HomeController`, non è necessario specificare il valore di route del controller per collegarsi all'azione `Index`. Viene usato il valore di ambiente `Home`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1638">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="ce547-1639">I valori di ambiente che non corrispondono a un parametro vengono ignorati.</span><span class="sxs-lookup"><span data-stu-id="ce547-1639">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="ce547-1640">I valori di ambiente vengono ignorati anche quando un valore specificato in modo esplicito esegue l'override del valore di ambiente.</span><span class="sxs-lookup"><span data-stu-id="ce547-1640">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="ce547-1641">La corrispondenza si verifica da sinistra a destra nell'URL.</span><span class="sxs-lookup"><span data-stu-id="ce547-1641">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="ce547-1642">I valori specificati in modo esplicito ma che non corrispondono a un segmento della route vengono aggiunti alla stringa di query.</span><span class="sxs-lookup"><span data-stu-id="ce547-1642">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="ce547-1643">La tabella seguente illustra il risultato ottenuto quando si usa il modello di route `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1643">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="ce547-1644">Valori di ambiente</span><span class="sxs-lookup"><span data-stu-id="ce547-1644">Ambient Values</span></span>                     | <span data-ttu-id="ce547-1645">Valori espliciti</span><span class="sxs-lookup"><span data-stu-id="ce547-1645">Explicit Values</span></span>                        | <span data-ttu-id="ce547-1646">Risultato</span><span class="sxs-lookup"><span data-stu-id="ce547-1646">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="ce547-1647">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-1647">controller = "Home"</span></span>                | <span data-ttu-id="ce547-1648">action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-1648">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="ce547-1649">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-1649">controller = "Home"</span></span>                | <span data-ttu-id="ce547-1650">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-1650">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="ce547-1651">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="ce547-1651">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="ce547-1652">action = "About"</span><span class="sxs-lookup"><span data-stu-id="ce547-1652">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="ce547-1653">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="ce547-1653">controller = "Home"</span></span>                | <span data-ttu-id="ce547-1654">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="ce547-1654">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="ce547-1655">Se una route ha un valore predefinito che non corrisponde a un parametro e tale valore viene specificato in modo esplicito, deve corrispondere al valore predefinito:</span><span class="sxs-lookup"><span data-stu-id="ce547-1655">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="ce547-1656">La generazione dei collegamenti genera un collegamento per questa route quando vengono specificati i valori corrispondenti per `controller` e `action`.</span><span class="sxs-lookup"><span data-stu-id="ce547-1656">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="ce547-1657">Segmenti complessi</span><span class="sxs-lookup"><span data-stu-id="ce547-1657">Complex segments</span></span>

<span data-ttu-id="ce547-1658">I segmenti complessi (ad esempio, `[Route("/x{token}y")]`), vengono elaborati individuando corrispondenze per i valori letterali da destra a sinistra in modalità non-greedy.</span><span class="sxs-lookup"><span data-stu-id="ce547-1658">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="ce547-1659">Vedere [questo codice](https://github.com/dotnet/aspnetcore/blob/v2.2.13/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) per una spiegazione dettagliata di come vengono confrontati i segmenti complessi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1659">See [this code](https://github.com/dotnet/aspnetcore/blob/v2.2.13/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="ce547-1660">L'[esempio di codice](https://github.com/dotnet/aspnetcore/blob/v2.2.13/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) non viene usato da ASP.NET Core, ma offre una spiegazione esauriente dei segmenti complessi.</span><span class="sxs-lookup"><span data-stu-id="ce547-1660">The [code sample](https://github.com/dotnet/aspnetcore/blob/v2.2.13/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>

::: moniker-end
