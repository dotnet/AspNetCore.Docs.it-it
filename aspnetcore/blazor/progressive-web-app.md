---
title: Creazione di applicazioni Web progressive con ASP.NET Core Blazor WebAssembly
author: guardrex
description: Informazioni su come creare un' Blazor applicazione Web progressiva basata su (PWA) che usa le funzionalità moderne del browser per comportarsi come un'app desktop.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 01/11/2021
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: fcf06295deb41f304b92caa82535a1197c909898
ms.sourcegitcommit: 75db2f684a9302b0be7925eab586aa091c6bd19f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/01/2021
ms.locfileid: "99238235"
---
# <a name="build-progressive-web-applications-with-aspnet-core-no-locblazor-webassembly"></a><span data-ttu-id="a6de2-103">Creazione di applicazioni Web progressive con ASP.NET Core Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="a6de2-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="a6de2-104">Di [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="a6de2-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

<span data-ttu-id="a6de2-105">Un'applicazione Web progressiva (PWA) è in genere un'applicazione a pagina singola (SPA) che usa le API e le funzionalità moderne del browser per comportarsi come un'app desktop.</span><span class="sxs-lookup"><span data-stu-id="a6de2-105">A Progressive Web Application (PWA) is usually a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="a6de2-106">Blazor WebAssembly è una piattaforma di app Web lato client basata su standard, pertanto può usare qualsiasi API del browser, incluse le API di PWA richieste per le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="a6de2-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="a6de2-107">Lavorare offline e caricare immediatamente, indipendentemente dalla velocità di rete.</span><span class="sxs-lookup"><span data-stu-id="a6de2-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="a6de2-108">In esecuzione nella propria finestra dell'app, non solo in una finestra del browser.</span><span class="sxs-lookup"><span data-stu-id="a6de2-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="a6de2-109">Viene avviato dal menu Start del sistema operativo dell'host, ancorato o dalla schermata iniziale.</span><span class="sxs-lookup"><span data-stu-id="a6de2-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="a6de2-110">Ricezione di notifiche push da un server back-end, anche quando l'utente non usa l'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="a6de2-111">Aggiornamento automatico in background.</span><span class="sxs-lookup"><span data-stu-id="a6de2-111">Automatically updating in the background.</span></span>

<span data-ttu-id="a6de2-112">La parola *progressive* viene usata per descrivere tali app perché:</span><span class="sxs-lookup"><span data-stu-id="a6de2-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="a6de2-113">Un utente potrebbe prima di tutto individuare e usare l'app nel Web browser come qualsiasi altra SPA.</span><span class="sxs-lookup"><span data-stu-id="a6de2-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="a6de2-114">Successivamente, l'utente procede all'installazione nel sistema operativo e Abilita le notifiche push.</span><span class="sxs-lookup"><span data-stu-id="a6de2-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="a6de2-115">Creare un progetto dal modello PWA</span><span class="sxs-lookup"><span data-stu-id="a6de2-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="a6de2-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="a6de2-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="a6de2-117">Quando si crea una nuova **Blazor WebAssembly app** nella finestra di dialogo **Crea un nuovo progetto** , selezionare la casella di controllo **applicazione Web progressiva** :</span><span class="sxs-lookup"><span data-stu-id="a6de2-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progressive Web Application** check box:</span></span>

![La casella di controllo ' applicazione Web progressiva ' è selezionata nella finestra di dialogo nuovo progetto di Visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="a6de2-119">Visual Studio Code/Interfaccia della riga di comando di .NET Core</span><span class="sxs-lookup"><span data-stu-id="a6de2-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="a6de2-120">Usare il comando seguente per creare un progetto PWA in una shell dei comandi con l' `--pwa` opzione:</span><span class="sxs-lookup"><span data-stu-id="a6de2-120">Use the following command to create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyBlazorPwa --pwa
```

<span data-ttu-id="a6de2-121">Nel comando precedente, l' `-o|--output` opzione Crea una nuova cartella per l'app denominata `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-121">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>

---

<span data-ttu-id="a6de2-122">Facoltativamente, è possibile configurare PWA per un'app creata dal modello di ASP.NET Core Hosted.</span><span class="sxs-lookup"><span data-stu-id="a6de2-122">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="a6de2-123">Lo scenario PWA è indipendente dal modello di hosting.</span><span class="sxs-lookup"><span data-stu-id="a6de2-123">The PWA scenario is independent of the hosting model.</span></span>

## <a name="convert-an-existing-no-locblazor-webassembly-app-into-a-pwa"></a><span data-ttu-id="a6de2-124">Convertire un' Blazor WebAssembly app esistente in un PWA</span><span class="sxs-lookup"><span data-stu-id="a6de2-124">Convert an existing Blazor WebAssembly app into a PWA</span></span>

<span data-ttu-id="a6de2-125">Convertire un' Blazor WebAssembly app esistente in un PWA seguendo le istruzioni riportate in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="a6de2-125">Convert an existing Blazor WebAssembly app into a PWA following the guidance in this section.</span></span>

<span data-ttu-id="a6de2-126">Nel file di progetto dell'app:</span><span class="sxs-lookup"><span data-stu-id="a6de2-126">In the app's project file:</span></span>

* <span data-ttu-id="a6de2-127">Aggiungere la `ServiceWorkerAssetsManifest` proprietà seguente a `PropertyGroup` :</span><span class="sxs-lookup"><span data-stu-id="a6de2-127">Add the following `ServiceWorkerAssetsManifest` property to a `PropertyGroup`:</span></span>

  ```xml
    ...
    <ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
  </PropertyGroup>
   ```

* <span data-ttu-id="a6de2-128">Aggiungere l' `ServiceWorker` elemento seguente a un `ItemGroup` :</span><span class="sxs-lookup"><span data-stu-id="a6de2-128">Add the following `ServiceWorker` item to an `ItemGroup`:</span></span>

  ```xml
  <ItemGroup>
    <ServiceWorker Include="wwwroot\service-worker.js" 
      PublishedContent="wwwroot\service-worker.published.js" />
  </ItemGroup>
  ```

<span data-ttu-id="a6de2-129">Per ottenere risorse statiche, usare **uno** degli approcci seguenti:</span><span class="sxs-lookup"><span data-stu-id="a6de2-129">To obtain static assets, use **one** of the following approaches:</span></span>

::: moniker range=">= aspnetcore-5.0"

* <span data-ttu-id="a6de2-130">Creare un nuovo progetto PWA separato con il [`dotnet new`](/dotnet/core/tools/dotnet-new) comando in una shell dei comandi:</span><span class="sxs-lookup"><span data-stu-id="a6de2-130">Create a separate, new PWA project with the [`dotnet new`](/dotnet/core/tools/dotnet-new) command in a command shell:</span></span>

  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa
  ```
  
  <span data-ttu-id="a6de2-131">Nel comando precedente, l' `-o|--output` opzione Crea una nuova cartella per l'app denominata `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-131">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>
  
  <span data-ttu-id="a6de2-132">Se non si converte un'app per la versione più recente, passare l' `-f|--framework` opzione.</span><span class="sxs-lookup"><span data-stu-id="a6de2-132">If you aren't converting an app for the latest release, pass the `-f|--framework` option.</span></span> <span data-ttu-id="a6de2-133">Nell'esempio seguente viene creata l'app per ASP.NET Core versione 3,1:</span><span class="sxs-lookup"><span data-stu-id="a6de2-133">The following example creates the app for ASP.NET Core version 3.1:</span></span>
  
  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa -f netcoreapp3.1
  ```

* <span data-ttu-id="a6de2-134">Passare al repository GitHub ASP.NET Core all'URL seguente, che si collega all'origine e alle risorse di riferimento della versione 5,0.</span><span class="sxs-lookup"><span data-stu-id="a6de2-134">Navigate to the ASP.NET Core GitHub repository at the following URL, which links to 5.0 release reference source and assets.</span></span> <span data-ttu-id="a6de2-135">Se non si converte un'app per la versione 5,0, selezionare la versione che si sta usando dall'elenco a discesa **Cambia rami o tag** applicabile all'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-135">If you aren't converting an app for the 5.0 release, select the release that you're working with from the **Switch branches or tags** drop-down list that applies to your app.</span></span>

  [<span data-ttu-id="a6de2-136">cartella del modello di progetto DotNet/aspnetcore (versione 5,0) Blazor WebAssembly `wwwroot`</span><span class="sxs-lookup"><span data-stu-id="a6de2-136">dotnet/aspnetcore (release 5.0) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/5.0/src/ProjectTemplates/Web.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

::: moniker-end

::: moniker range="< aspnetcore-5.0"

* <span data-ttu-id="a6de2-137">Creare un nuovo progetto PWA separato con il [`dotnet new`](/dotnet/core/tools/dotnet-new) comando in una shell dei comandi.</span><span class="sxs-lookup"><span data-stu-id="a6de2-137">Create a separate, new PWA project with the [`dotnet new`](/dotnet/core/tools/dotnet-new) command in a command shell.</span></span> <span data-ttu-id="a6de2-138">Passare l' `-f|--framework` opzione per selezionare la versione.</span><span class="sxs-lookup"><span data-stu-id="a6de2-138">Pass the `-f|--framework` option to select the version.</span></span> <span data-ttu-id="a6de2-139">Nell'esempio seguente viene creata l'app per ASP.NET Core versione 3,1:</span><span class="sxs-lookup"><span data-stu-id="a6de2-139">The following example creates the app for ASP.NET Core version 3.1:</span></span>
  
  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa -f netcoreapp3.1
  ```
  
  <span data-ttu-id="a6de2-140">Nel comando precedente, l' `-o|--output` opzione Crea una nuova cartella per l'app denominata `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-140">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>

* <span data-ttu-id="a6de2-141">Passare al repository GitHub ASP.NET Core all'URL seguente, che si collega all'origine e agli asset di riferimento della versione 3,1:</span><span class="sxs-lookup"><span data-stu-id="a6de2-141">Navigate to the ASP.NET Core GitHub repository at the following URL, which links to 3.1 release reference source and assets:</span></span>

  [<span data-ttu-id="a6de2-142">cartella del modello di progetto DotNet/aspnetcore (versione 3,1) Blazor WebAssembly `wwwroot`</span><span class="sxs-lookup"><span data-stu-id="a6de2-142">dotnet/aspnetcore (release 3.1) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/3.1/src/ProjectTemplates/ComponentsWebAssembly.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

  > [!NOTE]
  > <span data-ttu-id="a6de2-143">L'URL per il modello di progetto è stato Blazor WebAssembly modificato dopo il rilascio di ASP.NET Core 3,1.</span><span class="sxs-lookup"><span data-stu-id="a6de2-143">The URL for Blazor WebAssembly project template changed after the release of ASP.NET Core 3.1.</span></span> <span data-ttu-id="a6de2-144">Gli asset di riferimento per 5,0 o versioni successive sono disponibili all'URL seguente:</span><span class="sxs-lookup"><span data-stu-id="a6de2-144">Reference assets for 5.0 or later are available at the following URL:</span></span>
  >
  > [<span data-ttu-id="a6de2-145">cartella del modello di progetto DotNet/aspnetcore (versione 5,0) Blazor WebAssembly `wwwroot`</span><span class="sxs-lookup"><span data-stu-id="a6de2-145">dotnet/aspnetcore (release 5.0) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/5.0/src/ProjectTemplates/Web.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

::: moniker-end

<span data-ttu-id="a6de2-146">Dalla cartella di origine `wwwroot` nell'app creata dall'utente o dagli asset di riferimento nel `dotnet/aspnetcore` repository GitHub, copiare i file seguenti nella cartella dell'app `wwwroot` :</span><span class="sxs-lookup"><span data-stu-id="a6de2-146">From the source `wwwroot` folder either in the app that you created or from the reference assets in the `dotnet/aspnetcore` GitHub repository, copy the following files into the app's `wwwroot` folder:</span></span>

* `icon-512.png`
* `manifest.json`
* `service-worker.js`
* `service-worker.published.js`

<span data-ttu-id="a6de2-147">Nel file dell'app `wwwroot/index.html` :</span><span class="sxs-lookup"><span data-stu-id="a6de2-147">In the app's `wwwroot/index.html` file:</span></span>

* <span data-ttu-id="a6de2-148">Aggiungere `<link>` elementi per il manifesto e l'icona dell'app:</span><span class="sxs-lookup"><span data-stu-id="a6de2-148">Add `<link>` elements for the manifest and app icon:</span></span>

  ```html
  <link href="manifest.json" rel="manifest" />
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
  ```

* <span data-ttu-id="a6de2-149">Aggiungere il `<script>` tag seguente all'interno del `</body>` tag di chiusura subito dopo il `blazor.webassembly.js` tag di script:</span><span class="sxs-lookup"><span data-stu-id="a6de2-149">Add the following `<script>` tag inside the closing `</body>` tag immediately after the `blazor.webassembly.js` script tag:</span></span>

  ```html
      ...
      <script>navigator.serviceWorker.register('service-worker.js');</script>
  </body>
  ```

## <a name="installation-and-app-manifest"></a><span data-ttu-id="a6de2-150">Installazione e manifesto dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="a6de2-150">Installation and app manifest</span></span>

<span data-ttu-id="a6de2-151">Quando si visita un'app creata usando il modello di PWA, gli utenti hanno la possibilità di installare l'app nel menu Start del sistema operativo, nell'ancoraggio o nella schermata iniziale.</span><span class="sxs-lookup"><span data-stu-id="a6de2-151">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="a6de2-152">Il modo in cui viene presentata questa opzione dipende dal browser dell'utente.</span><span class="sxs-lookup"><span data-stu-id="a6de2-152">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="a6de2-153">Quando si usano i browser basati su Chrome Desktop, ad esempio Edge o Chrome, viene visualizzato un pulsante **Aggiungi** nella barra degli URL.</span><span class="sxs-lookup"><span data-stu-id="a6de2-153">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="a6de2-154">Dopo che l'utente ha selezionato il pulsante **Aggiungi** , viene visualizzata una finestra di dialogo di conferma:</span><span class="sxs-lookup"><span data-stu-id="a6de2-154">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![La finestra di dialogo di conferma in Google Chrome visualizza un pulsante di installazione all'utente per l'app ' My::: NO-LOC (Blazer):::P WA '.](progressive-web-app/_static/image2.png)

<span data-ttu-id="a6de2-156">In iOS i visitatori possono installare il PWA usando il pulsante di **condivisione** di Safari e l'opzione **Aggiungi a homescreen** .</span><span class="sxs-lookup"><span data-stu-id="a6de2-156">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="a6de2-157">In Chrome per Android, gli utenti devono selezionare il pulsante di **menu** nell'angolo in alto a destra, seguito da **Aggiungi alla schermata iniziale**.</span><span class="sxs-lookup"><span data-stu-id="a6de2-157">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="a6de2-158">Una volta installato, l'app viene visualizzata nella propria finestra senza una barra degli indirizzi:</span><span class="sxs-lookup"><span data-stu-id="a6de2-158">Once installed, the app appears in its own window without an address bar:</span></span>

![L'app ' My::: NO-LOC (Blazer):::P WA ' viene eseguita in Google Chrome senza una barra degli indirizzi.](progressive-web-app/_static/image3.png)

<span data-ttu-id="a6de2-160">Per personalizzare il titolo, la combinazione di colori, l'icona o altri dettagli della finestra, vedere il `manifest.json` file nella directory del progetto `wwwroot` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-160">To customize the window's title, color scheme, icon, or other details, see the `manifest.json` file in the project's `wwwroot` directory.</span></span> <span data-ttu-id="a6de2-161">Lo schema di questo file è definito dagli standard Web.</span><span class="sxs-lookup"><span data-stu-id="a6de2-161">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="a6de2-162">Per altre informazioni, vedere la pagina relativa ai [documenti MDN Web: manifesto dell'app Web](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="a6de2-162">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="a6de2-163">Supporto offline</span><span class="sxs-lookup"><span data-stu-id="a6de2-163">Offline support</span></span>

<span data-ttu-id="a6de2-164">Per impostazione predefinita, le app create usando l'opzione del modello di PWA hanno il supporto per l'esecuzione offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-164">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="a6de2-165">Un utente deve prima visitare l'app mentre è in linea.</span><span class="sxs-lookup"><span data-stu-id="a6de2-165">A user must first visit the app while they're online.</span></span> <span data-ttu-id="a6de2-166">Il browser Scarica e memorizza automaticamente tutte le risorse necessarie per il funzionamento offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-166">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a6de2-167">Il supporto per lo sviluppo interferisce con il normale ciclo di sviluppo di apportare modifiche e testarle.</span><span class="sxs-lookup"><span data-stu-id="a6de2-167">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="a6de2-168">Il supporto offline è pertanto abilitato solo per le app *pubblicate* .</span><span class="sxs-lookup"><span data-stu-id="a6de2-168">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="a6de2-169">Se si intende distribuire un PWA abilitato offline, sono presenti [diversi avvisi e Avvertenze importanti](#caveats-for-offline-pwas).</span><span class="sxs-lookup"><span data-stu-id="a6de2-169">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="a6de2-170">Questi scenari sono inerenti a PWA offline e non sono specifici di Blazor .</span><span class="sxs-lookup"><span data-stu-id="a6de2-170">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="a6de2-171">Assicurarsi di leggere e comprendere questi avvertimenti prima di ipotizzare il funzionamento dell'app abilitata per offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-171">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="a6de2-172">Per verificare il funzionamento del supporto offline:</span><span class="sxs-lookup"><span data-stu-id="a6de2-172">To see how offline support works:</span></span>

1. <span data-ttu-id="a6de2-173">Pubblicare l'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-173">Publish the app.</span></span> <span data-ttu-id="a6de2-174">Per altre informazioni, vedere <xref:blazor/host-and-deploy/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="a6de2-174">For more information, see <xref:blazor/host-and-deploy/index#publish-the-app>.</span></span>
1. <span data-ttu-id="a6de2-175">Distribuire l'app in un server che supporta HTTPS e accedere all'app in un browser con il relativo indirizzo HTTPS protetto.</span><span class="sxs-lookup"><span data-stu-id="a6de2-175">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="a6de2-176">Aprire gli strumenti di sviluppo del browser e verificare che un ruolo di *lavoro del servizio* sia registrato per l'host nella scheda **applicazione** :</span><span class="sxs-lookup"><span data-stu-id="a6de2-176">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![La scheda ' applicazione ' degli strumenti di sviluppo di Google Chrome Mostra un servizio di lavoro attivato e in esecuzione.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="a6de2-178">Ricaricare la pagina ed esaminare la scheda **rete** . il ruolo di **lavoro del servizio** o la **cache della memoria** sono elencati come origini per tutti gli asset della pagina:</span><span class="sxs-lookup"><span data-stu-id="a6de2-178">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![Scheda ' rete ' degli strumenti di sviluppo di Google Chrome che mostra le origini per tutte le risorse della pagina.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="a6de2-180">Per verificare che il browser non dipenda dall'accesso di rete per caricare l'app, eseguire una delle operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="a6de2-180">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="a6de2-181">Arrestare il server Web e verificare il funzionamento normale dell'app, che include il ricaricamento della pagina.</span><span class="sxs-lookup"><span data-stu-id="a6de2-181">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="a6de2-182">Analogamente, l'applicazione continua a funzionare normalmente quando è presente una connessione di rete lenta.</span><span class="sxs-lookup"><span data-stu-id="a6de2-182">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="a6de2-183">Indica al browser di simulare la modalità offline nella scheda **rete** :</span><span class="sxs-lookup"><span data-stu-id="a6de2-183">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![Scheda "rete" degli strumenti di sviluppo di Google Chrome con l'elenco a discesa Modalità browser modificato da "online" a "offline".](progressive-web-app/_static/image6.png)

<span data-ttu-id="a6de2-185">Il supporto offline tramite un worker del servizio è uno standard Web, non specifico di Blazor .</span><span class="sxs-lookup"><span data-stu-id="a6de2-185">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="a6de2-186">Per altre informazioni sui ruoli di lavoro del servizio, vedere la pagina relativa all' [API del servizio Web MDN](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="a6de2-186">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="a6de2-187">Per ulteriori informazioni sui modelli di utilizzo comuni per i ruoli di lavoro del servizio, vedere [Google Web: ciclo di vita del servizio](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="a6de2-187">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="a6de2-188">Blazoril modello di PWA produce due file del ruolo di lavoro del servizio:</span><span class="sxs-lookup"><span data-stu-id="a6de2-188">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="a6de2-189">`wwwroot/service-worker.js`, che viene usato durante lo sviluppo.</span><span class="sxs-lookup"><span data-stu-id="a6de2-189">`wwwroot/service-worker.js`, which is used during development.</span></span>
* <span data-ttu-id="a6de2-190">`wwwroot/service-worker.published.js`, che viene usato dopo la pubblicazione dell'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-190">`wwwroot/service-worker.published.js`, which is used after the app is published.</span></span>

<span data-ttu-id="a6de2-191">Per condividere la logica tra i due file del ruolo di lavoro del servizio, prendere in considerazione l'approccio seguente:</span><span class="sxs-lookup"><span data-stu-id="a6de2-191">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="a6de2-192">Aggiungere un terzo file JavaScript per conservare la logica comune.</span><span class="sxs-lookup"><span data-stu-id="a6de2-192">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="a6de2-193">Usare [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) per caricare la logica comune in entrambi i file del ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="a6de2-193">Use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="a6de2-194">Strategia di recupero cache-First</span><span class="sxs-lookup"><span data-stu-id="a6de2-194">Cache-first fetch strategy</span></span>

<span data-ttu-id="a6de2-195">Il ruolo di `service-worker.published.js` lavoro del servizio incorporato risolve le richieste utilizzando una strategia di *cache-First* .</span><span class="sxs-lookup"><span data-stu-id="a6de2-195">The built-in `service-worker.published.js` service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="a6de2-196">Questo significa che il ruolo di lavoro del servizio preferisce restituire contenuto memorizzato nella cache, indipendentemente dal fatto che l'utente abbia accesso alla rete o che nel server sia disponibile contenuto più recente.</span><span class="sxs-lookup"><span data-stu-id="a6de2-196">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="a6de2-197">La strategia di cache-First è utile perché:</span><span class="sxs-lookup"><span data-stu-id="a6de2-197">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="a6de2-198">**Garantisce l'affidabilità.**</span><span class="sxs-lookup"><span data-stu-id="a6de2-198">**It ensures reliability.**</span></span> <span data-ttu-id="a6de2-199">L'accesso alla rete non è uno stato booleano.</span><span class="sxs-lookup"><span data-stu-id="a6de2-199">Network access isn't a boolean state.</span></span> <span data-ttu-id="a6de2-200">Un utente non è semplicemente online o offline:</span><span class="sxs-lookup"><span data-stu-id="a6de2-200">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="a6de2-201">Il dispositivo dell'utente può presupporre che sia online, ma la rete potrebbe essere così lenta da risultare poco pratica da attendere.</span><span class="sxs-lookup"><span data-stu-id="a6de2-201">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="a6de2-202">La rete potrebbe restituire risultati non validi per determinati URL, ad esempio quando è presente un portale WIFI captive che sta attualmente bloccando o reindirizzando determinate richieste.</span><span class="sxs-lookup"><span data-stu-id="a6de2-202">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="a6de2-203">Questo è il motivo per cui l'API del browser `navigator.onLine` non è affidabile e non deve dipendere da.</span><span class="sxs-lookup"><span data-stu-id="a6de2-203">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="a6de2-204">**Garantisce la correttezza.**</span><span class="sxs-lookup"><span data-stu-id="a6de2-204">**It ensures correctness.**</span></span> <span data-ttu-id="a6de2-205">Quando si compila una cache di risorse offline, il ruolo di lavoro del servizio utilizza l'hashing del contenuto per garantire che sia stato recuperato uno snapshot completo e coerente delle risorse in un singolo momento.</span><span class="sxs-lookup"><span data-stu-id="a6de2-205">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="a6de2-206">Questa cache viene quindi utilizzata come unità atomica.</span><span class="sxs-lookup"><span data-stu-id="a6de2-206">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="a6de2-207">Non è necessario chiedere alla rete le risorse più recenti, perché le uniche versioni richieste sono quelle già memorizzate nella cache.</span><span class="sxs-lookup"><span data-stu-id="a6de2-207">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="a6de2-208">Altri rischiano incoerenza e incompatibilità (ad esempio, il tentativo di usare le versioni degli assembly .NET che non sono stati compilati insieme).</span><span class="sxs-lookup"><span data-stu-id="a6de2-208">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="a6de2-209">Aggiornamenti in background</span><span class="sxs-lookup"><span data-stu-id="a6de2-209">Background updates</span></span>

<span data-ttu-id="a6de2-210">Come modello mentale, è possibile pensare a un PWA offline-First come si comporta come un'app per dispositivi mobili che può essere installata.</span><span class="sxs-lookup"><span data-stu-id="a6de2-210">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="a6de2-211">L'app viene avviata immediatamente indipendentemente dalla connettività di rete, ma la logica dell'app installata deriva da uno snapshot temporizzato che potrebbe non essere la versione più recente.</span><span class="sxs-lookup"><span data-stu-id="a6de2-211">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="a6de2-212">Il Blazor modello di PWA genera app che tentano automaticamente di aggiornarsi in background ogni volta che l'utente visita e ha una connessione di rete funzionante.</span><span class="sxs-lookup"><span data-stu-id="a6de2-212">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="a6de2-213">Il funzionamento di questo approccio è il seguente:</span><span class="sxs-lookup"><span data-stu-id="a6de2-213">The way this works is as follows:</span></span>

* <span data-ttu-id="a6de2-214">Durante la compilazione, il progetto genera un manifesto delle risorse del ruolo di *lavoro del servizio*.</span><span class="sxs-lookup"><span data-stu-id="a6de2-214">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="a6de2-215">Per impostazione predefinita, viene chiamato il metodo `service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-215">By default, this is called `service-worker-assets.js`.</span></span> <span data-ttu-id="a6de2-216">Il manifesto elenca tutte le risorse statiche richieste dall'app per funzionare offline, ad esempio assembly .NET, file JavaScript e CSS, inclusi gli hash del contenuto.</span><span class="sxs-lookup"><span data-stu-id="a6de2-216">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="a6de2-217">L'elenco di risorse viene caricato dal ruolo di lavoro del servizio in modo da sapere quali risorse memorizzare nella cache.</span><span class="sxs-lookup"><span data-stu-id="a6de2-217">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="a6de2-218">Ogni volta che l'utente visita l'app, il browser richiede nuovamente `service-worker.js` e `service-worker-assets.js` in background.</span><span class="sxs-lookup"><span data-stu-id="a6de2-218">Each time the user visits the app, the browser re-requests `service-worker.js` and `service-worker-assets.js` in the background.</span></span> <span data-ttu-id="a6de2-219">I file vengono confrontati byte per byte con il ruolo di lavoro del servizio installato esistente.</span><span class="sxs-lookup"><span data-stu-id="a6de2-219">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="a6de2-220">Se il server restituisce contenuto modificato per uno di questi file, il ruolo di lavoro del servizio tenta di installare una nuova versione di se stessa.</span><span class="sxs-lookup"><span data-stu-id="a6de2-220">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="a6de2-221">Quando si installa una nuova versione di se stessa, il ruolo di lavoro del servizio crea una nuova cache separata per le risorse offline e inizia a popolare la cache con le risorse elencate in `service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-221">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in `service-worker-assets.js`.</span></span> <span data-ttu-id="a6de2-222">Questa logica viene implementata nella `onInstall` funzione all'interno di `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-222">This logic is implemented in the `onInstall` function inside `service-worker.published.js`.</span></span>
* <span data-ttu-id="a6de2-223">Il processo viene completato correttamente quando tutte le risorse vengono caricate senza errori e tutti gli hash di contenuto corrispondono.</span><span class="sxs-lookup"><span data-stu-id="a6de2-223">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="a6de2-224">In caso di esito positivo, il nuovo ruolo di lavoro del servizio entra *in attesa dello stato di attivazione* .</span><span class="sxs-lookup"><span data-stu-id="a6de2-224">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="a6de2-225">Non appena l'utente chiude l'app (nessuna scheda o Windows dell'app rimanente), il nuovo Worker del servizio diventa *attivo* e viene usato per le visite successive all'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-225">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="a6de2-226">Il servizio di lavoro precedente e la relativa cache vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="a6de2-226">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="a6de2-227">Se il processo non viene completato correttamente, la nuova istanza del ruolo di lavoro del servizio viene eliminata.</span><span class="sxs-lookup"><span data-stu-id="a6de2-227">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="a6de2-228">Il processo di aggiornamento viene nuovamente ritentato alla visita successiva dell'utente, quando si spera che il client disponga di una connessione di rete migliore in grado di completare le richieste.</span><span class="sxs-lookup"><span data-stu-id="a6de2-228">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="a6de2-229">Personalizzare questo processo modificando la logica del ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="a6de2-229">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="a6de2-230">Nessuno dei comportamenti precedenti è specifico di, Blazor ma è semplicemente l'esperienza predefinita fornita dall'opzione del modello PWA.</span><span class="sxs-lookup"><span data-stu-id="a6de2-230">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="a6de2-231">Per ulteriori informazioni, vedere la pagina relativa all' [API Web di MDN: Service Worker](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="a6de2-231">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="a6de2-232">Modalità di risoluzione delle richieste</span><span class="sxs-lookup"><span data-stu-id="a6de2-232">How requests are resolved</span></span>

<span data-ttu-id="a6de2-233">Come descritto nella sezione relativa alla [strategia di recupero cache-First](#cache-first-fetch-strategy) , il ruolo di lavoro predefinito del servizio utilizza una strategia di *cache-First* , ovvero tenta di gestire il contenuto memorizzato nella cache, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="a6de2-233">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="a6de2-234">Se non sono presenti contenuti memorizzati nella cache per un determinato URL, ad esempio quando si richiedono dati da un'API back-end, il ruolo di lavoro del servizio esegue il fallback su una normale richiesta di rete.</span><span class="sxs-lookup"><span data-stu-id="a6de2-234">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="a6de2-235">La richiesta di rete ha esito positivo se il server è raggiungibile.</span><span class="sxs-lookup"><span data-stu-id="a6de2-235">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="a6de2-236">Questa logica viene implementata all'interno di una `onFetch` funzione all'interno di `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-236">This logic is implemented inside `onFetch` function within `service-worker.published.js`.</span></span>

<span data-ttu-id="a6de2-237">Se i componenti dell'app Razor si basano sulla richiesta di dati dalle API back-end e si vuole fornire un'esperienza utente intuitiva per le richieste non riuscite a causa della mancata disponibilità della rete, implementare la logica all'interno dei componenti dell'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-237">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="a6de2-238">Usare, ad esempio `try/catch` , <xref:System.Net.Http.HttpClient> le richieste di circa.</span><span class="sxs-lookup"><span data-stu-id="a6de2-238">For example, use `try/catch` around <xref:System.Net.Http.HttpClient> requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="a6de2-239">Pagine di supporto per il rendering del server</span><span class="sxs-lookup"><span data-stu-id="a6de2-239">Support server-rendered pages</span></span>

<span data-ttu-id="a6de2-240">Si consideri cosa accade quando l'utente accede per la prima volta a un URL, ad esempio `/counter` o qualsiasi altro collegamento profondo nell'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-240">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="a6de2-241">In questi casi, non si vuole restituire contenuto memorizzato nella cache come `/counter` , ma è necessario il browser per caricare il contenuto memorizzato nella cache come `/index.html` per avviare l' Blazor WebAssembly app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-241">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="a6de2-242">Queste richieste iniziali sono note come richieste di *navigazione* , anziché:</span><span class="sxs-lookup"><span data-stu-id="a6de2-242">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="a6de2-243">`subresource` richieste per immagini, fogli di stile o altri file.</span><span class="sxs-lookup"><span data-stu-id="a6de2-243">`subresource` requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="a6de2-244">`fetch/XHR` richieste di dati dell'API.</span><span class="sxs-lookup"><span data-stu-id="a6de2-244">`fetch/XHR` requests for API data.</span></span>

<span data-ttu-id="a6de2-245">Il ruolo di lavoro del servizio predefinito contiene la logica speciale per le richieste di navigazione.</span><span class="sxs-lookup"><span data-stu-id="a6de2-245">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="a6de2-246">Il ruolo di lavoro del servizio risolve le richieste restituendo il contenuto memorizzato nella cache per `/index.html` , indipendentemente dall'URL richiesto.</span><span class="sxs-lookup"><span data-stu-id="a6de2-246">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="a6de2-247">Questa logica viene implementata nella `onFetch` funzione all'interno di `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-247">This logic is implemented in the `onFetch` function inside `service-worker.published.js`.</span></span>

<span data-ttu-id="a6de2-248">Se l'app dispone di determinati URL che devono restituire codice HTML sottoposto a rendering del server e non `/index.html` vengono usati dalla cache, è necessario modificare la logica nel ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="a6de2-248">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="a6de2-249">Se tutti gli URL che contengono `/Identity/` devono essere gestiti come richieste normali solo in linea al server, modificare la `service-worker.published.js` `onFetch` logica.</span><span class="sxs-lookup"><span data-stu-id="a6de2-249">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify `service-worker.published.js` `onFetch` logic.</span></span> <span data-ttu-id="a6de2-250">Individuare il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="a6de2-250">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="a6de2-251">Modificare il codice nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="a6de2-251">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
  && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="a6de2-252">Se non si esegue questa operazione, indipendentemente dalla connettività di rete, il ruolo di lavoro del servizio intercetta le richieste per tali URL e le risolve utilizzando `/index.html` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-252">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

<span data-ttu-id="a6de2-253">Aggiungere al controllo altri endpoint per i provider di autenticazione esterni.</span><span class="sxs-lookup"><span data-stu-id="a6de2-253">Add additional endpoints for external authentication providers to the check.</span></span> <span data-ttu-id="a6de2-254">Nell'esempio seguente, `/signin-google` per l'autenticazione Google viene aggiunto al controllo:</span><span class="sxs-lookup"><span data-stu-id="a6de2-254">In the following example, `/signin-google` for Google authentication is added to the check:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
  && !event.request.url.includes('/Identity/')
  && !event.request.url.includes('/signin-google');
```

<span data-ttu-id="a6de2-255">Non è necessaria alcuna azione per l'ambiente di sviluppo, in cui il contenuto viene sempre recuperato dalla rete.</span><span class="sxs-lookup"><span data-stu-id="a6de2-255">No action is required for the Development environment, where content is always fetched from the network.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="a6de2-256">Controllare la memorizzazione nella cache degli asset</span><span class="sxs-lookup"><span data-stu-id="a6de2-256">Control asset caching</span></span>

<span data-ttu-id="a6de2-257">Se il progetto definisce la `ServiceWorkerAssetsManifest` Proprietà MSBuild, Blazor gli strumenti di compilazione di generano un manifesto delle risorse del ruolo di lavoro del servizio con il nome specificato.</span><span class="sxs-lookup"><span data-stu-id="a6de2-257">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="a6de2-258">Il modello predefinito di PWA produce un file di progetto contenente la proprietà seguente:</span><span class="sxs-lookup"><span data-stu-id="a6de2-258">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="a6de2-259">Il file viene inserito nella `wwwroot` directory di output, quindi il browser può recuperare il file richiedendo `/service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-259">The file is placed in the `wwwroot` output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="a6de2-260">Per visualizzare il contenuto di questo file, aprire `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` in un editor di testo.</span><span class="sxs-lookup"><span data-stu-id="a6de2-260">To see the contents of this file, open `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` in a text editor.</span></span> <span data-ttu-id="a6de2-261">Tuttavia, non modificare il file perché viene rigenerato in ogni compilazione.</span><span class="sxs-lookup"><span data-stu-id="a6de2-261">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="a6de2-262">Per impostazione predefinita, questo manifesto elenca:</span><span class="sxs-lookup"><span data-stu-id="a6de2-262">By default, this manifest lists:</span></span>

* <span data-ttu-id="a6de2-263">Tutte le Blazor risorse gestite, ad esempio gli assembly .NET e i file di runtime di .NET webassembly, necessari per il funzionamento offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-263">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="a6de2-264">Tutte le risorse per la pubblicazione nella directory dell'app `wwwroot` , ad esempio immagini, fogli di stile e file JavaScript, inclusi gli asset Web statici forniti da progetti esterni e pacchetti NuGet.</span><span class="sxs-lookup"><span data-stu-id="a6de2-264">All resources for publishing to the app's `wwwroot` directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="a6de2-265">È possibile controllare quali di queste risorse vengono recuperate e memorizzate nella cache dal ruolo di lavoro del servizio modificando la logica in `onInstall` in `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-265">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in `service-worker.published.js`.</span></span> <span data-ttu-id="a6de2-266">Per impostazione predefinita, il ruolo di lavoro del servizio recupera e memorizza nella cache i file corrispondenti a estensioni di file Web tipiche, ad esempio `.html` ,, `.css` `.js` e `.wasm` , oltre ai tipi di file specifici di Blazor WebAssembly ( `.dll` , `.pdb` ).</span><span class="sxs-lookup"><span data-stu-id="a6de2-266">By default, the service worker fetches and caches files matching typical web filename extensions such as `.html`, `.css`, `.js`, and `.wasm`, plus file types specific to Blazor WebAssembly (`.dll`, `.pdb`).</span></span>

<span data-ttu-id="a6de2-267">Per includere risorse aggiuntive che non sono presenti nella directory dell'app `wwwroot` , definire voci MSBuild aggiuntive `ItemGroup` , come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="a6de2-267">To include additional resources that aren't present in the app's `wwwroot` directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="a6de2-268">I `AssetUrl` metadati specificano l'URL relativo di base che il browser deve usare durante il recupero della risorsa nella cache.</span><span class="sxs-lookup"><span data-stu-id="a6de2-268">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="a6de2-269">Questo può essere indipendente dal nome del file di origine originale sul disco.</span><span class="sxs-lookup"><span data-stu-id="a6de2-269">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a6de2-270">L'aggiunta di un `ServiceWorkerAssetsManifestItem` non comporta la pubblicazione del file nella directory dell'app `wwwroot` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-270">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's `wwwroot` directory.</span></span> <span data-ttu-id="a6de2-271">L'output di pubblicazione deve essere controllato separatamente.</span><span class="sxs-lookup"><span data-stu-id="a6de2-271">The publish output must be controlled separately.</span></span> <span data-ttu-id="a6de2-272">Il `ServiceWorkerAssetsManifestItem` solo determina la visualizzazione di una voce aggiuntiva nel manifesto delle risorse del ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="a6de2-272">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="a6de2-273">Notifiche push</span><span class="sxs-lookup"><span data-stu-id="a6de2-273">Push notifications</span></span>

<span data-ttu-id="a6de2-274">Analogamente a qualsiasi altro PWA, un Blazor WebAssembly PWA può ricevere notifiche push da un server back-end.</span><span class="sxs-lookup"><span data-stu-id="a6de2-274">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="a6de2-275">Il server può inviare notifiche push in qualsiasi momento, anche quando l'utente non usa attivamente l'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-275">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="a6de2-276">Ad esempio, è possibile inviare notifiche push quando un altro utente esegue un'azione pertinente.</span><span class="sxs-lookup"><span data-stu-id="a6de2-276">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="a6de2-277">Il meccanismo per l'invio di una notifica push è interamente indipendente da Blazor WebAssembly , poiché è implementato dal server back-end che può utilizzare qualsiasi tecnologia.</span><span class="sxs-lookup"><span data-stu-id="a6de2-277">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="a6de2-278">Se si desidera inviare notifiche push da un server di ASP.NET Core, è consigliabile [utilizzare una tecnica simile all'approccio adottato nel workshop sulla pizza ardente](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="a6de2-278">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="a6de2-279">Il meccanismo per la ricezione e la visualizzazione di una notifica push sul client è anche indipendente da Blazor WebAssembly , dal momento che è implementato nel file JavaScript del servizio Worker.</span><span class="sxs-lookup"><span data-stu-id="a6de2-279">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="a6de2-280">Per un esempio, vedere [l'approccio usato in the Blazing pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="a6de2-280">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="a6de2-281">Avvertenze per PWA offline</span><span class="sxs-lookup"><span data-stu-id="a6de2-281">Caveats for offline PWAs</span></span>

<span data-ttu-id="a6de2-282">Non tutte le app devono provare a supportare l'uso offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-282">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="a6de2-283">Il supporto offline aggiunge una complessità significativa, sebbene non sempre pertinente per i casi d'uso richiesti.</span><span class="sxs-lookup"><span data-stu-id="a6de2-283">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="a6de2-284">Il supporto offline è in genere rilevante solo:</span><span class="sxs-lookup"><span data-stu-id="a6de2-284">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="a6de2-285">Se l'archivio dati primario è locale nel browser.</span><span class="sxs-lookup"><span data-stu-id="a6de2-285">If the primary data store is local to the browser.</span></span> <span data-ttu-id="a6de2-286">Ad esempio, l'approccio è pertinente in un'app con un'interfaccia utente per [un dispositivo Internet](https://en.wikipedia.org/wiki/Internet_of_things) delle cose che archivia i dati in `localStorage` o [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="a6de2-286">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="a6de2-287">Se l'app esegue una quantità significativa di lavoro per recuperare e memorizzare nella cache i dati dell'API back-end rilevanti per ogni utente, in modo che possano spostarsi tra i dati offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-287">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="a6de2-288">Se l'app deve supportare la modifica, è necessario compilare un sistema per tenere traccia delle modifiche e sincronizzare i dati con il back-end.</span><span class="sxs-lookup"><span data-stu-id="a6de2-288">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="a6de2-289">Se l'obiettivo è garantire che l'app venga caricata immediatamente indipendentemente dalle condizioni della rete.</span><span class="sxs-lookup"><span data-stu-id="a6de2-289">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="a6de2-290">Implementare un'esperienza utente adatta alle richieste dell'API back-end per mostrare lo stato di avanzamento delle richieste e comportarsi correttamente quando le richieste hanno esito negativo a causa della mancata disponibilità della rete</span><span class="sxs-lookup"><span data-stu-id="a6de2-290">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="a6de2-291">Inoltre, le PWA con supporto offline devono gestire una serie di complicazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="a6de2-291">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="a6de2-292">Gli sviluppatori devono acquisire familiarità con attenzione con le avvertenze riportate nelle sezioni riportate di seguito.</span><span class="sxs-lookup"><span data-stu-id="a6de2-292">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="a6de2-293">Supporto offline solo dopo la pubblicazione</span><span class="sxs-lookup"><span data-stu-id="a6de2-293">Offline support only when published</span></span>

<span data-ttu-id="a6de2-294">Durante lo sviluppo, in genere si desidera visualizzare tutte le modifiche riflesse immediatamente nel browser senza passare attraverso un processo di aggiornamento in background.</span><span class="sxs-lookup"><span data-stu-id="a6de2-294">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="a6de2-295">Di conseguenza, Blazor il modello di PWA consente il supporto offline solo dopo la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="a6de2-295">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="a6de2-296">Quando si compila un'app che supporta offline, non è sufficiente testare l'app nell'ambiente di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="a6de2-296">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="a6de2-297">È necessario testare l'app nello stato pubblicato per comprendere come risponde a condizioni di rete diverse.</span><span class="sxs-lookup"><span data-stu-id="a6de2-297">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="a6de2-298">Completamento dell'aggiornamento dopo la navigazione dell'utente dall'app</span><span class="sxs-lookup"><span data-stu-id="a6de2-298">Update completion after user navigation away from app</span></span>

<span data-ttu-id="a6de2-299">Gli aggiornamenti non vengono completati fino a quando l'utente non si è spostato dall'app in tutte le schede.</span><span class="sxs-lookup"><span data-stu-id="a6de2-299">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="a6de2-300">Come spiegato nella sezione [aggiornamenti in background](#background-updates) , dopo la distribuzione di un aggiornamento nell'app, il browser recupera i file di lavoro del servizio aggiornati per avviare il processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="a6de2-300">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="a6de2-301">Quali sono le sorprese che molti sviluppatori, anche al termine dell'aggiornamento, diventano effettive fino a quando l'utente **non** si è spostato in tutte le schede.</span><span class="sxs-lookup"><span data-stu-id="a6de2-301">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="a6de2-302">**Non** è sufficiente aggiornare la scheda visualizzando l'app, anche se si tratta dell'unica scheda che Visualizza l'app.</span><span class="sxs-lookup"><span data-stu-id="a6de2-302">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="a6de2-303">Finché l'app non viene chiusa completamente, il nuovo ruolo di lavoro del servizio rimane in *attesa di attivazione* .</span><span class="sxs-lookup"><span data-stu-id="a6de2-303">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="a6de2-304">**Questo non è specifico di Blazor , ma è piuttosto un comportamento standard della piattaforma Web.**</span><span class="sxs-lookup"><span data-stu-id="a6de2-304">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="a6de2-305">Questo problema si verifica in genere dagli sviluppatori che tentano di testare gli aggiornamenti al ruolo di lavoro del servizio o alle risorse nella cache offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-305">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="a6de2-306">Se si archiviano gli strumenti di sviluppo del browser, è possibile che venga visualizzato un risultato simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="a6de2-306">If you check in the browser's developer tools, you may see something like the following:</span></span>

![La scheda "applicazione" di Google Chrome indica che il ruolo di lavoro del servizio dell'app è in attesa di attivazione.](progressive-web-app/_static/image7.png)

<span data-ttu-id="a6de2-308">Per tutto il tempo in cui l'elenco di "client", che sono schede o finestre che visualizzano l'app, non è vuoto, il lavoro continua ad attendere.</span><span class="sxs-lookup"><span data-stu-id="a6de2-308">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="a6de2-309">Il motivo per cui i dipendenti del servizio eseguono questa operazione è garantire la coerenza.</span><span class="sxs-lookup"><span data-stu-id="a6de2-309">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="a6de2-310">La coerenza significa che tutte le risorse vengono recuperate dalla stessa cache atomica.</span><span class="sxs-lookup"><span data-stu-id="a6de2-310">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="a6de2-311">Quando si verificano le modifiche, può essere utile fare clic sul collegamento "skipWaiting", come illustrato nella schermata precedente, quindi ricaricare la pagina.</span><span class="sxs-lookup"><span data-stu-id="a6de2-311">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="a6de2-312">È possibile automatizzare questa operazione per tutti gli utenti codificando il ruolo di lavoro del servizio in modo da [ignorare la fase di attesa e attivare immediatamente l'aggiornamento](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="a6de2-312">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="a6de2-313">Se si ignora la fase di attesa, si cede la garanzia che le risorse vengano sempre recuperate in modo coerente dalla stessa istanza della cache.</span><span class="sxs-lookup"><span data-stu-id="a6de2-313">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="a6de2-314">Gli utenti possono eseguire qualsiasi versione cronologica dell'app</span><span class="sxs-lookup"><span data-stu-id="a6de2-314">Users may run any historical version of the app</span></span>

<span data-ttu-id="a6de2-315">Gli sviluppatori Web si aspettano abitualmente che gli utenti eseguano solo la versione più recente distribuita dell'app Web, dal momento che è normale nel modello di distribuzione Web tradizionale.</span><span class="sxs-lookup"><span data-stu-id="a6de2-315">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="a6de2-316">Tuttavia, un PWA per la prima volta offline è più simile a un'app per dispositivi mobili nativa, in cui gli utenti non eseguono necessariamente la versione più recente.</span><span class="sxs-lookup"><span data-stu-id="a6de2-316">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="a6de2-317">Come spiegato nella sezione [aggiornamenti in background](#background-updates) , dopo la distribuzione di un aggiornamento nell'app, **ogni utente esistente continua a usare una versione precedente per almeno un'altra visita** perché l'aggiornamento viene eseguito in background e non viene attivato fino a quando l'utente non si sposta in seguito.</span><span class="sxs-lookup"><span data-stu-id="a6de2-317">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="a6de2-318">Inoltre, la versione precedente utilizzata non è necessariamente quella precedente distribuita.</span><span class="sxs-lookup"><span data-stu-id="a6de2-318">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="a6de2-319">La versione precedente può essere *qualsiasi* versione cronologica, a seconda di quando l'utente ha completato un aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="a6de2-319">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="a6de2-320">Questo può essere un problema se le parti front-end e back-end dell'app richiedono un accordo sullo schema per le richieste API.</span><span class="sxs-lookup"><span data-stu-id="a6de2-320">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="a6de2-321">Non è necessario distribuire le modifiche dello schema API incompatibili con le versioni precedenti fino a quando non si è certi che tutti gli utenti abbiano eseguito l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="a6de2-321">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="a6de2-322">In alternativa, impedire agli utenti di usare versioni precedenti dell'app incompatibili.</span><span class="sxs-lookup"><span data-stu-id="a6de2-322">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="a6de2-323">Questo requisito dello scenario è identico a quello delle app per dispositivi mobili native.</span><span class="sxs-lookup"><span data-stu-id="a6de2-323">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="a6de2-324">Se si distribuisce una modifica di rilievo nelle API del server, l'app client viene interrotta per gli utenti che non hanno ancora eseguito l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="a6de2-324">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="a6de2-325">Se possibile, non distribuire le modifiche di rilievo alle API back-end.</span><span class="sxs-lookup"><span data-stu-id="a6de2-325">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="a6de2-326">Se necessario, provare a usare le [API standard del ruolo di lavoro del servizio, ad esempio ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) , per determinare se l'app è aggiornata e, in caso contrario, per impedire l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="a6de2-326">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="a6de2-327">Interferenze con le pagine sottoposte a rendering server</span><span class="sxs-lookup"><span data-stu-id="a6de2-327">Interference with server-rendered pages</span></span>

<span data-ttu-id="a6de2-328">Come descritto nella sezione [pagine del server di supporto](#support-server-rendered-pages) di cui è stato eseguito il rendering, se si desidera ignorare il comportamento del ruolo di lavoro del servizio per la restituzione di `/index.html` contenuto per tutte le richieste di navigazione, modificare la logica nel ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="a6de2-328">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="a6de2-329">Tutti i contenuti del manifesto dell'asset del servizio di lavoro vengono memorizzati nella cache</span><span class="sxs-lookup"><span data-stu-id="a6de2-329">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="a6de2-330">Come descritto nella sezione [controllare la memorizzazione nella cache degli asset](#control-asset-caching) , il file `service-worker-assets.js` viene generato durante la compilazione ed elenca tutti gli asset che devono essere recuperati e memorizzati nella cache dal ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="a6de2-330">As described in the [Control asset caching](#control-asset-caching) section, the file `service-worker-assets.js` is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="a6de2-331">Poiché per impostazione predefinita questo elenco include tutto ciò che `wwwroot` è stato emesso, incluso il contenuto fornito da pacchetti e progetti esterni, è necessario prestare attenzione a non inserire troppi contenuti.</span><span class="sxs-lookup"><span data-stu-id="a6de2-331">Since this list by default includes everything emitted to `wwwroot`, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="a6de2-332">Se la `wwwroot` directory contiene milioni di immagini, il ruolo di lavoro del servizio tenterà di recuperarli e memorizzarli nella cache, consumando una larghezza di banda eccessiva e probabilmente non viene completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="a6de2-332">If the `wwwroot` directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="a6de2-333">Implementare una logica arbitraria per controllare quale subset del contenuto del manifesto deve essere recuperato e memorizzato nella cache modificando la `onInstall` funzione in `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="a6de2-333">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in `service-worker.published.js`.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="a6de2-334">Interazione con l'autenticazione</span><span class="sxs-lookup"><span data-stu-id="a6de2-334">Interaction with authentication</span></span>

<span data-ttu-id="a6de2-335">Il modello PWA può essere usato in combinazione con l'autenticazione di.</span><span class="sxs-lookup"><span data-stu-id="a6de2-335">The PWA template can be used in conjunction with authentication.</span></span> <span data-ttu-id="a6de2-336">Un PWA con supporto offline può anche supportare l'autenticazione quando l'utente ha la connettività di rete iniziale.</span><span class="sxs-lookup"><span data-stu-id="a6de2-336">An offline-capable PWA can also support authentication when the user has initial network connectivity.</span></span>

<span data-ttu-id="a6de2-337">Quando un utente non dispone di connettività di rete, non è in grado di autenticare o ottenere i token di accesso.</span><span class="sxs-lookup"><span data-stu-id="a6de2-337">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="a6de2-338">Per impostazione predefinita, il tentativo di visitare la pagina di accesso senza accesso alla rete genera un messaggio di errore di rete.</span><span class="sxs-lookup"><span data-stu-id="a6de2-338">By default, attempting to visit the login page without network access results in a "network error" message.</span></span> <span data-ttu-id="a6de2-339">È necessario progettare un flusso dell'interfaccia utente che consenta all'utente di eseguire attività utili in modalità offline senza tentare di autenticare l'utente o ottenere i token di accesso.</span><span class="sxs-lookup"><span data-stu-id="a6de2-339">You must design a UI flow that allows the user perform useful tasks while offline without attempting to authenticate the user or obtain access tokens.</span></span> <span data-ttu-id="a6de2-340">In alternativa, è possibile progettare l'applicazione in modo che non riesca correttamente quando la rete non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="a6de2-340">Alternatively, you can design the app to gracefully fail when the network isn't available.</span></span> <span data-ttu-id="a6de2-341">Se l'app non può essere progettata per gestire questi scenari, è possibile che non si desideri abilitare il supporto offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-341">If the app can't be designed to handle these scenarios, you might not want to enable offline support.</span></span>

<span data-ttu-id="a6de2-342">Quando un'app progettata per l'uso online e offline è di nuovo online:</span><span class="sxs-lookup"><span data-stu-id="a6de2-342">When an app that's designed for online and offline use is online again:</span></span>

* <span data-ttu-id="a6de2-343">L'app potrebbe dover effettuare il provisioning di un nuovo token di accesso.</span><span class="sxs-lookup"><span data-stu-id="a6de2-343">The app might need to provision a new access token.</span></span>
* <span data-ttu-id="a6de2-344">L'app deve rilevare se un altro utente è connesso al servizio, in modo da poter applicare le operazioni all'account dell'utente che sono state effettuate mentre erano offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-344">The app must detect if a different user is signed into the service so that it can apply operations to the user's account that were made while they were offline.</span></span>

<span data-ttu-id="a6de2-345">Per creare un'app PWA offline che interagisce con l'autenticazione:</span><span class="sxs-lookup"><span data-stu-id="a6de2-345">To create an offline PWA app that interacts with authentication:</span></span>

* <span data-ttu-id="a6de2-346">Sostituire <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> con una factory che archivia l'ultimo utente connesso e usa l'utente archiviato quando l'app è offline.</span><span class="sxs-lookup"><span data-stu-id="a6de2-346">Replace the <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> with a factory that stores the last signed-in user and uses the stored user when the app is offline.</span></span>
* <span data-ttu-id="a6de2-347">Accodare le operazioni mentre l'app è offline e applicarle quando l'app torna online.</span><span class="sxs-lookup"><span data-stu-id="a6de2-347">Queue operations while the app is offline and apply them when the app returns online.</span></span>
* <span data-ttu-id="a6de2-348">Durante la disconnessione, cancellare l'utente archiviato.</span><span class="sxs-lookup"><span data-stu-id="a6de2-348">During sign out, clear the stored user.</span></span>

<span data-ttu-id="a6de2-349">L' [`CarChecker`](https://github.com/SteveSandersonMS/CarChecker) app di esempio illustra gli approcci precedenti.</span><span class="sxs-lookup"><span data-stu-id="a6de2-349">The [`CarChecker`](https://github.com/SteveSandersonMS/CarChecker) sample app demonstrates the preceding approaches.</span></span> <span data-ttu-id="a6de2-350">Vedere le parti seguenti dell'app:</span><span class="sxs-lookup"><span data-stu-id="a6de2-350">See the following parts of the app:</span></span>

* <span data-ttu-id="a6de2-351">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span><span class="sxs-lookup"><span data-stu-id="a6de2-351">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span></span>
* <span data-ttu-id="a6de2-352">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span><span class="sxs-lookup"><span data-stu-id="a6de2-352">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span></span>
* <span data-ttu-id="a6de2-353">`LoginStatus` componente ( `Client/Shared/LoginStatus.razor` )</span><span class="sxs-lookup"><span data-stu-id="a6de2-353">`LoginStatus` component (`Client/Shared/LoginStatus.razor`)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a6de2-354">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="a6de2-354">Additional resources</span></span>

* [<span data-ttu-id="a6de2-355">Risolvere i problemi dello script di PowerShell di integrità</span><span class="sxs-lookup"><span data-stu-id="a6de2-355">Troubleshoot integrity PowerShell script</span></span>](xref:blazor/host-and-deploy/webassembly#troubleshoot-integrity-powershell-script)
* [<span data-ttu-id="a6de2-356">SignalR negoziazione tra le origini per l'autenticazione</span><span class="sxs-lookup"><span data-stu-id="a6de2-356">SignalR cross-origin negotiation for authentication</span></span>](xref:blazor/fundamentals/additional-scenarios#signalr-cross-origin-negotiation-for-authentication)
